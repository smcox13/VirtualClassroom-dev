{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _promise = require('babel-runtime/core-js/promise');\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nexports.default = request;\n\nvar _events = require('events');\n\nvar _request2 = require('./request');\n\nvar _request3 = _interopRequireDefault(_request2);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n/**\n * @param {Object} options\n * @returns {Promise}\n */\n\n/*!\n * Copyright (c) 2015-2019 Cisco Systems, Inc. See LICENSE file.\n */\n\n\nfunction request(options) {\n  if (options.url) {\n    options.uri = options.url;\n    options.url = null;\n  }\n\n  options.headers = options.headers || {};\n  options.download = new _events.EventEmitter();\n  options.upload = new _events.EventEmitter();\n  return intercept(options.interceptors, 'Request').then(function () {\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _request3.default.apply(undefined, [options].concat(args));\n  }).then(function () {\n    for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    return intercept.apply(undefined, [options.interceptors.slice().reverse(), 'Response'].concat(args));\n  });\n  /**\n   * @param {Array} interceptors\n   * @param {string} key\n   * @param {Object} res\n   * @private\n   * @returns {Promise}\n   */\n\n  function intercept(interceptors, key, res) {\n    var successKey = 'on' + key;\n    var errorKey = 'on' + key + 'Error';\n    return interceptors.reduce(function (promise, interceptor) {\n      return promise.then(function (result) {\n        interceptor.logOptions(options);\n\n        if (interceptor[successKey]) {\n          return interceptor[successKey](options, result);\n        }\n\n        return _promise2.default.resolve(result);\n      }, function (reason) {\n        interceptor.logOptions(options);\n\n        if (interceptor[errorKey]) {\n          return interceptor[errorKey](options, reason);\n        }\n\n        return _promise2.default.reject(reason);\n      });\n    }, _promise2.default.resolve(res));\n  }\n}","map":{"version":3,"sources":["index.js"],"names":["request","options","EventEmitter","args","_request","intercept","successKey","errorKey","interceptor"],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) 2015-2019 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {EventEmitter} from 'events';\n\nimport _request from './request';\n\n/**\n * @param {Object} options\n * @returns {Promise}\n */\nexport default function request(options) {\n  if (options.url) {\n    options.uri = options.url;\n    options.url = null;\n  }\n\n  options.headers = options.headers || {};\n\n  options.download = new EventEmitter();\n  options.upload = new EventEmitter();\n\n  return intercept(options.interceptors, 'Request')\n    .then((...args) => _request(options, ...args))\n    .then((...args) => intercept(options.interceptors.slice().reverse(), 'Response', ...args));\n\n  /**\n   * @param {Array} interceptors\n   * @param {string} key\n   * @param {Object} res\n   * @private\n   * @returns {Promise}\n   */\n  function intercept(interceptors, key, res) {\n    const successKey = `on${key}`;\n    const errorKey = `on${key}Error`;\n\n    return interceptors.reduce((promise, interceptor) => promise.then(\n      (result) => {\n        interceptor.logOptions(options);\n        if (interceptor[successKey]) {\n          return interceptor[successKey](options, result);\n        }\n\n        return Promise.resolve(result);\n      },\n      (reason) => {\n        interceptor.logOptions(options);\n        if (interceptor[errorKey]) {\n          return interceptor[errorKey](options, reason);\n        }\n\n        return Promise.reject(reason);\n      }\n    ), Promise.resolve(res));\n  }\n}\n"]},"metadata":{},"sourceType":"script"}