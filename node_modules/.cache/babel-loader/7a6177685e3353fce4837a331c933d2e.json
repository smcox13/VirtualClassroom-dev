{"ast":null,"code":"/*\r\n * Copyright (c) 2016-2018, Peculiar Ventures\r\n * All rights reserved.\r\n *\r\n * Author 2016-2018, Yury Strozhevsky <www.strozhevsky.com>.\r\n *\r\n */\n//**************************************************************************************\nexport class ByteStream {\n  //**********************************************************************************\n  // noinspection FunctionWithMultipleLoopsJS\n\n  /**\r\n   * Constructor for ByteStream class\r\n   * @param {{[length]: number, [stub]: number, [view]: Uint8Array, [buffer]: ArrayBuffer, [string]: string, [hexstring]: string}} parameters\r\n   */\n  constructor(parameters = {}) {\n    this.clear();\n\n    for (const key of Object.keys(parameters)) {\n      switch (key) {\n        case \"length\":\n          this.length = parameters.length;\n          break;\n\n        case \"stub\":\n          // noinspection NonBlockStatementBodyJS\n          for (let i = 0; i < this._view.length; i++) this._view[i] = parameters.stub;\n\n          break;\n\n        case \"view\":\n          this.fromUint8Array(parameters.view);\n          break;\n\n        case \"buffer\":\n          this.fromArrayBuffer(parameters.buffer);\n          break;\n\n        case \"string\":\n          this.fromString(parameters.string);\n          break;\n\n        case \"hexstring\":\n          this.fromHexString(parameters.hexstring);\n          break;\n\n        default:\n      }\n    }\n  } //**********************************************************************************\n\n  /**\r\n   * Setter for \"buffer\"\r\n   * @param {ArrayBuffer} value\r\n   */\n\n\n  set buffer(value) {\n    this._buffer = value.slice(0);\n    this._view = new Uint8Array(this._buffer);\n  } //**********************************************************************************\n\n  /**\r\n   * Getter for \"buffer\"\r\n   * @returns {ArrayBuffer}\r\n   */\n\n\n  get buffer() {\n    return this._buffer;\n  } //**********************************************************************************\n\n  /**\r\n   * Setter for \"view\"\r\n   * @param {Uint8Array} value\r\n   */\n\n\n  set view(value) {\n    this._buffer = new ArrayBuffer(value.length);\n    this._view = new Uint8Array(this._buffer);\n\n    this._view.set(value);\n  } //**********************************************************************************\n\n  /**\r\n   * Getter for \"view\"\r\n   * @returns {Uint8Array}\r\n   */\n\n\n  get view() {\n    return this._view;\n  } //**********************************************************************************\n\n  /**\r\n   * Getter for \"length\"\r\n   * @returns {number}\r\n   */\n\n\n  get length() {\n    return this._buffer.byteLength;\n  } //**********************************************************************************\n\n  /**\r\n   * Setter for \"length\"\r\n   * @param {number} value\r\n   */\n\n\n  set length(value) {\n    this._buffer = new ArrayBuffer(value);\n    this._view = new Uint8Array(this._buffer);\n  } //**********************************************************************************\n\n  /**\r\n   * Clear existing stream\r\n   */\n\n\n  clear() {\n    this._buffer = new ArrayBuffer(0);\n    this._view = new Uint8Array(this._buffer);\n  } //**********************************************************************************\n\n  /**\r\n   * Initialize \"Stream\" object from existing \"ArrayBuffer\"\r\n   * @param {!ArrayBuffer} array The ArrayBuffer to copy from\r\n   */\n\n\n  fromArrayBuffer(array) {\n    this.buffer = array;\n  } //**********************************************************************************\n  // noinspection FunctionNamingConventionJS\n\n  /**\r\n   * Initialize \"Stream\" object from existing \"Uint8Array\"\r\n   * @param {!Uint8Array} array The Uint8Array to copy from\r\n   */\n\n\n  fromUint8Array(array) {\n    this._buffer = new ArrayBuffer(array.length);\n    this._view = new Uint8Array(this._buffer);\n\n    this._view.set(array);\n  } //**********************************************************************************\n\n  /**\r\n   * Initialize \"Stream\" object from existing string\r\n   * @param {string} string The string to initialize from\r\n   */\n\n\n  fromString(string) {\n    const stringLength = string.length;\n    this.length = stringLength; // noinspection NonBlockStatementBodyJS\n\n    for (let i = 0; i < stringLength; i++) this.view[i] = string.charCodeAt(i);\n  } //**********************************************************************************\n\n  /**\r\n   * Represent \"Stream\" object content as a string\r\n   * @param {number} [start] Start position to convert to string\r\n   * @param {number} [length] Length of array to convert to string\r\n   * @returns {string}\r\n   */\n\n\n  toString(start = 0, length = this.view.length - start) {\n    //region Initial variables\n    let result = \"\"; //endregion\n    //region Check input parameters\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (start >= this.view.length || start < 0) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = 0;\n    } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n\n    if (length >= this.view.length || length < 0) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.view.length - start;\n    } //endregion\n    //region Convert array of bytes to string\n    // noinspection NonBlockStatementBodyJS\n\n\n    for (let i = start; i < start + length; i++) result += String.fromCharCode(this.view[i]); //endregion\n\n\n    return result;\n  } //**********************************************************************************\n  // noinspection FunctionTooLongJS\n\n  /**\r\n   * Initialize \"Stream\" object from existing hexdecimal string\r\n   * @param {string} hexString String to initialize from\r\n   */\n\n\n  fromHexString(hexString) {\n    //region Initial variables\n    const stringLength = hexString.length;\n    this.buffer = new ArrayBuffer(stringLength >> 1);\n    this.view = new Uint8Array(this.buffer);\n    const hexMap = new Map(); // noinspection MagicNumberJS\n\n    hexMap.set(\"0\", 0x00); // noinspection MagicNumberJS\n\n    hexMap.set(\"1\", 0x01); // noinspection MagicNumberJS\n\n    hexMap.set(\"2\", 0x02); // noinspection MagicNumberJS\n\n    hexMap.set(\"3\", 0x03); // noinspection MagicNumberJS\n\n    hexMap.set(\"4\", 0x04); // noinspection MagicNumberJS\n\n    hexMap.set(\"5\", 0x05); // noinspection MagicNumberJS\n\n    hexMap.set(\"6\", 0x06); // noinspection MagicNumberJS\n\n    hexMap.set(\"7\", 0x07); // noinspection MagicNumberJS\n\n    hexMap.set(\"8\", 0x08); // noinspection MagicNumberJS\n\n    hexMap.set(\"9\", 0x09); // noinspection MagicNumberJS\n\n    hexMap.set(\"A\", 0x0A); // noinspection MagicNumberJS\n\n    hexMap.set(\"a\", 0x0A); // noinspection MagicNumberJS\n\n    hexMap.set(\"B\", 0x0B); // noinspection MagicNumberJS\n\n    hexMap.set(\"b\", 0x0B); // noinspection MagicNumberJS\n\n    hexMap.set(\"C\", 0x0C); // noinspection MagicNumberJS\n\n    hexMap.set(\"c\", 0x0C); // noinspection MagicNumberJS\n\n    hexMap.set(\"D\", 0x0D); // noinspection MagicNumberJS\n\n    hexMap.set(\"d\", 0x0D); // noinspection MagicNumberJS\n\n    hexMap.set(\"E\", 0x0E); // noinspection MagicNumberJS\n\n    hexMap.set(\"e\", 0x0E); // noinspection MagicNumberJS\n\n    hexMap.set(\"F\", 0x0F); // noinspection MagicNumberJS\n\n    hexMap.set(\"f\", 0x0F);\n    let j = 0; // noinspection MagicNumberJS\n\n    let temp = 0x00; //endregion\n    //region Convert char-by-char\n\n    for (let i = 0; i < stringLength; i++) {\n      // noinspection NegatedIfStatementJS\n      if (!(i % 2)) {\n        // noinspection NestedFunctionCallJS\n        temp = hexMap.get(hexString.charAt(i)) << 4;\n      } else {\n        // noinspection NestedFunctionCallJS\n        temp |= hexMap.get(hexString.charAt(i));\n        this.view[j] = temp;\n        j++;\n      }\n    } //endregion\n\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Represent \"Stream\" object content as a hexdecimal string\r\n   * @param {number} [start=0] Start position to convert to string\r\n   * @param {number} [length=(this.view.length - start)] Length of array to convert to string\r\n   * @returns {string}\r\n   */\n\n\n  toHexString(start = 0, length = this.view.length - start) {\n    //region Initial variables\n    let result = \"\"; //endregion\n    //region Check input parameters\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (start >= this.view.length || start < 0) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = 0;\n    } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n\n    if (length >= this.view.length || length < 0) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.view.length - start;\n    } //endregion\n\n\n    for (let i = start; i < start + length; i++) {\n      // noinspection ChainedFunctionCallJS\n      const str = this.view[i].toString(16).toUpperCase(); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\n\n      result = result + (str.length == 1 ? \"0\" : \"\") + str;\n    }\n\n    return result;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Return copy of existing \"Stream\"\r\n   * @param {number} [start=0] Start position of the copy\r\n   * @param {number} [length=this.view.length] Length of the copy\r\n   * @returns {ByteStream}\r\n   */\n\n\n  copy(start = 0, length = this._buffer.byteLength - start) {\n    //region Check input parameters\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n    if (start === 0 && this._buffer.byteLength === 0) return new ByteStream(); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n    if (start < 0 || start > this._buffer.byteLength - 1) throw new Error(`Wrong start position: ${start}`); //endregion\n\n    const stream = new ByteStream();\n    stream._buffer = this._buffer.slice(start, start + length);\n    stream._view = new Uint8Array(stream._buffer);\n    return stream;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Return slice of existing \"Stream\"\r\n   * @param {number} [start=0] Start position of the slice\r\n   * @param {number} [end=this._buffer.byteLength] End position of the slice\r\n   * @returns {ByteStream}\r\n   */\n\n\n  slice(start = 0, end = this._buffer.byteLength) {\n    //region Check input parameters\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n    if (start === 0 && this._buffer.byteLength === 0) return new ByteStream(); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n    if (start < 0 || start > this._buffer.byteLength - 1) throw new Error(`Wrong start position: ${start}`); //endregion\n\n    const stream = new ByteStream();\n    stream._buffer = this._buffer.slice(start, end);\n    stream._view = new Uint8Array(stream._buffer);\n    return stream;\n  } //**********************************************************************************\n\n  /**\r\n   * Change size of existing \"Stream\"\r\n   * @param {!number} size Size for new \"Stream\"\r\n   */\n\n\n  realloc(size) {\n    //region Initial variables\n    const buffer = new ArrayBuffer(size);\n    const view = new Uint8Array(buffer); //endregion\n    //region Create a new ArrayBuffer content\n    // noinspection NonBlockStatementBodyJS\n\n    if (size > this._view.length) view.set(this._view);else {\n      // noinspection NestedFunctionCallJS\n      view.set(new Uint8Array(this._buffer, 0, size));\n    } //endregion\n    //region Initialize \"Stream\" with new \"ArrayBuffer\"\n\n    this._buffer = buffer.slice(0);\n    this._view = new Uint8Array(this._buffer); //endregion\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Append a new \"Stream\" content to the current \"Stream\"\r\n   * @param {ByteStream} stream A new \"stream\" to append to current \"stream\"\r\n   */\n\n\n  append(stream) {\n    //region Initial variables\n    const initialSize = this._buffer.byteLength;\n    const streamViewLength = stream._buffer.byteLength;\n\n    const copyView = stream._view.slice(); //endregion\n    //region Re-allocate current internal buffer\n\n\n    this.realloc(initialSize + streamViewLength); //endregion\n    //region Copy input stream content to a new place\n\n    this._view.set(copyView, initialSize); //endregion\n\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Insert \"Stream\" content to the current \"Stream\" at specific position\r\n   * @param {ByteStream} stream A new \"stream\" to insert to current \"stream\"\r\n   * @param {number} [start=0] Start position to insert to\r\n   * @param {number} [length]\r\n   * @returns {boolean}\r\n   */\n\n\n  insert(stream, start = 0, length = this._buffer.byteLength - start) {\n    //region Initial variables\n    // noinspection NonBlockStatementBodyJS\n    if (start > this._buffer.byteLength - 1) return false;\n\n    if (length > this._buffer.byteLength - start) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this._buffer.byteLength - start;\n    } //endregion\n    //region Check input variables\n\n\n    if (length > stream._buffer.byteLength) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = stream._buffer.byteLength;\n    } //endregion\n    //region Update content of the current stream\n    // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n\n    if (length == stream._buffer.byteLength) this._view.set(stream._view, start);else {\n      // noinspection NestedFunctionCallJS\n      this._view.set(stream._view.slice(0, length), start);\n    } //endregion\n\n    return true;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Check that two \"Stream\" objects has equal content\r\n   * @param {ByteStream} stream Stream to compare with\r\n   * @returns {boolean}\r\n   */\n\n\n  isEqual(stream) {\n    //region Check length of both buffers\n    // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n    if (this._buffer.byteLength != stream._buffer.byteLength) return false; //endregion\n    //region Compare each byte of both buffers\n\n    for (let i = 0; i < stream._buffer.byteLength; i++) {\n      // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n      if (this.view[i] != stream.view[i]) return false;\n    } //endregion\n\n\n    return true;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Check that current \"Stream\" objects has equal content with input \"Uint8Array\"\r\n   * @param {Uint8Array} view View to compare with\r\n   * @returns {boolean}\r\n   */\n\n\n  isEqualView(view) {\n    //region Check length of both buffers\n    // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n    if (view.length != this.view.length) return false; //endregion\n    //region Compare each byte of both buffers\n\n    for (let i = 0; i < view.length; i++) {\n      // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n      if (this.view[i] != view[i]) return false;\n    } //endregion\n\n\n    return true;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\n\n  /**\r\n   * Find any byte pattern in \"Stream\"\r\n   * @param {ByteStream} pattern Stream having pattern value\r\n   * @param {?number} [start] Start position to search from\r\n   * @param {?number} [length] Length of byte block to search at\r\n   * @param {boolean} [backward] Flag to search in backward order\r\n   * @returns {number}\r\n   */\n\n\n  findPattern(pattern, start = null, length = null, backward = false) {\n    //region Check input variables\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n    if (start == null) {\n      // noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\n      start = backward ? this.buffer.byteLength : 0;\n    }\n\n    if (start > this.buffer.byteLength) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = this.buffer.byteLength;\n    }\n\n    if (backward) {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = start;\n      }\n\n      if (length > start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = start;\n      }\n    } else {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      if (length > this.buffer.byteLength - start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n    } //endregion\n    //region Initial variables\n\n\n    const patternLength = pattern.buffer.byteLength; // noinspection NonBlockStatementBodyJS\n\n    if (patternLength > length) return -1; //endregion\n    //region Make a \"pre-read\" array for pattern\n\n    const patternArray = []; // noinspection NonBlockStatementBodyJS\n\n    for (let i = 0; i < patternLength; i++) patternArray.push(pattern.view[i]); //endregion\n    //region Search for pattern\n\n\n    for (let i = 0; i <= length - patternLength; i++) {\n      let equal = true; // noinspection ConditionalExpressionJS\n\n      const equalStart = backward ? start - patternLength - i : start + i;\n\n      for (let j = 0; j < patternLength; j++) {\n        // noinspection EqualityComparisonWithCoercionJS\n        if (this.view[j + equalStart] != patternArray[j]) {\n          equal = false; // noinspection BreakStatementJS\n\n          break;\n        }\n      }\n\n      if (equal) {\n        // noinspection ConditionalExpressionJS\n        return backward ? start - patternLength - i : start + patternLength + i; // Position after the pattern found\n      }\n    } //endregion\n\n\n    return -1;\n  } //**********************************************************************************\n  // noinspection OverlyComplexFunctionJS\n\n  /**\r\n   * Find first position of any pattern from input array\r\n   * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n   * @param {?number} [start] Start position to search from\r\n   * @param {?number} [length] Length of byte block to search at\r\n   * @param {boolean} [backward=false] Flag to search in backward order\r\n   * @returns {{id: number, position: number}}\r\n   */\n\n\n  findFirstIn(patterns, start = null, length = null, backward = false) {\n    //region Initial variables\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n    if (start == null) {\n      // noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\n      start = backward ? this.buffer.byteLength : 0;\n    }\n\n    if (start > this.buffer.byteLength) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = this.buffer.byteLength;\n    }\n\n    if (backward) {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = start;\n      }\n\n      if (length > start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = start;\n      }\n    } else {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      if (length > this.buffer.byteLength - start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n    } // noinspection ConditionalExpressionJS\n\n\n    const result = {\n      id: -1,\n      position: backward ? 0 : start + length,\n      length: 0\n    }; //endregion\n\n    for (let i = 0; i < patterns.length; i++) {\n      const position = this.findPattern(patterns[i], start, length, backward); // noinspection EqualityComparisonWithCoercionJS\n\n      if (position != -1) {\n        let valid = false;\n        const patternLength = patterns[i].length;\n\n        if (backward) {\n          // noinspection NonBlockStatementBodyJS\n          if (position - patternLength >= result.position - result.length) valid = true;\n        } else {\n          // noinspection NonBlockStatementBodyJS\n          if (position - patternLength <= result.position - result.length) valid = true;\n        }\n\n        if (valid) {\n          result.position = position;\n          result.id = i;\n          result.length = patternLength;\n        }\n      }\n    }\n\n    return result;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Find all positions of any pattern from input array\r\n   * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n   * @param {?number} [start] Start position to search from\r\n   * @param {?number} [length] Length of byte block to search at\r\n   * @returns {Array}\r\n   */\n\n\n  findAllIn(patterns, start = 0, length = this.buffer.byteLength - start) {\n    //region Initial variables\n    const result = []; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (start == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = 0;\n    } // noinspection NonBlockStatementBodyJS\n\n\n    if (start > this.buffer.byteLength - 1) return result; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (length == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.buffer.byteLength - start;\n    }\n\n    if (length > this.buffer.byteLength - start) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.buffer.byteLength - start;\n    }\n\n    let patternFound = {\n      id: -1,\n      position: start\n    }; //endregion\n    //region Find all accurences of patterns\n\n    do {\n      const position = patternFound.position;\n      patternFound = this.findFirstIn(patterns, patternFound.position, length); // noinspection EqualityComparisonWithCoercionJS\n\n      if (patternFound.id == -1) {\n        // noinspection BreakStatementJS\n        break;\n      } // noinspection AssignmentToFunctionParameterJS\n\n\n      length -= patternFound.position - position;\n      result.push({\n        id: patternFound.id,\n        position: patternFound.position\n      });\n    } while (true); // eslint-disable-line\n    //endregion\n\n\n    return result;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Find all positions of a pattern\r\n   * @param {ByteStream} pattern Stream having pattern value\r\n   * @param {?number} [start] Start position to search from\r\n   * @param {?number} [length] Length of byte block to search at\r\n   * @returns {Array|number} Array with all pattern positions or (-1) if failed\r\n   */\n\n\n  findAllPatternIn(pattern, start = 0, length = this.buffer.byteLength - start) {\n    //region Check input variables\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n    if (start == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = 0;\n    }\n\n    if (start > this.buffer.byteLength) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = this.buffer.byteLength;\n    } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n\n    if (length == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.buffer.byteLength - start;\n    }\n\n    if (length > this.buffer.byteLength - start) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.buffer.byteLength - start;\n    } //endregion\n    //region Initial variables\n\n\n    const result = [];\n    const patternLength = pattern.buffer.byteLength; // noinspection NonBlockStatementBodyJS\n\n    if (patternLength > length) return -1; //endregion\n    //region Make a \"pre-read\" array for pattern\n\n    const patternArray = Array.from(pattern.view); //endregion\n    //region Search for pattern\n\n    for (let i = 0; i <= length - patternLength; i++) {\n      let equal = true;\n      const equalStart = start + i;\n\n      for (let j = 0; j < patternLength; j++) {\n        // noinspection EqualityComparisonWithCoercionJS\n        if (this.view[j + equalStart] != patternArray[j]) {\n          equal = false; // noinspection BreakStatementJS\n\n          break;\n        }\n      }\n\n      if (equal) {\n        result.push(start + patternLength + i); // Position after the pattern found\n\n        i += patternLength - 1; // On next step of \"for\" we will have \"i++\"\n      }\n    } //endregion\n\n\n    return result;\n  } //**********************************************************************************\n  // noinspection OverlyComplexFunctionJS, FunctionTooLongJS\n\n  /**\r\n   * Find first position of data, not included in patterns from input array\r\n   * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n   * @param {?number} [start] Start position to search from\r\n   * @param {?number} [length] Length of byte block to search at\r\n   * @param {boolean} [backward=false] Flag to search in backward order\r\n   * @returns {{left: {id: number, position: *}, right: {id: number, position: number}, value: ByteStream}}\r\n   */\n\n\n  findFirstNotIn(patterns, start = null, length = null, backward = false) {\n    //region Initial variables\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n    if (start == null) {\n      // noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\n      start = backward ? this.buffer.byteLength : 0;\n    }\n\n    if (start > this.buffer.byteLength) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = this.buffer.byteLength;\n    }\n\n    if (backward) {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = start;\n      }\n\n      if (length > start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = start;\n      }\n    } else {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      if (length > this.buffer.byteLength - start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n    }\n\n    const result = {\n      left: {\n        id: -1,\n        position: start\n      },\n      right: {\n        id: -1,\n        position: 0\n      },\n      value: new ByteStream()\n    };\n    let currentLength = length; //endregion\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    while (currentLength > 0) {\n      //region Search for nearest \"pattern\"\n      // noinspection ConditionalExpressionJS\n      result.right = this.findFirstIn(patterns, backward ? start - length + currentLength : start + length - currentLength, currentLength, backward); //endregion\n      //region No pattern at all\n      // noinspection EqualityComparisonWithCoercionJS\n\n      if (result.right.id == -1) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = currentLength;\n\n        if (backward) {\n          // noinspection AssignmentToFunctionParameterJS\n          start -= length;\n        } else {\n          // noinspection AssignmentToFunctionParameterJS\n          start = result.left.position;\n        }\n\n        result.value = new ByteStream();\n        result.value._buffer = this._buffer.slice(start, start + length);\n        result.value._view = new Uint8Array(result.value._buffer); // noinspection BreakStatementJS\n\n        break;\n      } //endregion\n      //region Check distance between two patterns\n      // noinspection ConditionalExpressionJS, EqualityComparisonWithCoercionJS\n\n\n      if (result.right.position != (backward ? result.left.position - patterns[result.right.id].buffer.byteLength : result.left.position + patterns[result.right.id].buffer.byteLength)) {\n        if (backward) {\n          // noinspection AssignmentToFunctionParameterJS\n          start = result.right.position + patterns[result.right.id].buffer.byteLength; // noinspection AssignmentToFunctionParameterJS\n\n          length = result.left.position - result.right.position - patterns[result.right.id].buffer.byteLength;\n        } else {\n          // noinspection AssignmentToFunctionParameterJS\n          start = result.left.position; // noinspection AssignmentToFunctionParameterJS\n\n          length = result.right.position - result.left.position - patterns[result.right.id].buffer.byteLength;\n        }\n\n        result.value = new ByteStream();\n        result.value._buffer = this._buffer.slice(start, start + length);\n        result.value._view = new Uint8Array(result.value._buffer); // noinspection BreakStatementJS\n\n        break;\n      } //endregion\n      //region Store information about previous pattern\n\n\n      result.left = result.right; //endregion\n      //region Change current length\n\n      currentLength -= patterns[result.right.id]._buffer.byteLength; //endregion\n    } //region Swap \"patterns\" in case of backward order\n\n\n    if (backward) {\n      const temp = result.right;\n      result.right = result.left;\n      result.left = temp;\n    } //endregion\n\n\n    return result;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Find all positions of data, not included in patterns from input array\r\n   * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n   * @param {?number} [start] Start position to search from\r\n   * @param {?number} [length] Length of byte block to search at\r\n   * @returns {Array}\r\n   */\n\n\n  findAllNotIn(patterns, start = null, length = null) {\n    //region Initial variables\n    const result = []; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (start == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = 0;\n    } // noinspection NonBlockStatementBodyJS\n\n\n    if (start > this.buffer.byteLength - 1) return result; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (length == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.buffer.byteLength - start;\n    }\n\n    if (length > this.buffer.byteLength - start) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.buffer.byteLength - start;\n    }\n\n    let patternFound = {\n      left: {\n        id: -1,\n        position: start\n      },\n      right: {\n        id: -1,\n        position: start\n      },\n      value: new ByteStream()\n    }; //endregion\n    //region Find all accurences of patterns\n    // noinspection EqualityComparisonWithCoercionJS\n\n    do {\n      const position = patternFound.right.position;\n      patternFound = this.findFirstNotIn(patterns, patternFound.right.position, length); // noinspection AssignmentToFunctionParameterJS\n\n      length -= patternFound.right.position - position;\n      result.push({\n        left: {\n          id: patternFound.left.id,\n          position: patternFound.left.position\n        },\n        right: {\n          id: patternFound.right.id,\n          position: patternFound.right.position\n        },\n        value: patternFound.value\n      });\n    } while (patternFound.right.id != -1); //endregion\n\n\n    return result;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS\n\n  /**\r\n   * Find position of a sequence of any patterns from input array\r\n   * @param {Array.<ByteStream>} patterns Array of pattern to look for\r\n   * @param {?number} [start] Start position to search from\r\n   * @param {?number} [length] Length of byte block to search at\r\n   * @param {boolean} [backward=false] Flag to search in backward order\r\n   * @returns {*}\r\n   */\n\n\n  findFirstSequence(patterns, start = null, length = null, backward = false) {\n    //region Initial variables\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n    if (start == null) {\n      // noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\n      start = backward ? this.buffer.byteLength : 0;\n    }\n\n    if (start > this.buffer.byteLength) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = this.buffer.byteLength;\n    }\n\n    if (backward) {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = start;\n      }\n\n      if (length > start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = start;\n      }\n    } else {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      if (length > this.buffer.byteLength - start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n    } //endregion\n    //region Find first byte from sequence\n\n\n    const firstIn = this.skipNotPatterns(patterns, start, length, backward); // noinspection EqualityComparisonWithCoercionJS\n\n    if (firstIn == -1) {\n      return {\n        position: -1,\n        value: new ByteStream()\n      };\n    } //endregion\n    //region Find first byte not in sequence\n    // noinspection ConditionalExpressionJS\n\n\n    const firstNotIn = this.skipPatterns(patterns, firstIn, length - (backward ? start - firstIn : firstIn - start), backward); //endregion\n    //region Make output value\n\n    if (backward) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = firstNotIn; // noinspection AssignmentToFunctionParameterJS\n\n      length = firstIn - firstNotIn;\n    } else {\n      // noinspection AssignmentToFunctionParameterJS\n      start = firstIn; // noinspection AssignmentToFunctionParameterJS\n\n      length = firstNotIn - firstIn;\n    }\n\n    const value = new ByteStream();\n    value._buffer = this._buffer.slice(start, start + length);\n    value._view = new Uint8Array(value._buffer); //endregion\n\n    return {\n      position: firstNotIn,\n      value\n    };\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Find all positions of a sequence of any patterns from input array\r\n   * @param {Array.<ByteStream>} patterns Array of patterns to search for\r\n   * @param {?number} [start] Start position to search from\r\n   * @param {?number} [length] Length of byte block to search at\r\n   * @returns {Array}\r\n   */\n\n\n  findAllSequences(patterns, start = null, length = null) {\n    //region Initial variables\n    const result = []; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (start == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = 0;\n    } // noinspection NonBlockStatementBodyJS\n\n\n    if (start > this.buffer.byteLength - 1) return result; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (length == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.buffer.byteLength - start;\n    }\n\n    if (length > this.buffer.byteLength - start) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.buffer.byteLength - start;\n    }\n\n    let patternFound = {\n      position: start,\n      value: new ByteStream()\n    }; //endregion\n    //region Find all accurences of patterns\n    // noinspection EqualityComparisonWithCoercionJS\n\n    do {\n      const position = patternFound.position;\n      patternFound = this.findFirstSequence(patterns, patternFound.position, length); // noinspection EqualityComparisonWithCoercionJS\n\n      if (patternFound.position != -1) {\n        // noinspection AssignmentToFunctionParameterJS\n        length -= patternFound.position - position;\n        result.push({\n          position: patternFound.position,\n          value: patternFound.value\n        });\n      }\n    } while (patternFound.position != -1); //endregion\n\n\n    return result;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\n\n  /**\r\n   * Find all paired patterns in the stream\r\n   * @param {ByteStream} leftPattern Left pattern to search for\r\n   * @param {ByteStream} rightPattern Right pattern to search for\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @returns {Array}\r\n   */\n\n\n  findPairedPatterns(leftPattern, rightPattern, start = null, length = null) {\n    //region Initial variables\n    const result = []; // noinspection NonBlockStatementBodyJS\n\n    if (leftPattern.isEqual(rightPattern)) return result; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (start == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = 0;\n    } // noinspection NonBlockStatementBodyJS\n\n\n    if (start > this.buffer.byteLength - 1) return result; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (length == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.buffer.byteLength - start;\n    }\n\n    if (length > this.buffer.byteLength - start) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.buffer.byteLength - start;\n    }\n\n    let currentPositionLeft = 0; //endregion\n    //region Find all \"left patterns\" as sorted array\n\n    const leftPatterns = this.findAllPatternIn(leftPattern, start, length); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n    if (leftPatterns.length == 0) return result; //endregion\n    //region Find all \"right patterns\" as sorted array\n\n    const rightPatterns = this.findAllPatternIn(rightPattern, start, length); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n    if (rightPatterns.length == 0) return result; //endregion\n    //region Combine patterns\n\n    while (currentPositionLeft < leftPatterns.length) {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS\n      if (rightPatterns.length == 0) {\n        // noinspection BreakStatementJS\n        break;\n      } // noinspection EqualityComparisonWithCoercionJS\n\n\n      if (leftPatterns[0] == rightPatterns[0]) {\n        // Possible situation when one pattern is a part of another\n        // For example \"stream\" and \"endstream\"\n        // In case when we have only \"endstream\" in fact \"stream\" will be also found at the same position\n        // (position of the pattern is an index AFTER the pattern)\n        result.push({\n          left: leftPatterns[0],\n          right: rightPatterns[0]\n        });\n        leftPatterns.splice(0, 1);\n        rightPatterns.splice(0, 1); // noinspection ContinueStatementJS\n\n        continue;\n      }\n\n      if (leftPatterns[currentPositionLeft] > rightPatterns[0]) {\n        // noinspection BreakStatementJS\n        break;\n      }\n\n      while (leftPatterns[currentPositionLeft] < rightPatterns[0]) {\n        currentPositionLeft++;\n\n        if (currentPositionLeft >= leftPatterns.length) {\n          // noinspection BreakStatementJS\n          break;\n        }\n      }\n\n      result.push({\n        left: leftPatterns[currentPositionLeft - 1],\n        right: rightPatterns[0]\n      });\n      leftPatterns.splice(currentPositionLeft - 1, 1);\n      rightPatterns.splice(0, 1);\n      currentPositionLeft = 0;\n    } //endregion\n    //region Sort result\n\n\n    result.sort((a, b) => a.left - b.left); //endregion\n\n    return result;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\n\n  /**\r\n   * Find all paired patterns in the stream\r\n   * @param {Array.<ByteStream>} inputLeftPatterns Array of left patterns to search for\r\n   * @param {Array.<ByteStream>} inputRightPatterns Array of right patterns to search for\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @returns {Array}\r\n   */\n\n\n  findPairedArrays(inputLeftPatterns, inputRightPatterns, start = null, length = null) {\n    //region Initial variables\n    const result = []; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (start == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = 0;\n    } // noinspection NonBlockStatementBodyJS\n\n\n    if (start > this.buffer.byteLength - 1) return result; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (length == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.buffer.byteLength - start;\n    }\n\n    if (length > this.buffer.byteLength - start) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.buffer.byteLength - start;\n    }\n\n    let currentPositionLeft = 0; //endregion\n    //region Find all \"left patterns\" as sorted array\n\n    const leftPatterns = this.findAllIn(inputLeftPatterns, start, length); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n    if (leftPatterns.length == 0) return result; //endregion\n    //region Find all \"right patterns\" as sorted array\n\n    const rightPatterns = this.findAllIn(inputRightPatterns, start, length); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n    if (rightPatterns.length == 0) return result; //endregion\n    //region Combine patterns\n\n    while (currentPositionLeft < leftPatterns.length) {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS\n      if (rightPatterns.length == 0) {\n        // noinspection BreakStatementJS\n        break;\n      } // noinspection EqualityComparisonWithCoercionJS\n\n\n      if (leftPatterns[0].position == rightPatterns[0].position) {\n        // Possible situation when one pattern is a part of another\n        // For example \"stream\" and \"endstream\"\n        // In case when we have only \"endstream\" in fact \"stream\" will be also found at the same position\n        // (position of the pattern is an index AFTER the pattern)\n        result.push({\n          left: leftPatterns[0],\n          right: rightPatterns[0]\n        });\n        leftPatterns.splice(0, 1);\n        rightPatterns.splice(0, 1); // noinspection ContinueStatementJS\n\n        continue;\n      }\n\n      if (leftPatterns[currentPositionLeft].position > rightPatterns[0].position) {\n        // noinspection BreakStatementJS\n        break;\n      }\n\n      while (leftPatterns[currentPositionLeft].position < rightPatterns[0].position) {\n        currentPositionLeft++;\n\n        if (currentPositionLeft >= leftPatterns.length) {\n          // noinspection BreakStatementJS\n          break;\n        }\n      }\n\n      result.push({\n        left: leftPatterns[currentPositionLeft - 1],\n        right: rightPatterns[0]\n      });\n      leftPatterns.splice(currentPositionLeft - 1, 1);\n      rightPatterns.splice(0, 1);\n      currentPositionLeft = 0;\n    } //endregion\n    //region Sort result\n\n\n    result.sort((a, b) => a.left.position - b.left.position); //endregion\n\n    return result;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS, FunctionTooLongJS\n\n  /**\r\n   * Replace one patter with other\r\n   * @param {ByteStream} searchPattern The pattern to search for\r\n   * @param {ByteStream} replacePattern The pattern to replace initial pattern\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @param {Array|null} [findAllResult=null] Pre-calculated results of \"findAllIn\"\r\n   * @returns {*}\r\n   */\n\n\n  replacePattern(searchPattern, replacePattern, start = null, length = null, findAllResult = null) {\n    //region Initial variables\n    let result;\n    let i;\n    const output = {\n      status: -1,\n      searchPatternPositions: [],\n      replacePatternPositions: []\n    }; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (start == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = 0;\n    } // noinspection NonBlockStatementBodyJS\n\n\n    if (start > this.buffer.byteLength - 1) return false; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (length == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.buffer.byteLength - start;\n    }\n\n    if (length > this.buffer.byteLength - start) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.buffer.byteLength - start;\n    } //endregion\n    //region Find a pattern to search for\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n\n    if (findAllResult == null) {\n      result = this.findAllIn([searchPattern], start, length); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n      if (result.length == 0) return output;\n    } else result = findAllResult; // noinspection NestedFunctionCallJS\n\n\n    output.searchPatternPositions.push(...Array.from(result, element => element.position)); //endregion\n    //region Variables for new buffer initialization\n\n    const patternDifference = searchPattern.buffer.byteLength - replacePattern.buffer.byteLength;\n    const changedBuffer = new ArrayBuffer(this.view.length - result.length * patternDifference);\n    const changedView = new Uint8Array(changedBuffer); //endregion\n    //region Copy data from 0 to start\n    // noinspection NestedFunctionCallJS\n\n    changedView.set(new Uint8Array(this.buffer, 0, start)); //endregion\n    //region Replace pattern\n\n    for (i = 0; i < result.length; i++) {\n      //region Initial variables\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\n      const currentPosition = i == 0 ? start : result[i - 1].position; //endregion\n      //region Copy bytes other then search pattern\n      // noinspection NestedFunctionCallJS\n\n      changedView.set(new Uint8Array(this.buffer, currentPosition, result[i].position - searchPattern.buffer.byteLength - currentPosition), currentPosition - i * patternDifference); //endregion\n      //region Put replace pattern in a new buffer\n\n      changedView.set(replacePattern.view, result[i].position - searchPattern.buffer.byteLength - i * patternDifference);\n      output.replacePatternPositions.push(result[i].position - searchPattern.buffer.byteLength - i * patternDifference); //endregion\n    } //endregion\n    //region Copy data from the end of old buffer\n\n\n    i--; // noinspection NestedFunctionCallJS\n\n    changedView.set(new Uint8Array(this.buffer, result[i].position, this.buffer.byteLength - result[i].position), result[i].position - searchPattern.buffer.byteLength + replacePattern.buffer.byteLength - i * patternDifference); //endregion\n    //region Re-initialize existing buffer\n\n    this.buffer = changedBuffer;\n    this.view = new Uint8Array(this.buffer); //endregion\n\n    output.status = 1;\n    return output;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\n\n  /**\r\n   * Skip any pattern from input array\r\n   * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @param {boolean} [backward=false] Flag to search in backward order\r\n   * @returns {*}\r\n   */\n\n\n  skipPatterns(patterns, start = null, length = null, backward = false) {\n    //region Initial variables\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n    if (start == null) {\n      // noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\n      start = backward ? this.buffer.byteLength : 0;\n    }\n\n    if (start > this.buffer.byteLength) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = this.buffer.byteLength;\n    }\n\n    if (backward) {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = start;\n      }\n\n      if (length > start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = start;\n      }\n    } else {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      if (length > this.buffer.byteLength - start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n    }\n\n    let result = start; //endregion\n    //region Search for pattern\n\n    for (let k = 0; k < patterns.length; k++) {\n      const patternLength = patterns[k].buffer.byteLength; // noinspection ConditionalExpressionJS\n\n      const equalStart = backward ? result - patternLength : result;\n      let equal = true;\n\n      for (let j = 0; j < patternLength; j++) {\n        // noinspection EqualityComparisonWithCoercionJS\n        if (this.view[j + equalStart] != patterns[k].view[j]) {\n          equal = false; // noinspection BreakStatementJS\n\n          break;\n        }\n      }\n\n      if (equal) {\n        k = -1;\n\n        if (backward) {\n          result -= patternLength; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n          if (result <= 0) return result;\n        } else {\n          result += patternLength; // noinspection NonBlockStatementBodyJS\n\n          if (result >= start + length) return result;\n        }\n      }\n    } //endregion\n\n\n    return result;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleLoopsJS, OverlyComplexFunctionJS, FunctionTooLongJS\n\n  /**\r\n   * Skip any pattern not from input array\r\n   * @param {Array.<ByteStream>} patterns Array with patterns which should not be ommited\r\n   * @param start\r\n   * @param length\r\n   * @param backward\r\n   * @returns {number}\r\n   */\n\n\n  skipNotPatterns(patterns, start = null, length = null, backward = false) {\n    //region Initial variables\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n    if (start == null) {\n      // noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\n      start = backward ? this.buffer.byteLength : 0;\n    }\n\n    if (start > this.buffer.byteLength) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = this.buffer.byteLength;\n    }\n\n    if (backward) {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = start;\n      }\n\n      if (length > start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = start;\n      }\n    } else {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n      if (length == null) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n\n      if (length > this.buffer.byteLength - start) {\n        // noinspection AssignmentToFunctionParameterJS\n        length = this.buffer.byteLength - start;\n      }\n    }\n\n    let result = -1; //endregion\n    //region Search for pattern\n\n    for (let i = 0; i < length; i++) {\n      for (let k = 0; k < patterns.length; k++) {\n        const patternLength = patterns[k].buffer.byteLength; // noinspection ConditionalExpressionJS\n\n        const equalStart = backward ? start - i - patternLength : start + i;\n        let equal = true;\n\n        for (let j = 0; j < patternLength; j++) {\n          // noinspection EqualityComparisonWithCoercionJS\n          if (this.view[j + equalStart] != patterns[k].view[j]) {\n            equal = false; // noinspection BreakStatementJS\n\n            break;\n          }\n        }\n\n        if (equal) {\n          // noinspection ConditionalExpressionJS\n          result = backward ? start - i : start + i; // Exact position of pattern found\n          // noinspection BreakStatementJS\n\n          break;\n        }\n      } // noinspection EqualityComparisonWithCoercionJS\n\n\n      if (result != -1) {\n        // noinspection BreakStatementJS\n        break;\n      }\n    } //endregion\n\n\n    return result;\n  } //**********************************************************************************\n\n\n} //**************************************************************************************\n\nexport class SeqStream {\n  //**********************************************************************************\n\n  /**\r\n   * Constructor for \"SeqStream\" class\r\n   * @param {{[stream]: ByteStream, [length]: number, [backward]: boolean, [start]: number, [appendBlock]: number}} parameters\r\n   */\n  constructor(parameters = {}) {\n    /**\r\n     * Major stream\r\n     * @type {ByteStream}\r\n     */\n    this.stream = new ByteStream();\n    /**\r\n     * Length of the major stream\r\n     * @type {number}\r\n     */\n\n    this._length = 0;\n    /**\r\n     * Flag to search in backward direction\r\n     * @type {boolean}\r\n     */\n\n    this.backward = false;\n    /**\r\n     * Start position to search\r\n     * @type {number}\r\n     */\n\n    this._start = 0;\n    /**\r\n     * Length of a block when append information to major stream\r\n     * @type {number}\r\n     */\n\n    this.appendBlock = 0;\n    this.prevLength = 0;\n    this.prevStart = 0;\n\n    for (const key of Object.keys(parameters)) {\n      switch (key) {\n        case \"stream\":\n          this.stream = parameters.stream;\n          break;\n\n        case \"backward\":\n          this.backward = parameters.backward; // noinspection JSUnusedGlobalSymbols\n\n          this._start = this.stream.buffer.byteLength;\n          break;\n\n        case \"length\":\n          // noinspection JSUnusedGlobalSymbols\n          this._length = parameters.length;\n          break;\n\n        case \"start\":\n          // noinspection JSUnusedGlobalSymbols\n          this._start = parameters.start;\n          break;\n\n        case \"appendBlock\":\n          this.appendBlock = parameters.appendBlock;\n          break;\n\n        case \"view\":\n          this.stream = new ByteStream({\n            view: parameters.view\n          });\n          break;\n\n        case \"buffer\":\n          this.stream = new ByteStream({\n            buffer: parameters.buffer\n          });\n          break;\n\n        case \"string\":\n          this.stream = new ByteStream({\n            string: parameters.string\n          });\n          break;\n\n        case \"hexstring\":\n          this.stream = new ByteStream({\n            hexstring: parameters.hexstring\n          });\n          break;\n\n        default:\n      }\n    }\n  } //**********************************************************************************\n\n  /**\r\n   * Setter for \"stream\" property\r\n   * @param {ByteStream} value\r\n   */\n\n\n  set stream(value) {\n    this._stream = value;\n    this.prevLength = this._length; // noinspection JSUnusedGlobalSymbols\n\n    this._length = value._buffer.byteLength;\n    this.prevStart = this._start; // noinspection JSUnusedGlobalSymbols\n\n    this._start = 0;\n  } //**********************************************************************************\n\n  /**\r\n   * Getter for \"stream\" property\r\n   * @returns {ByteStream}\r\n   */\n\n\n  get stream() {\n    return this._stream;\n  } //**********************************************************************************\n\n  /**\r\n   * Setter for \"length\" property\r\n   * @param {number} value\r\n   */\n\n\n  set length(value) {\n    this.prevLength = this._length; // noinspection JSUnusedGlobalSymbols\n\n    this._length = value;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Getter for \"length\" property\r\n   * @returns {number}\r\n   */\n\n\n  get length() {\n    // noinspection NonBlockStatementBodyJS\n    if (this.appendBlock) return this.start;\n    return this._length;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Setter for \"start\" property\r\n   * @param {number} value\r\n   */\n\n\n  set start(value) {\n    // noinspection NonBlockStatementBodyJS\n    if (value > this.stream.buffer.byteLength) return; //region Initialization of \"prev\" internal variables\n\n    this.prevStart = this._start;\n    this.prevLength = this._length; //endregion\n    // noinspection JSUnusedGlobalSymbols, ConditionalExpressionJS\n\n    this._length -= this.backward ? this._start - value : value - this._start; // noinspection JSUnusedGlobalSymbols\n\n    this._start = value;\n  } //**********************************************************************************\n\n  /**\r\n   * Getter for \"start\" property\r\n   * @returns {number}\r\n   */\n\n\n  get start() {\n    return this._start;\n  } //**********************************************************************************\n\n  /**\r\n   * Return ArrayBuffer with having value of existing SeqStream length\r\n   * @return {ArrayBuffer}\r\n   */\n\n\n  get buffer() {\n    return this._stream._buffer.slice(0, this._length);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Reset current position of the \"SeqStream\"\r\n   */\n\n\n  resetPosition() {\n    // noinspection JSUnusedGlobalSymbols\n    this._start = this.prevStart; // noinspection JSUnusedGlobalSymbols\n\n    this._length = this.prevLength;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Find any byte pattern in \"ByteStream\"\r\n   * @param {ByteStream} pattern Stream having pattern value\r\n   * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n   * @returns {number}\r\n   */\n\n\n  findPattern(pattern, gap = null) {\n    //region Initial variables\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n    if (gap == null || gap > this.length) {\n      // noinspection AssignmentToFunctionParameterJS\n      gap = this.length;\n    } //endregion\n    //region Find pattern\n\n\n    const result = this.stream.findPattern(pattern, this.start, this.length, this.backward); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n    if (result == -1) return result;\n\n    if (this.backward) {\n      // noinspection NonBlockStatementBodyJS\n      if (result < this.start - pattern.buffer.byteLength - gap) return -1;\n    } else {\n      // noinspection NonBlockStatementBodyJS\n      if (result > this.start + pattern.buffer.byteLength + gap) return -1;\n    } //endregion\n    //region Create new values\n\n\n    this.start = result; //endregion ;\n\n    return result;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Find first position of any pattern from input array\r\n   * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n   * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n   * @returns {{id: number, position: number}}\r\n   */\n\n\n  findFirstIn(patterns, gap = null) {\n    //region Initial variables\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n    if (gap == null || gap > this.length) {\n      // noinspection AssignmentToFunctionParameterJS\n      gap = this.length;\n    } //endregion\n    //region Search for patterns\n\n\n    const result = this.stream.findFirstIn(patterns, this.start, this.length, this.backward); // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n    if (result.id == -1) return result;\n\n    if (this.backward) {\n      if (result.position < this.start - patterns[result.id].buffer.byteLength - gap) {\n        // noinspection ConditionalExpressionJS\n        return {\n          id: -1,\n          position: this.backward ? 0 : this.start + this.length\n        };\n      }\n    } else {\n      if (result.position > this.start + patterns[result.id].buffer.byteLength + gap) {\n        // noinspection ConditionalExpressionJS\n        return {\n          id: -1,\n          position: this.backward ? 0 : this.start + this.length\n        };\n      }\n    } //endregion\n    //region Create new values\n\n\n    this.start = result.position; //endregion ;\n\n    return result;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Find all positions of any pattern from input array\r\n   * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n   * @returns {Array}\r\n   */\n\n\n  findAllIn(patterns) {\n    // In case of \"backward order\" the start position is at the end on stream.\n    // In case of \"normal order\" the start position is at the begging of the stream.\n    // But in fact for search for all patterns we need to have start position in \"normal order\".\n    // noinspection ConditionalExpressionJS\n    const start = this.backward ? this.start - this.length : this.start;\n    return this.stream.findAllIn(patterns, start, this.length);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS\n\n  /**\r\n   * Find first position of data, not included in patterns from input array\r\n   * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n   * @param {?number} gap Maximum gap between start position and position of nearest object\r\n   * @returns {*}\r\n   */\n\n\n  findFirstNotIn(patterns, gap = null) {\n    //region Initial variables\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n    if (gap == null || gap > this._length) {\n      // noinspection AssignmentToFunctionParameterJS\n      gap = this._length;\n    } //endregion\n    //region Search for patterns\n\n\n    const result = this._stream.findFirstNotIn(patterns, this._start, this._length, this.backward); // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n\n    if (result.left.id == -1 && result.right.id == -1) return result;\n\n    if (this.backward) {\n      // noinspection EqualityComparisonWithCoercionJS\n      if (result.right.id != -1) {\n        if (result.right.position < this._start - patterns[result.right.id]._buffer.byteLength - gap) {\n          return {\n            left: {\n              id: -1,\n              position: this._start\n            },\n            right: {\n              id: -1,\n              position: 0\n            },\n            value: new ByteStream()\n          };\n        }\n      }\n    } else {\n      // noinspection EqualityComparisonWithCoercionJS\n      if (result.left.id != -1) {\n        if (result.left.position > this._start + patterns[result.left.id]._buffer.byteLength + gap) {\n          return {\n            left: {\n              id: -1,\n              position: this._start\n            },\n            right: {\n              id: -1,\n              position: 0\n            },\n            value: new ByteStream()\n          };\n        }\n      }\n    } //endregion\n    //region Create new values\n\n\n    if (this.backward) {\n      // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n      if (result.left.id == -1) this.start = 0;else this.start = result.left.position;\n    } else {\n      // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n      if (result.right.id == -1) this.start = this._start + this._length;else this.start = result.right.position;\n    } //endregion ;\n\n\n    return result;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Find all positions of data, not included in patterns from input array\r\n   * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n   * @returns {Array}\r\n   */\n\n\n  findAllNotIn(patterns) {\n    // In case of \"backward order\" the start position is at the end on stream.\n    // In case of \"normal order\" the start position is at the begging of the stream.\n    // But in fact for search for all patterns we need to have start position in \"normal order\".\n    // noinspection ConditionalExpressionJS\n    const start = this.backward ? this._start - this._length : this._start;\n    return this._stream.findAllNotIn(patterns, start, this._length);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Find position of a sequence of any patterns from input array\r\n   * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n   * @param {?number} [length] Length to search sequence for\r\n   * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n   * @returns {*}\r\n   */\n\n\n  findFirstSequence(patterns, length = null, gap = null) {\n    //region Initial variables\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n    if (length == null || length > this._length) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this._length;\n    } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n\n    if (gap == null || gap > length) {\n      // noinspection AssignmentToFunctionParameterJS\n      gap = length;\n    } //endregion\n    //region Search for sequence\n\n\n    const result = this._stream.findFirstSequence(patterns, this._start, length, this.backward); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n\n    if (result.value.buffer.byteLength == 0) return result;\n\n    if (this.backward) {\n      if (result.position < this._start - result.value._buffer.byteLength - gap) {\n        return {\n          position: -1,\n          value: new ByteStream()\n        };\n      }\n    } else {\n      if (result.position > this._start + result.value._buffer.byteLength + gap) {\n        return {\n          position: -1,\n          value: new ByteStream()\n        };\n      }\n    } //endregion\n    //region Create new values\n\n\n    this.start = result.position; //endregion ;\n\n    return result;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Find position of a sequence of any patterns from input array\r\n   * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n   * @returns {Array}\r\n   */\n\n\n  findAllSequences(patterns) {\n    // In case of \"backward order\" the start position is at the end on stream.\n    // In case of \"normal order\" the start position is at the begging of the stream.\n    // But in fact for search for all patterns we need to have start position in \"normal order\".\n    // noinspection ConditionalExpressionJS\n    const start = this.backward ? this.start - this.length : this.start;\n    return this.stream.findAllSequences(patterns, start, this.length);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Find all paired patterns in the stream\r\n   * @param {ByteStream} leftPattern Left pattern to search for\r\n   * @param {ByteStream} rightPattern Right pattern to search for\r\n   * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n   * @returns {Array}\r\n   */\n\n\n  findPairedPatterns(leftPattern, rightPattern, gap = null) {\n    //region Initial variables\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n    if (gap == null || gap > this.length) {\n      // noinspection AssignmentToFunctionParameterJS\n      gap = this.length;\n    } //endregion\n    // In case of \"backward order\" the start position is at the end on stream.\n    // In case of \"normal order\" the start position is at the begging of the stream.\n    // But in fact for search for all patterns we need to have start position in \"normal order\".\n    // noinspection ConditionalExpressionJS\n\n\n    const start = this.backward ? this.start - this.length : this.start; //region Search for patterns\n\n    const result = this.stream.findPairedPatterns(leftPattern, rightPattern, start, this.length);\n\n    if (result.length) {\n      if (this.backward) {\n        // noinspection NonBlockStatementBodyJS\n        if (result[0].right < this.start - rightPattern.buffer.byteLength - gap) return [];\n      } else {\n        // noinspection NonBlockStatementBodyJS\n        if (result[0].left > this.start + leftPattern.buffer.byteLength + gap) return [];\n      }\n    } //endregion\n\n\n    return result;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Find all paired patterns in the stream\r\n   * @param {Array.<ByteStream>} leftPatterns Array of left patterns to search for\r\n   * @param {Array.<ByteStream>} rightPatterns Array of right patterns to search for\r\n   * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n   * @returns {Array}\r\n   */\n\n\n  findPairedArrays(leftPatterns, rightPatterns, gap = null) {\n    //region Initial variables\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n    if (gap == null || gap > this.length) {\n      // noinspection AssignmentToFunctionParameterJS\n      gap = this.length;\n    } //endregion\n    // In case of \"backward order\" the start position is at the end on stream.\n    // In case of \"normal order\" the start position is at the begging of the stream.\n    // But in fact for search for all patterns we need to have start position in \"normal order\".\n    // noinspection ConditionalExpressionJS\n\n\n    const start = this.backward ? this.start - this.length : this.start; //region Search for patterns\n\n    const result = this.stream.findPairedArrays(leftPatterns, rightPatterns, start, this.length);\n\n    if (result.length) {\n      if (this.backward) {\n        // noinspection NonBlockStatementBodyJS\n        if (result[0].right.position < this.start - rightPatterns[result[0].right.id].buffer.byteLength - gap) return [];\n      } else {\n        // noinspection NonBlockStatementBodyJS\n        if (result[0].left.position > this.start + leftPatterns[result[0].left.id].buffer.byteLength + gap) return [];\n      }\n    } //endregion\n\n\n    return result;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Replace one patter with other\r\n   * @param {ByteStream} searchPattern The pattern to search for\r\n   * @param {ByteStream} replacePattern The pattern to replace initial pattern\r\n   * @returns {*}\r\n   */\n\n\n  replacePattern(searchPattern, replacePattern) {\n    // In case of \"backward order\" the start position is at the end on stream.\n    // In case of \"normal order\" the start position is at the begging of the stream.\n    // But in fact for search for all patterns we need to have start position in \"normal order\".\n    // noinspection ConditionalExpressionJS\n    const start = this.backward ? this.start - this.length : this.start;\n    return this.stream.replacePattern(searchPattern, replacePattern, start, this.length);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Skip of any pattern from input array\r\n   * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n   * @returns {*}\r\n   */\n\n\n  skipPatterns(patterns) {\n    const result = this.stream.skipPatterns(patterns, this.start, this.length, this.backward); //region Create new values\n\n    this.start = result; //endregion ;\n\n    return result;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Skip of any pattern from input array\r\n   * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n   * @returns {number}\r\n   */\n\n\n  skipNotPatterns(patterns) {\n    const result = this.stream.skipNotPatterns(patterns, this.start, this.length, this.backward); // noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n\n    if (result == -1) return -1; //region Create new values\n\n    this.start = result; //endregion ;\n\n    return result;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Append a new \"Stream\" content to the current \"Stream\"\r\n   * @param {ByteStream} stream A new \"stream\" to append to current \"stream\"\r\n   */\n\n\n  append(stream) {\n    if (this._start + stream._buffer.byteLength > this._stream._buffer.byteLength) {\n      if (stream._buffer.byteLength > this.appendBlock) {\n        // noinspection MagicNumberJS\n        this.appendBlock = stream._buffer.byteLength + 1000;\n      }\n\n      this._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\n    }\n\n    this._stream._view.set(stream._view, this._start);\n\n    this._length += stream._buffer.byteLength * 2;\n    this.start = this._start + stream._buffer.byteLength;\n    this.prevLength -= stream._buffer.byteLength * 2;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Append a \"view\" content to the current \"Stream\"\r\n   * @param {Uint8Array} view A new \"view\" to append to current \"stream\"\r\n   */\n\n\n  appendView(view) {\n    if (this._start + view.length > this._stream._buffer.byteLength) {\n      if (view.length > this.appendBlock) {\n        // noinspection MagicNumberJS\n        this.appendBlock = view.length + 1000;\n      }\n\n      this._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\n    }\n\n    this._stream._view.set(view, this._start);\n\n    this._length += view.length * 2;\n    this.start = this._start + view.length;\n    this.prevLength -= view.length * 2;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Append a new char to the current \"Stream\"\r\n   * @param {number} char A new char to append to current \"stream\"\r\n   */\n\n\n  appendChar(char) {\n    if (this._start + 1 > this._stream._buffer.byteLength) {\n      // noinspection ConstantOnLefSideOfComparisonJS\n      if (1 > this.appendBlock) {\n        // noinspection MagicNumberJS\n        this.appendBlock = 1000;\n      }\n\n      this._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\n    }\n\n    this._stream._view[this._start] = char;\n    this._length += 2;\n    this.start = this._start + 1;\n    this.prevLength -= 2;\n  } //**********************************************************************************\n  // noinspection FunctionNamingConventionJS\n\n  /**\r\n   * Append a new number to the current \"Stream\"\r\n   * @param {number} number A new unsigned 16-bit integer to append to current \"stream\"\r\n   */\n\n\n  appendUint16(number) {\n    if (this._start + 2 > this._stream._buffer.byteLength) {\n      // noinspection ConstantOnLefSideOfComparisonJS\n      if (2 > this.appendBlock) {\n        // noinspection MagicNumberJS\n        this.appendBlock = 1000;\n      }\n\n      this._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\n    }\n\n    const value = new Uint16Array([number]);\n    const view = new Uint8Array(value.buffer);\n    this._stream._view[this._start] = view[1];\n    this._stream._view[this._start + 1] = view[0];\n    this._length += 4;\n    this.start = this._start + 2;\n    this.prevLength -= 4;\n  } //**********************************************************************************\n  // noinspection FunctionNamingConventionJS\n\n  /**\r\n   * Append a new number to the current \"Stream\"\r\n   * @param {number} number A new unsigned 24-bit integer to append to current \"stream\"\r\n   */\n\n\n  appendUint24(number) {\n    if (this._start + 3 > this._stream._buffer.byteLength) {\n      // noinspection ConstantOnLefSideOfComparisonJS\n      if (3 > this.appendBlock) {\n        // noinspection MagicNumberJS\n        this.appendBlock = 1000;\n      }\n\n      this._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\n    }\n\n    const value = new Uint32Array([number]);\n    const view = new Uint8Array(value.buffer);\n    this._stream._view[this._start] = view[2];\n    this._stream._view[this._start + 1] = view[1];\n    this._stream._view[this._start + 2] = view[0];\n    this._length += 6;\n    this.start = this._start + 3;\n    this.prevLength -= 6;\n  } //**********************************************************************************\n  // noinspection FunctionNamingConventionJS\n\n  /**\r\n   * Append a new number to the current \"Stream\"\r\n   * @param {number} number A new unsigned 32-bit integer to append to current \"stream\"\r\n   */\n\n\n  appendUint32(number) {\n    if (this._start + 4 > this._stream._buffer.byteLength) {\n      // noinspection ConstantOnLefSideOfComparisonJS\n      if (4 > this.appendBlock) {\n        // noinspection MagicNumberJS\n        this.appendBlock = 1000;\n      }\n\n      this._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\n    }\n\n    const value = new Uint32Array([number]);\n    const view = new Uint8Array(value.buffer);\n    this._stream._view[this._start] = view[3];\n    this._stream._view[this._start + 1] = view[2];\n    this._stream._view[this._start + 2] = view[1];\n    this._stream._view[this._start + 3] = view[0];\n    this._length += 8;\n    this.start = this._start + 4;\n    this.prevLength -= 8;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Get a block of data\r\n   * @param {number} size Size of the data block to get\r\n   * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n   * @returns {Array}\r\n   */\n\n\n  getBlock(size, changeLength = true) {\n    //region Check input parameters\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n    if (this._length <= 0) return [];\n\n    if (this._length < size) {\n      // noinspection AssignmentToFunctionParameterJS\n      size = this._length;\n    } //endregion\n    //region Initial variables\n\n\n    let result; //endregion\n    //region Getting result depends on \"backward\" flag\n\n    if (this.backward) {\n      const buffer = this._stream._buffer.slice(this._length - size, this._length);\n\n      const view = new Uint8Array(buffer);\n      result = new Array(size); // noinspection NonBlockStatementBodyJS\n\n      for (let i = 0; i < size; i++) result[size - 1 - i] = view[i];\n    } else {\n      const buffer = this._stream._buffer.slice(this._start, this._start + size); // noinspection NestedFunctionCallJS\n\n\n      result = Array.from(new Uint8Array(buffer));\n    } //endregion\n    //region Change \"length\" value if needed\n\n\n    if (changeLength) {\n      // noinspection ConditionalExpressionJS\n      this.start += this.backward ? -1 * size : size;\n    } //endregion\n\n\n    return result;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\n\n  /**\r\n   * Get 2-byte unsigned integer value\r\n   * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n   * @returns {number}\r\n   */\n\n\n  getUint16(changeLength = true) {\n    const block = this.getBlock(2, changeLength); //region Check posibility for convertion\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n    if (block.length < 2) return 0; //endregion\n    //region Convert byte array to \"Uint16Array\" value\n\n    const value = new Uint16Array(1);\n    const view = new Uint8Array(value.buffer);\n    view[0] = block[1];\n    view[1] = block[0]; //endregion\n\n    return value[0];\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\n\n  /**\r\n   * Get 2-byte signed integer value\r\n   * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n   * @returns {number}\r\n   */\n\n\n  getInt16(changeLength = true) {\n    const block = this.getBlock(2, changeLength); //region Check posibility for convertion\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n    if (block.length < 2) return 0; //endregion\n    //region Convert byte array to \"Int16Array\" value\n\n    const value = new Int16Array(1);\n    const view = new Uint8Array(value.buffer);\n    view[0] = block[1];\n    view[1] = block[0]; //endregion\n\n    return value[0];\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\n\n  /**\r\n   * Get 3-byte unsigned integer value\r\n   * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n   * @returns {number}\r\n   */\n\n\n  getUint24(changeLength = true) {\n    const block = this.getBlock(3, changeLength); //region Check posibility for convertion\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n    if (block.length < 3) return 0; //endregion\n    //region Convert byte array to \"Uint32Array\" value\n\n    const value = new Uint32Array(1);\n    const view = new Uint8Array(value.buffer); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n    for (let i = 3; i >= 1; i--) view[3 - i] = block[i - 1]; //endregion\n\n\n    return value[0];\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\n\n  /**\r\n   * Get 4-byte unsigned integer value\r\n   * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n   * @returns {number}\r\n   */\n\n\n  getUint32(changeLength = true) {\n    const block = this.getBlock(4, changeLength); //region Check posibility for convertion\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n    if (block.length < 4) return 0; //endregion\n    //region Convert byte array to \"Uint32Array\" value\n\n    const value = new Uint32Array(1);\n    const view = new Uint8Array(value.buffer); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n    for (let i = 3; i >= 0; i--) view[3 - i] = block[i]; //endregion\n\n\n    return value[0];\n  } //**********************************************************************************\n\n  /**\r\n   * Get 4-byte signed integer value\r\n   * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n   * @returns {number}\r\n   */\n\n\n  getInt32(changeLength = true) {\n    const block = this.getBlock(4, changeLength); //region Check posibility for convertion\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n    if (block.length < 4) return 0; //endregion\n    //region Convert byte array to \"Int32Array\" value\n\n    const value = new Int32Array(1);\n    const view = new Uint8Array(value.buffer); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n    for (let i = 3; i >= 0; i--) view[3 - i] = block[i]; //endregion\n\n\n    return value[0];\n  } //**********************************************************************************\n\n\n} //**************************************************************************************\n// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\n\n/**\r\n * Get parsed values from \"byte map\"\r\n * @param {ByteStream} stream Stream to parse data from\r\n * @param {Object} map Object with information how to parse \"byte map\"\r\n * @param {number} elements Number of elements in parsing byte map\r\n * @param {?number} [start=null] Start position to parse from\r\n * @param {?number} [length=null] Length of byte block to parse from\r\n * @returns {*}\r\n */\n\nexport function parseByteMap(stream, map, elements, start = null, length = null) {\n  /*\r\n   Map example:\r\n   \r\n   let map = [\r\n   {\r\n   type: \"string\",\r\n   name: \"type\",\r\n   minlength: 1,\r\n   maxlength: 1,\r\n   func: function(array)\r\n   {\r\n   let result = {\r\n   status: (-1),\r\n   length: 1\r\n   };\r\n   \r\n   switch(array[0])\r\n   {\r\n   case 0x6E: // \"n\"\r\n   result.value = \"n\";\r\n   break;\r\n   case 0x66: // \"f\"\r\n   result.value = \"f\";\r\n   break;\r\n   default:\r\n   return result;\r\n   }\r\n   \r\n   result.status = 1;\r\n   \r\n   return result;\r\n   }\r\n   },\r\n   {\r\n   type: \"check\",\r\n   minlength: 1,\r\n   maxlength: 2,\r\n   func: function(array)\r\n   {\r\n   let position = (-1);\r\n   \r\n   if(array[0] == 0x0A)\r\n   position = 1;\r\n   if(array[1] == 0x0A)\r\n   position = 2;\r\n   \r\n   return {\r\n   status: (position > 0) ? 1 : (-1),\r\n   length: position\r\n   };\r\n   }\r\n   }\r\n   ];\r\n   */\n  //region Initial variables\n  // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n  if (start === null) {\n    // noinspection AssignmentToFunctionParameterJS\n    start = 0;\n  } // noinspection NonBlockStatementBodyJS\n\n\n  if (start > stream.buffer.byteLength - 1) return false; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n  if (length === null) {\n    // noinspection AssignmentToFunctionParameterJS\n    length = stream.buffer.byteLength - start;\n  }\n\n  if (length > stream.buffer.byteLength - start) {\n    // noinspection AssignmentToFunctionParameterJS\n    length = stream.buffer.byteLength - start;\n  }\n\n  let dataView; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n  if (start == 0 && length == stream.buffer.byteLength) dataView = stream.view;else dataView = new Uint8Array(stream.buffer, start, length);\n  const resultArray = new Array(elements);\n  let elementsCount = 0;\n  let count = 0;\n  const mapLength = map.length; //endregion\n  //region Parse all byte, structure by structure\n\n  while (count < length) {\n    let structureLength = 0;\n    resultArray[elementsCount] = {};\n\n    for (let i = 0; i < mapLength; i++) {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, JSUnresolvedVariable, EqualityComparisonWithCoercionJS\n      if (map[i].maxlength == 0) {\n        // noinspection NonBlockStatementBodyJS\n        if (\"defaultValue\" in map[i]) resultArray[elementsCount][map[i].name] = map[i].defaultValue; // noinspection ContinueStatementJS\n\n        continue;\n      } // noinspection JSUnresolvedVariable\n\n\n      const array = new Array(map[i].maxlength); // noinspection JSUnresolvedVariable\n\n      for (let j = 0; j < map[i].maxlength; j++) {\n        // noinspection IncrementDecrementResultUsedJS\n        array[j] = dataView[count++];\n      } // noinspection JSUnresolvedVariable\n\n\n      const result = map[i].func(array); // noinspection EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n      if (result.status == -1) {\n        // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\n        if (resultArray.length == 1) return [];\n        return resultArray.slice(0, resultArray.length - 1);\n      } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n\n      if (map[i].type != \"check\") resultArray[elementsCount][map[i].name] = result.value; // noinspection JSUnresolvedVariable\n\n      count -= map[i].maxlength - result.length;\n      structureLength += result.length;\n    } // noinspection IncrementDecrementResultUsedJS\n\n\n    resultArray[elementsCount++].structureLength = structureLength;\n  } //endregion\n\n\n  return resultArray;\n} //**************************************************************************************\n//region \"Bits-to-string\" array\n\nconst bitsToStringArray = [\"00000000\", \"00000001\", \"00000010\", \"00000011\", \"00000100\", \"00000101\", \"00000110\", \"00000111\", \"00001000\", \"00001001\", \"00001010\", \"00001011\", \"00001100\", \"00001101\", \"00001110\", \"00001111\", \"00010000\", \"00010001\", \"00010010\", \"00010011\", \"00010100\", \"00010101\", \"00010110\", \"00010111\", \"00011000\", \"00011001\", \"00011010\", \"00011011\", \"00011100\", \"00011101\", \"00011110\", \"00011111\", \"00100000\", \"00100001\", \"00100010\", \"00100011\", \"00100100\", \"00100101\", \"00100110\", \"00100111\", \"00101000\", \"00101001\", \"00101010\", \"00101011\", \"00101100\", \"00101101\", \"00101110\", \"00101111\", \"00110000\", \"00110001\", \"00110010\", \"00110011\", \"00110100\", \"00110101\", \"00110110\", \"00110111\", \"00111000\", \"00111001\", \"00111010\", \"00111011\", \"00111100\", \"00111101\", \"00111110\", \"00111111\", \"01000000\", \"01000001\", \"01000010\", \"01000011\", \"01000100\", \"01000101\", \"01000110\", \"01000111\", \"01001000\", \"01001001\", \"01001010\", \"01001011\", \"01001100\", \"01001101\", \"01001110\", \"01001111\", \"01010000\", \"01010001\", \"01010010\", \"01010011\", \"01010100\", \"01010101\", \"01010110\", \"01010111\", \"01011000\", \"01011001\", \"01011010\", \"01011011\", \"01011100\", \"01011101\", \"01011110\", \"01011111\", \"01100000\", \"01100001\", \"01100010\", \"01100011\", \"01100100\", \"01100101\", \"01100110\", \"01100111\", \"01101000\", \"01101001\", \"01101010\", \"01101011\", \"01101100\", \"01101101\", \"01101110\", \"01101111\", \"01110000\", \"01110001\", \"01110010\", \"01110011\", \"01110100\", \"01110101\", \"01110110\", \"01110111\", \"01111000\", \"01111001\", \"01111010\", \"01111011\", \"01111100\", \"01111101\", \"01111110\", \"01111111\", \"10000000\", \"10000001\", \"10000010\", \"10000011\", \"10000100\", \"10000101\", \"10000110\", \"10000111\", \"10001000\", \"10001001\", \"10001010\", \"10001011\", \"10001100\", \"10001101\", \"10001110\", \"10001111\", \"10010000\", \"10010001\", \"10010010\", \"10010011\", \"10010100\", \"10010101\", \"10010110\", \"10010111\", \"10011000\", \"10011001\", \"10011010\", \"10011011\", \"10011100\", \"10011101\", \"10011110\", \"10011111\", \"10100000\", \"10100001\", \"10100010\", \"10100011\", \"10100100\", \"10100101\", \"10100110\", \"10100111\", \"10101000\", \"10101001\", \"10101010\", \"10101011\", \"10101100\", \"10101101\", \"10101110\", \"10101111\", \"10110000\", \"10110001\", \"10110010\", \"10110011\", \"10110100\", \"10110101\", \"10110110\", \"10110111\", \"10111000\", \"10111001\", \"10111010\", \"10111011\", \"10111100\", \"10111101\", \"10111110\", \"10111111\", \"11000000\", \"11000001\", \"11000010\", \"11000011\", \"11000100\", \"11000101\", \"11000110\", \"11000111\", \"11001000\", \"11001001\", \"11001010\", \"11001011\", \"11001100\", \"11001101\", \"11001110\", \"11001111\", \"11010000\", \"11010001\", \"11010010\", \"11010011\", \"11010100\", \"11010101\", \"11010110\", \"11010111\", \"11011000\", \"11011001\", \"11011010\", \"11011011\", \"11011100\", \"11011101\", \"11011110\", \"11011111\", \"11100000\", \"11100001\", \"11100010\", \"11100011\", \"11100100\", \"11100101\", \"11100110\", \"11100111\", \"11101000\", \"11101001\", \"11101010\", \"11101011\", \"11101100\", \"11101101\", \"11101110\", \"11101111\", \"11110000\", \"11110001\", \"11110010\", \"11110011\", \"11110100\", \"11110101\", \"11110110\", \"11110111\", \"11111000\", \"11111001\", \"11111010\", \"11111011\", \"11111100\", \"11111101\", \"11111110\", \"11111111\"]; //endregion\n//**************************************************************************************\n\nexport class BitStream {\n  //**********************************************************************************\n\n  /**\r\n   * Constructor for \"BitStream\" class\r\n   * @param {{[byteStream]: ByteStream, [view]: Uint8Array, [buffer]: ArrayBuffer, [string]: string, [bitsCount]: number}} parameters\r\n   */\n  constructor(parameters = {}) {\n    this.buffer = new ArrayBuffer(0);\n    this.view = new Uint8Array(this.buffer);\n    this.bitsCount = 0; // Number of bits stored in current \"BitStream\"\n\n    for (const key of Object.keys(parameters)) {\n      switch (key) {\n        case \"byteStream\":\n          this.fromByteStream(parameters.byteStream);\n          break;\n\n        case \"view\":\n          this.fromUint8Array(parameters.view);\n          break;\n\n        case \"buffer\":\n          this.fromArrayBuffer(parameters.buffer);\n          break;\n\n        case \"string\":\n          this.fromString(parameters.string);\n          break;\n\n        case \"uint32\":\n          this.fromUint32(parameters.uint32);\n          break;\n\n        case \"bitsCount\":\n          this.bitsCount = parameters.bitsCount;\n          break;\n\n        default:\n      }\n    }\n  } //**********************************************************************************\n\n  /**\r\n   * Clear existing stream\r\n   */\n\n\n  clear() {\n    this.buffer = new ArrayBuffer(0);\n    this.view = new Uint8Array(this.buffer);\n    this.bitsCount = 0;\n  } //**********************************************************************************\n\n  /**\r\n   * Initialize \"BitStream\" by data from existing \"ByteStream\"\r\n   * @param {ByteStream} stream\r\n   */\n\n\n  fromByteStream(stream) {\n    this.buffer = stream.buffer.slice(0);\n    this.view = new Uint8Array(this.buffer);\n    this.bitsCount = this.view.length << 3;\n  } //**********************************************************************************\n\n  /**\r\n   * Initialize \"BitStream\" object from existing \"ArrayBuffer\"\r\n   * @param {ArrayBuffer} array The ArrayBuffer to copy from\r\n   */\n\n\n  fromArrayBuffer(array) {\n    this.buffer = array.slice(0);\n    this.view = new Uint8Array(this.buffer);\n    this.bitsCount = this.view.length << 3;\n  } //**********************************************************************************\n  // noinspection FunctionNamingConventionJS\n\n  /**\r\n   * Initialize \"BitStream\" object from existing \"Uint8Array\"\r\n   * @param {Uint8Array} array The Uint8Array to copy from\r\n   */\n\n\n  fromUint8Array(array) {\n    this.buffer = new ArrayBuffer(array.length);\n    this.view = new Uint8Array(this.buffer);\n    this.view.set(array);\n    this.bitsCount = this.view.length << 3;\n  } //**********************************************************************************\n\n  /**\r\n   * Initialize \"BitStream\" object from existing bit string\r\n   * @param {string} string The string to initialize from\r\n   */\n\n\n  fromString(string) {\n    //region Initial variables\n    const stringLength = string.length; // noinspection ConditionalExpressionJS\n\n    this.buffer = new ArrayBuffer((stringLength >> 3) + (stringLength % 8 ? 1 : 0));\n    this.view = new Uint8Array(this.buffer);\n    this.bitsCount = (stringLength >> 3) + 1 << 3; // In order to handle correct shifting\n\n    let byteIndex = 0; //endregion\n    //region Convert from \"bit string\" to bytes\n\n    for (let i = 0; i < stringLength; i++) {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n      if (string[i] == \"1\") this.view[byteIndex] |= 1 << 7 - i % 8; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n      if (i && (i + 1) % 8 == 0) byteIndex++;\n    } //endregion\n    //region Shift \"BitStream\" into correct position\n    // noinspection NonBlockStatementBodyJS\n\n\n    if (stringLength % 8) this.shiftRight(8 - stringLength % 8); //endregion\n    //region Change \"bitsCount\"\n\n    this.bitsCount = stringLength; //endregion\n  } //**********************************************************************************\n\n  /**\r\n   * Initialize \"BitStream\" object from existing uint32 number\r\n   * @param {Number} number The string to initialize from\r\n   */\n\n\n  fromUint32(uint32) {\n    this.buffer = new ArrayBuffer(4);\n    this.view = new Uint8Array(this.buffer);\n    const value = new Uint32Array([uint32]);\n    const view = new Uint8Array(value.buffer);\n\n    for (let i = 3; i >= 0; i--) this.view[i] = view[3 - i];\n\n    this.bitsCount = 32;\n  } //**********************************************************************************\n\n  /**\r\n   * Represent \"BitStream\" object content as a string\r\n   * @param {?number} [start=null] Start number to convert to string from\r\n   * @param {?number} [length=null] Length of BitStream to convert to string\r\n   * @returns {string}\r\n   */\n\n\n  toString(start = null, length = null) {\n    //region Check input parameters\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n    if (start == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = 0;\n    } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n\n    if (start >= this.view.length || start < 0) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = 0;\n    } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n\n    if (length == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.view.length - start;\n    } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n\n    if (length >= this.view.length || length < 0) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.view.length - start;\n    } //endregion\n    //region Initial variables\n\n\n    const result = []; //endregion\n    //region Convert from bytes to \"bit string\"\n    // noinspection NonBlockStatementBodyJS\n\n    for (let i = start; i < start + length; i++) result.push(bitsToStringArray[this.view[i]]); //endregion\n    // noinspection ChainedFunctionCallJS\n\n\n    return result.join(\"\").slice((this.view.length << 3) - this.bitsCount);\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Shift entire \"BitStream\" value right to number of bits\r\n   * @param {number} shift Number of bits to shift value\r\n   * @param {boolean} [needShrink=true] Need to shrink result or not\r\n   */\n\n\n  shiftRight(shift, needShrink = true) {\n    //region Check parameters\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n    if (this.view.length == 0) return; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n    if (shift < 0 || shift > 8) throw new Error(\"The \\\"shift\\\" parameter must be in range 0-8\"); // noinspection NonBlockStatementBodyJS\n\n    if (shift > this.bitsCount) throw new Error(\"The \\\"shift\\\" parameter can not be bigger than \\\"this.bitsCount\\\"\"); //endregion\n    //region Initial variables\n    // noinspection MagicNumberJS\n\n    const shiftMask = 0xFF >> 8 - shift;\n    this.view[this.view.length - 1] >>= shift; //endregion\n    //region Shift value\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    for (let i = this.view.length - 2; i >= 0; i--) {\n      // noinspection NonShortCircuitBooleanExpressionJS\n      this.view[i + 1] |= (this.view[i] & shiftMask) << 8 - shift;\n      this.view[i] >>= shift;\n    } //endregion\n    //region Decrease number of bits stored into value\n\n\n    this.bitsCount -= shift; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n    if (this.bitsCount == 0) this.clear(); //endregion\n    //region Change stream size if needed\n    // noinspection NonBlockStatementBodyJS\n\n    if (needShrink) this.shrink(); //endregion\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Shift entire \"BitStream\" value left to number of bits\r\n   * @param {number} shift Number of bits to shift value\r\n   */\n\n\n  shiftLeft(shift) {\n    /*\r\n     NOTE: We do not really shift value because of internal structure of \"BitStream\":\r\n     all bytes inside \"BitStream\" are aligned to right position. So, even if we will\r\n     really shift value to left after that we will need again shift it right to the\r\n     same number of bits. Thus all that we do here is hiding of left bits and descresing\r\n     the \"bitsCount\" number.\r\n     */\n    //region Check parameters\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n    if (this.view.length == 0) return; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n    if (shift < 0 || shift > 8) throw new Error(\"The \\\"shift\\\" parameter must be in range 0-8\"); // noinspection NonBlockStatementBodyJS\n\n    if (shift > this.bitsCount) throw new Error(\"The \\\"shift\\\" parameter can not be bigger than \\\"this.bitsCount\\\"\"); //endregion\n    //region Remove shifted bits\n    // noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\n\n    const bitsOffset = this.bitsCount & 0x07;\n\n    if (bitsOffset > shift) {\n      // noinspection MagicNumberJS\n      this.view[0] &= 0xFF >> bitsOffset + shift;\n    } else {\n      //region Change size of buffer\n      const buffer = new ArrayBuffer(this.buffer.byteLength - 1);\n      const view = new Uint8Array(buffer); // noinspection NestedFunctionCallJS\n\n      view.set(new Uint8Array(this.buffer, 1, this.buffer.byteLength - 1)); //endregion\n      //region Mask item with index 0\n      // noinspection MagicNumberJS\n\n      view[0] &= 0xFF >> shift - bitsOffset; //endregion\n      //region Store final array into current stream\n\n      this.buffer = buffer.slice(0);\n      this.view = new Uint8Array(this.buffer); //endregion\n    } //endregion\n    //region Decrease number of bits stored into value\n\n\n    this.bitsCount -= shift; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n    if (this.bitsCount == 0) this.clear(); //endregion\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS, FunctionTooLongJS\n\n  /**\r\n   * Return slice of existing \"BitStream\"\r\n   * @param {?number} [start=null] Start position of the slice (in bits)\r\n   * @param {?number} [end=null] End position of the slice (in bits)\r\n   * @returns {BitStream}\r\n   */\n\n\n  slice(start = null, end = null) {\n    //region Make ability to pass non-value bits\n    let valueShift = 0; // noinspection NonBlockStatementBodyJS\n\n    if (this.bitsCount % 8) valueShift = 8 - this.bitsCount % 8; // noinspection AssignmentToFunctionParameterJS\n\n    start += valueShift; // noinspection AssignmentToFunctionParameterJS\n\n    end += valueShift; //endregion\n    //region Initial variables\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (start == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      start = 0;\n    } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n\n    if (start < 0 || start > (this.view.length << 3) - 1) return new BitStream(); //(\"Wrong start position: \" + start);\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (end == null) {\n      // noinspection AssignmentToFunctionParameterJS\n      end = (this.view.length << 3) - 1;\n    } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n\n    if (end < 0 || end > (this.view.length << 3) - 1) return new BitStream(); //(\"Wrong end position: \" + end);\n    // noinspection NonBlockStatementBodyJS\n\n    if (end - start + 1 > this.bitsCount) return new BitStream(); //(\"Maximum length is \" + this.bitsCount);\n\n    const startIndex = start >> 3; // noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\n\n    const startOffset = start & 0x07;\n    const endIndex = end >> 3; // noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\n\n    const endOffset = end & 0x07; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\n\n    const bitsLength = endIndex - startIndex == 0 ? 1 : endIndex - startIndex + 1;\n    const result = new BitStream(); //endregion\n    //region Store \"primary bytes\"\n\n    result.buffer = new ArrayBuffer(bitsLength);\n    result.view = new Uint8Array(result.buffer);\n    result.bitsCount = bitsLength << 3; // noinspection NestedFunctionCallJS\n\n    result.view.set(new Uint8Array(this.buffer, startIndex, bitsLength)); //endregion\n    //region Change \"start byte\"\n    // noinspection MagicNumberJS\n\n    result.view[0] &= 0xFF >> startOffset; //endregion\n    //region Change \"end byte\"\n    // noinspection MagicNumberJS\n\n    result.view[bitsLength] &= 0xFF << 7 - endOffset; //endregion\n    //region Shift result array to right\n    // noinspection NonBlockStatementBodyJS\n\n    if (7 - endOffset) result.shiftRight(7 - endOffset, false); //endregion\n    //region Set final number of bits\n\n    result.bitsCount = end - start + 1; //endregion\n    //region Cut unnecessary bytes from result\n\n    result.shrink(); //endregion\n\n    return result;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Return copy of existing \"BitStream\"\r\n   * @param {?number} [start=null] Start position of the copy (in bits)\r\n   * @param {?number} [length=null] Length of the copy (in bits)\r\n   * @returns {BitStream}\r\n   */\n\n\n  copy(start = null, length = null) {\n    //region Check input parameters\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n    if (start < 0 || start > (this.view.length << 3) - 1) return new BitStream(); //(\"Wrong start position: \" + start);\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\n\n    if (length === null) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = (this.view.length << 3) - start - 1;\n    } // noinspection NonBlockStatementBodyJS\n\n\n    if (length > this.bitsCount) return new BitStream(); //(\"Maximum length is \" + this.bitsCount);\n    //endregion\n\n    return this.slice(start, start + length - 1);\n  } //**********************************************************************************\n\n  /**\r\n   * Shrink unnecessary bytes in current stream accordingly to \"bitsCount\" value\r\n   */\n\n\n  shrink() {\n    // noinspection ConditionalExpressionJS\n    const currentLength = (this.bitsCount >> 3) + (this.bitsCount % 8 ? 1 : 0);\n\n    if (currentLength < this.buffer.byteLength) {\n      //region Change size of buffer\n      const buffer = new ArrayBuffer(currentLength);\n      const view = new Uint8Array(buffer); // noinspection NestedFunctionCallJS\n\n      view.set(new Uint8Array(this.buffer, this.buffer.byteLength - currentLength, currentLength)); //endregion\n      //region Store final array into current stream\n\n      this.buffer = buffer.slice(0);\n      this.view = new Uint8Array(this.buffer); //endregion\n    }\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Reverse bits order in each byte in the stream\r\n   * Got it from here: http://graphics.stanford.edu/~seander/bithacks.html#ReverseByteWith32Bits\r\n   */\n\n\n  reverseBytes() {\n    //region Reverse bits order in each byte in the stream\n    for (let i = 0; i < this.view.length; i++) {\n      // noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\n      this.view[i] = (this.view[i] * 0x0802 & 0x22110 | this.view[i] * 0x8020 & 0x88440) * 0x10101 >> 16;\n    } //endregion\n    //region Shift \"most significant\" byte\n\n\n    if (this.bitsCount % 8) {\n      // noinspection ConditionalExpressionJS\n      const currentLength = (this.bitsCount >> 3) + (this.bitsCount % 8 ? 1 : 0); // noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\n\n      this.view[this.view.length - currentLength] >>= 8 - (this.bitsCount & 0x07);\n    } //endregion\n\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Reverse all bits in entire \"BitStream\"\r\n   */\n\n\n  reverseValue() {\n    const initialValue = this.toString();\n    const initialValueLength = initialValue.length;\n    const reversedValue = new Array(initialValueLength); // noinspection NonBlockStatementBodyJS\n\n    for (let i = 0; i < initialValueLength; i++) reversedValue[initialValueLength - 1 - i] = initialValue[i]; // noinspection NestedFunctionCallJS\n\n\n    this.fromString(reversedValue.join(\"\"));\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Trying to represent entire \"BitStream\" as an unsigned integer.\r\n   * @return {number}\r\n   */\n\n\n  getNumberValue() {\n    //region Initial variables\n    const byteLength = this.buffer.byteLength - 1; //endregion\n    //region Check posibility for convertion\n    // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n    if (byteLength > 3) return -1; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n    if (byteLength == -1) return 0; //endregion\n    //region Convert byte array to \"Uint32Array\" value\n\n    const value = new Uint32Array(1);\n    const view = new Uint8Array(value.buffer); // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\n\n    for (let i = byteLength; i >= 0; i--) view[byteLength - i] = this.view[i]; //endregion\n\n\n    return value[0];\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Find any bit pattern in \"BitStream\"\r\n   * @param {BitStream} pattern Stream having pattern value\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @param {boolean} [backward=false] Flag to search in backward order\r\n   * @returns {number}\r\n   */\n\n\n  findPattern(pattern, start = null, length = null, backward = false) {\n    //region Convert \"BitStream\" values to \"ByteStream\"\n    const stringStream = new ByteStream({\n      string: this.toString()\n    });\n    const stringPattern = new ByteStream({\n      string: pattern.toString()\n    }); //endregion\n\n    return stringStream.findPattern(stringPattern, start, length, backward);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Find first position of any pattern from input array\r\n   * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @param {boolean} [backward=false] Flag to search in backward order\r\n   * @returns {{id: number, position: number}}\r\n   */\n\n\n  findFirstIn(patterns, start = null, length = null, backward = false) {\n    //region Convert \"BitStream\" values to \"ByteStream\"\n    const stringStream = new ByteStream({\n      string: this.toString()\n    });\n    const stringPatterns = new Array(patterns.length);\n\n    for (let i = 0; i < patterns.length; i++) {\n      stringPatterns[i] = new ByteStream({\n        string: patterns[i].toString()\n      });\n    } //endregion\n\n\n    return stringStream.findFirstIn(stringPatterns, start, length, backward);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Find all positions of any pattern from input array\r\n   * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @returns {Array}\r\n   */\n\n\n  findAllIn(patterns, start = null, length = null) {\n    //region Convert \"BitStream\" values to \"ByteStream\"\n    const stringStream = new ByteStream({\n      string: this.toString()\n    });\n    const stringPatterns = new Array(patterns.length);\n\n    for (let i = 0; i < patterns.length; i++) {\n      stringPatterns[i] = new ByteStream({\n        string: patterns[i].toString()\n      });\n    } //endregion\n\n\n    return stringStream.findAllIn(stringPatterns, start, length);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Find all positions of a pattern\r\n   * @param {BitStream} pattern Stream having pattern value\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @returns {Array|number}\r\n   */\n\n\n  findAllPatternIn(pattern, start = null, length = null) {\n    //region Convert \"BitStream\" values to \"ByteStream\" \n    const stringStream = new ByteStream({\n      string: this.toString()\n    });\n    const stringPattern = new ByteStream({\n      string: pattern.toString()\n    }); //endregion \n\n    return stringStream.findAllPatternIn(stringPattern, start, length);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Find first position of data, not included in patterns from input array\r\n   * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @param {boolean} [backward=false] Flag to search in backward order\r\n   * @returns {{left: {id: number, position: *}, right: {id: number, position: number}, value: ByteStream}}\r\n   */\n\n\n  findFirstNotIn(patterns, start = null, length = null, backward = false) {\n    //region Convert \"BitStream\" values to \"ByteStream\"\n    const stringStream = new ByteStream({\n      string: this.toString()\n    });\n    const stringPatterns = new Array(patterns.length);\n\n    for (let i = 0; i < patterns.length; i++) {\n      stringPatterns[i] = new ByteStream({\n        string: patterns[i].toString()\n      });\n    } //endregion\n\n\n    return stringStream.findFirstNotIn(stringPatterns, start, length, backward);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Find all positions of data, not included in patterns from input array\r\n   * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @returns {Array}\r\n   */\n\n\n  findAllNotIn(patterns, start = null, length = null) {\n    //region Convert \"BitStream\" values to \"ByteStream\"\n    const stringStream = new ByteStream({\n      string: this.toString()\n    });\n    const stringPatterns = new Array(patterns.length);\n\n    for (let i = 0; i < patterns.length; i++) {\n      stringPatterns[i] = new ByteStream({\n        string: patterns[i].toString()\n      });\n    } //endregion\n\n\n    return stringStream.findAllNotIn(stringPatterns, start, length);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Find position of a sequence of any patterns from input array\r\n   * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @param {boolean} [backward=false] Flag to search in backward order\r\n   * @returns {{position, value}|*}\r\n   */\n\n\n  findFirstSequence(patterns, start = null, length = null, backward = false) {\n    //region Convert \"BitStream\" values to \"ByteStream\"\n    const stringStream = new ByteStream({\n      string: this.toString()\n    });\n    const stringPatterns = new Array(patterns.length);\n\n    for (let i = 0; i < patterns.length; i++) {\n      stringPatterns[i] = new ByteStream({\n        string: patterns[i].toString()\n      });\n    } //endregion\n\n\n    return stringStream.findFirstSequence(stringPatterns, start, length, backward);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Find position of a sequence of any patterns from input array\r\n   * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @returns {Array}\r\n   */\n\n\n  findAllSequences(patterns, start, length) {\n    //region Convert \"BitStream\" values to \"ByteStream\"\n    const stringStream = new ByteStream({\n      string: this.toString()\n    });\n    const stringPatterns = new Array(patterns.length);\n\n    for (let i = 0; i < patterns.length; i++) {\n      stringPatterns[i] = new ByteStream({\n        string: patterns[i].toString()\n      });\n    } //endregion\n\n\n    return stringStream.findAllSequences(stringPatterns, start, length);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Find all paired patterns in the stream\r\n   * @param {BitStream} leftPattern Left pattern to search for\r\n   * @param {BitStream} rightPattern Right pattern to search for\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @returns {Array}\r\n   */\n\n\n  findPairedPatterns(leftPattern, rightPattern, start = null, length = null) {\n    //region Convert \"BitStream\" values to \"ByteStream\"\n    const stringStream = new ByteStream({\n      string: this.toString()\n    });\n    const stringLeftPattern = new ByteStream({\n      string: leftPattern.toString()\n    });\n    const stringRightPattern = new ByteStream({\n      string: rightPattern.toString()\n    }); //endregion\n\n    return stringStream.findPairedPatterns(stringLeftPattern, stringRightPattern, start, length);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleLoopsJS\n\n  /**\r\n   * Find all paired patterns in the stream\r\n   * @param {Array.<BitStream>} inputLeftPatterns Array of left patterns to search for\r\n   * @param {Array.<BitStream>} inputRightPatterns Array of right patterns to search for\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @returns {Array}\r\n   */\n\n\n  findPairedArrays(inputLeftPatterns, inputRightPatterns, start = null, length = null) {\n    //region Convert \"BitStream\" values to \"ByteStream\"\n    const stringStream = new ByteStream({\n      string: this.toString()\n    });\n    const stringLeftPatterns = new Array(inputLeftPatterns.length);\n\n    for (let i = 0; i < inputLeftPatterns.length; i++) {\n      stringLeftPatterns[i] = new ByteStream({\n        string: inputLeftPatterns[i].toString()\n      });\n    }\n\n    const stringRightPatterns = new Array(inputRightPatterns.length);\n\n    for (let i = 0; i < inputRightPatterns.length; i++) {\n      stringRightPatterns[i] = new ByteStream({\n        string: inputRightPatterns[i].toString()\n      });\n    } //endregion\n\n\n    return stringStream.findPairedArrays(stringLeftPatterns, stringRightPatterns, start, length);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Replace one pattern with other\r\n   * @param {BitStream} searchPattern The pattern to search for\r\n   * @param {BitStream} replacePattern The pattern to replace initial pattern\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @returns {boolean}\r\n   */\n\n\n  replacePattern(searchPattern, replacePattern, start = null, length = null) {\n    //region Convert \"BitStream\" values to \"ByteStream\"\n    const stringStream = new ByteStream({\n      string: this.toString()\n    });\n    const stringSearchPattern = new ByteStream({\n      string: searchPattern.toString()\n    });\n    const stringReplacePattern = new ByteStream({\n      string: replacePattern.toString()\n    }); //endregion\n    //region Re-initialize existing data\n\n    if (stringStream.findPairedPatterns(stringSearchPattern, stringReplacePattern, start, length)) {\n      // noinspection NestedFunctionCallJS\n      this.fromString(stringStream.toString());\n      return true;\n    } //endregion\n\n\n    return false;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Skip any pattern from input array\r\n   * @param {Array.<BitStream>} patterns Array with patterns which should be ommited\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @param {boolean} [backward=false] Flag to search in backward order\r\n   * @returns {*}\r\n   */\n\n\n  skipPatterns(patterns, start, length, backward) {\n    //region Convert \"BitStream\" values to \"ByteStream\"\n    const stringStream = new ByteStream({\n      string: this.toString()\n    });\n    const stringPatterns = new Array(patterns.length);\n\n    for (let i = 0; i < patterns.length; i++) {\n      stringPatterns[i] = new ByteStream({\n        string: patterns[i].toString()\n      });\n    } //endregion\n\n\n    return stringStream.skipPatterns(stringPatterns, start, length, backward);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Skip any pattern not from input array\r\n   * @param {Array.<BitStream>} patterns Array with patterns which should be ommited\r\n   * @param {?number} [start=null] Start position to search from\r\n   * @param {?number} [length=null] Length of byte block to search at\r\n   * @param {boolean} [backward=false] Flag to search in backward order\r\n   * @returns {number}\r\n   */\n\n\n  skipNotPatterns(patterns, start, length, backward) {\n    //region Convert \"BitStream\" values to \"ByteStream\"\n    const stringStream = new ByteStream({\n      string: this.toString()\n    });\n    const stringPatterns = new Array(patterns.length);\n\n    for (let i = 0; i < patterns.length; i++) {\n      stringPatterns[i] = new ByteStream({\n        string: patterns[i].toString()\n      });\n    } //endregion\n\n\n    return stringStream.skipNotPatterns(stringPatterns, start, length, backward);\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Append a new \"BitStream\" content to the current \"BitStream\"\r\n   * @param {BitStream} stream A new \"stream\" to append to current \"stream\"\r\n   */\n\n\n  append(stream) {\n    //region Initialize current stream with new data\n    // noinspection NestedFunctionCallJS\n    this.fromString([this.toString(), stream.toString()].join(\"\")); //endregion\n  } //**********************************************************************************\n\n\n} //**************************************************************************************\n\nexport class SeqBitStream {\n  //**********************************************************************************\n  constructor(parameters = {}) {\n    //region Internal variables\n    this.stream = new BitStream();\n    this._start = 0;\n    this._length = this.stream.bitsCount;\n    this.backward = false;\n    this.appendBlock = 0; //endregion\n\n    for (const key of Object.keys(parameters)) {\n      switch (key) {\n        case \"stream\":\n        case \"start\":\n        case \"length\":\n        case \"backward\":\n        case \"appendBlock\":\n          this[key] = parameters[key];\n          break;\n\n        default:\n      }\n    }\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS\n\n\n  set start(value) {\n    // noinspection NonBlockStatementBodyJS\n    if (value > this.stream.bitsCount) return; // noinspection ConditionalExpressionJS\n\n    this._length -= this.backward ? this._start - value : value - this._start;\n    this._start = value; //region Initialization of \"prev\" internal variables\n    // noinspection JSUnusedGlobalSymbols\n\n    this.prevStart = this._start; // noinspection JSUnusedGlobalSymbols\n\n    this.prevLength = this._length; //endregion\n  } //**********************************************************************************\n\n\n  get start() {\n    return this._start;\n  } //**********************************************************************************\n  // noinspection FunctionWithMultipleReturnPointsJS\n\n\n  set length(value) {\n    // noinspection NonBlockStatementBodyJS\n    if (value > this.stream.bitsCount) return; // noinspection JSUnusedGlobalSymbols\n\n    this.prevLength = this._length;\n    this._length = value;\n  } //**********************************************************************************\n\n\n  get length() {\n    return this._length;\n  } //**********************************************************************************\n\n\n  set stream(value) {\n    this._stream = value; // noinspection JSUnusedGlobalSymbols\n\n    this.prevLength = this._length;\n    this._length = value.bitsCount; // noinspection JSUnusedGlobalSymbols\n\n    this.prevStart = this._start; // noinspection ConditionalExpressionJS\n\n    this._start = this.backward ? this.length : 0;\n  } //**********************************************************************************\n\n\n  get stream() {\n    return this._stream;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols\n\n  /**\r\n   * Get next \"length\" bits from the stream\r\n   * @param {number} length Number of bits to read\r\n   * @returns {*}\r\n   */\n\n\n  getBits(length) {\n    //region Check input parameters \n    if (this.start + length > this.stream.bitsCount) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.stream.bitsCount - this.start;\n    } //endregion \n    //region Initial variables \n\n\n    let result; //endregion \n    //region Copy necessary length of bits\n\n    if (this.backward) {\n      result = this.stream.copy(this.start - length, length);\n      this.start -= result.bitsCount;\n    } else {\n      result = this.stream.copy(this.start, length);\n      this.start += result.bitsCount;\n    } //endregion\n\n\n    return result;\n  } //**********************************************************************************\n  // noinspection FunctionTooLongJS\n\n  /**\r\n   * Get string representation for the next \"length\" bits from the stream\r\n   * @param {number} length Number of bits to read\r\n   * @returns {string}\r\n   */\n\n\n  getBitsString(length) {\n    //region Check input parameters\n    if (this.start + length > this.stream.bitsCount) {\n      // noinspection AssignmentToFunctionParameterJS\n      length = this.stream.bitsCount - this.start;\n    } //endregion\n    //region Initial variables\n\n\n    let result = [];\n    let start; // noinspection NonBlockStatementBodyJS\n\n    if (this.backward) start = this.start - length;else start = this.start;\n    let end = this.start + length - 1; //region Make ability to pass non-value bits\n\n    let valueShift = 0; // noinspection NonBlockStatementBodyJS\n\n    if (this.stream.bitsCount % 8) valueShift = 8 - this.stream.bitsCount % 8;\n    start += valueShift;\n    end += valueShift; //endregion\n\n    const startIndex = start >> 3; // noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\n\n    const startOffset = start & 0x07;\n    const endIndex = end >> 3; // noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\n\n    const endOffset = end & 0x07; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\n\n    const bitsLengthIndex = startIndex + (endIndex - startIndex == 0 ? 1 : endIndex - startIndex + 1); //endregion\n    //region Get string representation of bits\n\n    for (let i = startIndex; i < bitsLengthIndex; i++) {\n      let value = bitsToStringArray[this.stream.view[i]]; // noinspection EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n      if (i == startIndex) value = value.slice(startOffset); // noinspection EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n      if (i == bitsLengthIndex - 1) value = value.slice(0, endOffset - 7 + value.length);\n      result.push(value);\n    }\n\n    result = result.join(\"\"); //endregion\n    //region Change internal values\n    // noinspection NonBlockStatementBodyJS\n\n    if (this.backward) this.start -= result.length;else this.start += result.length; //endregion\n\n    return result;\n  } //**********************************************************************************\n  // noinspection JSUnusedGlobalSymbols, FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS\n\n  /**\r\n   * Get number value representation of the next \"length\" bits from the stream, preliminary reversed\r\n   * @param {number} length Number of bits to read\r\n   * @returns {*}\r\n   */\n\n\n  getBitsReversedValue(length) {\n    //region Initial variables \n    const initialValue = this.getBitsString(length);\n    const initialValueLength = initialValue.length;\n    let byteIndex;\n    const initialOffset = 8 - initialValueLength % 8;\n    const reversedValue = new Array(initialValueLength);\n    const value = new Uint32Array(1);\n    const valueView = new Uint8Array(value.buffer, 0, 4);\n    let i; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, MagicNumberJS, NonBlockStatementBodyJS\n\n    if (initialValueLength > 32) return -1; // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, MagicNumberJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n    if (length == 32) byteIndex = 3;else byteIndex = initialValueLength - 1 >> 3; //endregion\n    //region Reverse value \n    // noinspection NonBlockStatementBodyJS\n\n    for (i = 0; i < initialValueLength; i++) reversedValue[initialValueLength - 1 - i] = initialValue[i]; //endregion \n    //region Convert byte array to \"Uint32Array\" value \n\n\n    for (i = initialOffset; i < initialOffset + initialValueLength; i++) {\n      // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS\n      if (reversedValue[i - initialOffset] == \"1\") {\n        // noinspection MagicNumberJS\n        valueView[byteIndex] |= 0x01 << 7 - i % 8;\n      } // noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\n\n\n      if (i && (i + 1) % 8 == 0) byteIndex--;\n    } //endregion \n\n\n    return value[0];\n  } //**********************************************************************************\n\n  /**\r\n   * Represent remaining bits in \"BitStream\" as a string\r\n   * @return {string}\r\n   */\n\n\n  toString() {\n    const streamToDisplay = this.stream.copy(this.start, this.length);\n    return streamToDisplay.toString();\n  } //**********************************************************************************\n\n\n} //**************************************************************************************","map":{"version":3,"sources":["/Users/pratison/Work/Cisco/Education/React/education-webex/node_modules/bytestreamjs/src/bytestream.js"],"names":["ByteStream","constructor","parameters","clear","key","Object","keys","length","i","_view","stub","fromUint8Array","view","fromArrayBuffer","buffer","fromString","string","fromHexString","hexstring","value","_buffer","slice","Uint8Array","ArrayBuffer","set","byteLength","array","stringLength","charCodeAt","toString","start","result","String","fromCharCode","hexString","hexMap","Map","j","temp","get","charAt","toHexString","str","toUpperCase","copy","Error","stream","end","realloc","size","append","initialSize","streamViewLength","copyView","insert","isEqual","isEqualView","findPattern","pattern","backward","patternLength","patternArray","push","equal","equalStart","findFirstIn","patterns","id","position","valid","findAllIn","patternFound","findAllPatternIn","Array","from","findFirstNotIn","left","right","currentLength","findAllNotIn","findFirstSequence","firstIn","skipNotPatterns","firstNotIn","skipPatterns","findAllSequences","findPairedPatterns","leftPattern","rightPattern","currentPositionLeft","leftPatterns","rightPatterns","splice","sort","a","b","findPairedArrays","inputLeftPatterns","inputRightPatterns","replacePattern","searchPattern","findAllResult","output","status","searchPatternPositions","replacePatternPositions","element","patternDifference","changedBuffer","changedView","currentPosition","k","SeqStream","_length","_start","appendBlock","prevLength","prevStart","_stream","resetPosition","gap","appendView","appendChar","char","appendUint16","number","Uint16Array","appendUint24","Uint32Array","appendUint32","getBlock","changeLength","getUint16","block","getInt16","Int16Array","getUint24","getUint32","getInt32","Int32Array","parseByteMap","map","elements","dataView","resultArray","elementsCount","count","mapLength","structureLength","maxlength","name","defaultValue","func","type","bitsToStringArray","BitStream","bitsCount","fromByteStream","byteStream","fromUint32","uint32","byteIndex","shiftRight","join","shift","needShrink","shiftMask","shrink","shiftLeft","bitsOffset","valueShift","startIndex","startOffset","endIndex","endOffset","bitsLength","reverseBytes","reverseValue","initialValue","initialValueLength","reversedValue","getNumberValue","stringStream","stringPattern","stringPatterns","stringLeftPattern","stringRightPattern","stringLeftPatterns","stringRightPatterns","stringSearchPattern","stringReplacePattern","SeqBitStream","getBits","getBitsString","bitsLengthIndex","getBitsReversedValue","initialOffset","valueView","streamToDisplay"],"mappings":"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","sourcesContent":["/*\r\n * Copyright (c) 2016-2018, Peculiar Ventures\r\n * All rights reserved.\r\n *\r\n * Author 2016-2018, Yury Strozhevsky <www.strozhevsky.com>.\r\n *\r\n */\r\n//**************************************************************************************\r\nexport class ByteStream\r\n{\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS\r\n\t/**\r\n\t * Constructor for ByteStream class\r\n\t * @param {{[length]: number, [stub]: number, [view]: Uint8Array, [buffer]: ArrayBuffer, [string]: string, [hexstring]: string}} parameters\r\n\t */\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\tthis.clear();\r\n\t\t\r\n\t\tfor(const key of Object.keys(parameters))\r\n\t\t{\r\n\t\t\tswitch(key)\r\n\t\t\t{\r\n\t\t\t\tcase \"length\":\r\n\t\t\t\t\tthis.length = parameters.length;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"stub\":\r\n\t\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\t\tfor(let i = 0; i < this._view.length; i++)\r\n\t\t\t\t\t\tthis._view[i] = parameters.stub;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"view\":\r\n\t\t\t\t\tthis.fromUint8Array(parameters.view);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"buffer\":\r\n\t\t\t\t\tthis.fromArrayBuffer(parameters.buffer);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"string\":\r\n\t\t\t\t\tthis.fromString(parameters.string);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"hexstring\":\r\n\t\t\t\t\tthis.fromHexString(parameters.hexstring);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Setter for \"buffer\"\r\n\t * @param {ArrayBuffer} value\r\n\t */\r\n\tset buffer(value)\r\n\t{\r\n\t\tthis._buffer = value.slice(0);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getter for \"buffer\"\r\n\t * @returns {ArrayBuffer}\r\n\t */\r\n\tget buffer()\r\n\t{\r\n\t\treturn this._buffer;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Setter for \"view\"\r\n\t * @param {Uint8Array} value\r\n\t */\r\n\tset view(value)\r\n\t{\r\n\t\tthis._buffer = new ArrayBuffer(value.length);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t\t\r\n\t\tthis._view.set(value);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getter for \"view\"\r\n\t * @returns {Uint8Array}\r\n\t */\r\n\tget view()\r\n\t{\r\n\t\treturn this._view;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getter for \"length\"\r\n\t * @returns {number}\r\n\t */\r\n\tget length()\r\n\t{\r\n\t\treturn this._buffer.byteLength;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Setter for \"length\"\r\n\t * @param {number} value\r\n\t */\r\n\tset length(value)\r\n\t{\r\n\t\tthis._buffer = new ArrayBuffer(value);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Clear existing stream\r\n\t */\r\n\tclear()\r\n\t{\r\n\t\tthis._buffer = new ArrayBuffer(0);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"Stream\" object from existing \"ArrayBuffer\"\r\n\t * @param {!ArrayBuffer} array The ArrayBuffer to copy from\r\n\t */\r\n\tfromArrayBuffer(array)\r\n\t{\r\n\t\tthis.buffer = array;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionNamingConventionJS\r\n\t/**\r\n\t * Initialize \"Stream\" object from existing \"Uint8Array\"\r\n\t * @param {!Uint8Array} array The Uint8Array to copy from\r\n\t */\r\n\tfromUint8Array(array)\r\n\t{\r\n\t\tthis._buffer = new ArrayBuffer(array.length);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t\t\r\n\t\tthis._view.set(array);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"Stream\" object from existing string\r\n\t * @param {string} string The string to initialize from\r\n\t */\r\n\tfromString(string)\r\n\t{\r\n\t\tconst stringLength = string.length;\r\n\t\t\r\n\t\tthis.length = stringLength;\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(let i = 0; i < stringLength; i++)\r\n\t\t\tthis.view[i] = string.charCodeAt(i);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Represent \"Stream\" object content as a string\r\n\t * @param {number} [start] Start position to convert to string\r\n\t * @param {number} [length] Length of array to convert to string\r\n\t * @returns {string}\r\n\t */\r\n\ttoString(start = 0, length = (this.view.length - start))\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tlet result = \"\";\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((start >= this.view.length) || (start < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((length >= this.view.length) || (length < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.view.length - start;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert array of bytes to string\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(let i = start; i < (start + length); i++)\r\n\t\t\tresult += String.fromCharCode(this.view[i]);\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionTooLongJS\r\n\t/**\r\n\t * Initialize \"Stream\" object from existing hexdecimal string\r\n\t * @param {string} hexString String to initialize from\r\n\t */\r\n\tfromHexString(hexString)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst stringLength = hexString.length;\r\n\t\t\r\n\t\tthis.buffer = new ArrayBuffer(stringLength >> 1);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tconst hexMap = new Map();\r\n\t\t\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"0\", 0x00);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"1\", 0x01);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"2\", 0x02);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"3\", 0x03);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"4\", 0x04);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"5\", 0x05);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"6\", 0x06);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"7\", 0x07);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"8\", 0x08);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"9\", 0x09);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"A\", 0x0A);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"a\", 0x0A);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"B\", 0x0B);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"b\", 0x0B);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"C\", 0x0C);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"c\", 0x0C);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"D\", 0x0D);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"d\", 0x0D);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"E\", 0x0E);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"e\", 0x0E);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"F\", 0x0F);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"f\", 0x0F);\r\n\t\t\r\n\t\tlet j = 0;\r\n\t\t// noinspection MagicNumberJS\r\n\t\tlet temp = 0x00;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert char-by-char\r\n\t\tfor(let i = 0; i < stringLength; i++)\r\n\t\t{\r\n\t\t\t// noinspection NegatedIfStatementJS\r\n\t\t\tif(!(i % 2))\r\n\t\t\t{\r\n\t\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\t\ttemp = hexMap.get(hexString.charAt(i)) << 4;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\t\ttemp |= hexMap.get(hexString.charAt(i));\r\n\t\t\t\t\r\n\t\t\t\tthis.view[j] = temp;\r\n\t\t\t\tj++;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Represent \"Stream\" object content as a hexdecimal string\r\n\t * @param {number} [start=0] Start position to convert to string\r\n\t * @param {number} [length=(this.view.length - start)] Length of array to convert to string\r\n\t * @returns {string}\r\n\t */\r\n\ttoHexString(start = 0, length = (this.view.length - start))\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tlet result = \"\";\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((start >= this.view.length) || (start < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((length >= this.view.length) || (length < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.view.length - start;\r\n\t\t}\r\n\t\t//endregion\r\n\r\n\t\tfor(let i = start; i < (start + length); i++)\r\n\t\t{\r\n\t\t\t// noinspection ChainedFunctionCallJS\r\n\t\t\tconst str = this.view[i].toString(16).toUpperCase();\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\r\n\t\t\tresult = result + ((str.length == 1) ? \"0\" : \"\") + str;\r\n\t\t}\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Return copy of existing \"Stream\"\r\n\t * @param {number} [start=0] Start position of the copy\r\n\t * @param {number} [length=this.view.length] Length of the copy\r\n\t * @returns {ByteStream}\r\n\t */\r\n\tcopy(start = 0, length = (this._buffer.byteLength - start))\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start === 0) && (this._buffer.byteLength === 0))\r\n\t\t\treturn new ByteStream();\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start < 0) || (start > (this._buffer.byteLength - 1)))\r\n\t\t\tthrow new Error(`Wrong start position: ${start}`);\r\n\t\t//endregion\r\n\t\t\r\n\t\tconst stream = new ByteStream();\r\n\t\t\r\n\t\tstream._buffer = this._buffer.slice(start, start + length);\r\n\t\tstream._view = new Uint8Array(stream._buffer);\r\n\t\t\r\n\t\treturn stream;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Return slice of existing \"Stream\"\r\n\t * @param {number} [start=0] Start position of the slice\r\n\t * @param {number} [end=this._buffer.byteLength] End position of the slice\r\n\t * @returns {ByteStream}\r\n\t */\r\n\tslice(start = 0, end = this._buffer.byteLength)\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start === 0) && (this._buffer.byteLength === 0))\r\n\t\t\treturn new ByteStream();\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start < 0) || (start > (this._buffer.byteLength - 1)))\r\n\t\t\tthrow new Error(`Wrong start position: ${start}`);\r\n\t\t//endregion\r\n\t\t\r\n\t\tconst stream = new ByteStream();\r\n\t\t\r\n\t\tstream._buffer = this._buffer.slice(start, end);\r\n\t\tstream._view = new Uint8Array(stream._buffer);\r\n\t\t\r\n\t\treturn stream;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Change size of existing \"Stream\"\r\n\t * @param {!number} size Size for new \"Stream\"\r\n\t */\r\n\trealloc(size)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst buffer = new ArrayBuffer(size);\r\n\t\tconst view = new Uint8Array(buffer);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create a new ArrayBuffer content\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(size > this._view.length)\r\n\t\t\tview.set(this._view);\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tview.set(new Uint8Array(this._buffer, 0, size));\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initialize \"Stream\" with new \"ArrayBuffer\"\r\n\t\tthis._buffer = buffer.slice(0);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Append a new \"Stream\" content to the current \"Stream\"\r\n\t * @param {ByteStream} stream A new \"stream\" to append to current \"stream\"\r\n\t */\r\n\tappend(stream)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst initialSize = this._buffer.byteLength;\r\n\t\tconst streamViewLength = stream._buffer.byteLength;\r\n\t\t\r\n\t\tconst copyView = stream._view.slice();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Re-allocate current internal buffer\r\n\t\tthis.realloc(initialSize + streamViewLength);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Copy input stream content to a new place\r\n\t\tthis._view.set(copyView, initialSize);\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Insert \"Stream\" content to the current \"Stream\" at specific position\r\n\t * @param {ByteStream} stream A new \"stream\" to insert to current \"stream\"\r\n\t * @param {number} [start=0] Start position to insert to\r\n\t * @param {number} [length]\r\n\t * @returns {boolean}\r\n\t */\r\n\tinsert(stream, start = 0, length = (this._buffer.byteLength - start))\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this._buffer.byteLength - 1))\r\n\t\t\treturn false;\r\n\t\t\r\n\t\tif(length > (this._buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this._buffer.byteLength - start;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Check input variables\r\n\t\tif(length > stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = stream._buffer.byteLength;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Update content of the current stream\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(length == stream._buffer.byteLength)\r\n\t\t\tthis._view.set(stream._view, start);\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tthis._view.set(stream._view.slice(0, length), start);\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Check that two \"Stream\" objects has equal content\r\n\t * @param {ByteStream} stream Stream to compare with\r\n\t * @returns {boolean}\r\n\t */\r\n\tisEqual(stream)\r\n\t{\r\n\t\t//region Check length of both buffers\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(this._buffer.byteLength != stream._buffer.byteLength)\r\n\t\t\treturn false;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Compare each byte of both buffers\r\n\t\tfor(let i = 0; i < stream._buffer.byteLength; i++)\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(this.view[i] != stream.view[i])\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Check that current \"Stream\" objects has equal content with input \"Uint8Array\"\r\n\t * @param {Uint8Array} view View to compare with\r\n\t * @returns {boolean}\r\n\t */\r\n\tisEqualView(view)\r\n\t{\r\n\t\t//region Check length of both buffers\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(view.length != this.view.length)\r\n\t\t\treturn false;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Compare each byte of both buffers\r\n\t\tfor(let i = 0; i < view.length; i++)\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(this.view[i] != view[i])\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Find any byte pattern in \"Stream\"\r\n\t * @param {ByteStream} pattern Stream having pattern value\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @param {boolean} [backward] Flag to search in backward order\r\n\t * @returns {number}\r\n\t */\r\n\tfindPattern(pattern, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Check input variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tconst patternLength = pattern.buffer.byteLength;\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(patternLength > length)\r\n\t\t\treturn (-1);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Make a \"pre-read\" array for pattern\r\n\t\tconst patternArray = [];\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(let i = 0; i < patternLength; i++)\r\n\t\t\tpatternArray.push(pattern.view[i]);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for pattern\r\n\t\tfor(let i = 0; i <= (length - patternLength); i++)\r\n\t\t{\r\n\t\t\tlet equal = true;\r\n\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\tconst equalStart = (backward) ? (start - patternLength - i) : (start + i);\r\n\t\t\t\r\n\t\t\tfor(let j = 0; j < patternLength; j++)\r\n\t\t\t{\r\n\t\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\t\tif(this.view[j + equalStart] != patternArray[j])\r\n\t\t\t\t{\r\n\t\t\t\t\tequal = false;\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(equal)\r\n\t\t\t{\r\n\t\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\t\treturn (backward) ? (start - patternLength - i) : (start + patternLength + i); // Position after the pattern found\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn (-1);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection OverlyComplexFunctionJS\r\n\t/**\r\n\t * Find first position of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {{id: number, position: number}}\r\n\t */\r\n\tfindFirstIn(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst result = {\r\n\t\t\tid: (-1),\r\n\t\t\tposition: (backward) ? 0 : (start + length),\r\n\t\t\tlength: 0\r\n\t\t};\r\n\t\t//endregion\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tconst position = this.findPattern(patterns[i], start, length, backward);\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(position != (-1))\r\n\t\t\t{\r\n\t\t\t\tlet valid = false;\r\n\t\t\t\tconst patternLength = patterns[i].length;\r\n\r\n\t\t\t\tif(backward)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\t\tif((position - patternLength) >= (result.position - result.length))\r\n\t\t\t\t\t\tvalid = true;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\t\tif((position - patternLength) <= (result.position - result.length))\r\n\t\t\t\t\t\tvalid = true;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(valid)\r\n\t\t\t\t{\r\n\t\t\t\t\tresult.position = position;\r\n\t\t\t\t\tresult.id = i;\r\n\t\t\t\t\tresult.length = patternLength;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all positions of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllIn(patterns, start = 0, length = (this.buffer.byteLength - start))\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tlet patternFound = {\r\n\t\t\tid: (-1),\r\n\t\t\tposition: start\r\n\t\t};\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all accurences of patterns\r\n\t\tdo\r\n\t\t{\r\n\t\t\tconst position = patternFound.position;\r\n\t\t\t\r\n\t\t\tpatternFound = this.findFirstIn(patterns, patternFound.position, length);\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(patternFound.id == (-1))\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength -= (patternFound.position - position);\r\n\t\t\t\r\n\t\t\tresult.push({\r\n\t\t\t\tid: patternFound.id,\r\n\t\t\t\tposition: patternFound.position\r\n\t\t\t});\r\n\t\t} while(true); // eslint-disable-line\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all positions of a pattern\r\n\t * @param {ByteStream} pattern Stream having pattern value\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @returns {Array|number} Array with all pattern positions or (-1) if failed\r\n\t */\r\n\tfindAllPatternIn(pattern, start = 0, length = (this.buffer.byteLength - start))\r\n\t{\r\n\t\t//region Check input variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\tconst patternLength = pattern.buffer.byteLength;\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(patternLength > length)\r\n\t\t\treturn (-1);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Make a \"pre-read\" array for pattern\r\n\t\tconst patternArray = Array.from(pattern.view);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for pattern\r\n\t\tfor(let i = 0; i <= (length - patternLength); i++)\r\n\t\t{\r\n\t\t\tlet equal = true;\r\n\t\t\tconst equalStart = start + i;\r\n\t\t\t\r\n\t\t\tfor(let j = 0; j < patternLength; j++)\r\n\t\t\t{\r\n\t\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\t\tif(this.view[j + equalStart] != patternArray[j])\r\n\t\t\t\t{\r\n\t\t\t\t\tequal = false;\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(equal)\r\n\t\t\t{\r\n\t\t\t\tresult.push(start + patternLength + i); // Position after the pattern found\r\n\t\t\t\ti += (patternLength - 1); // On next step of \"for\" we will have \"i++\"\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Find first position of data, not included in patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {{left: {id: number, position: *}, right: {id: number, position: number}, value: ByteStream}}\r\n\t */\r\n\tfindFirstNotIn(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tconst result = {\r\n\t\t\tleft: {\r\n\t\t\t\tid: (-1),\r\n\t\t\t\tposition: start\r\n\t\t\t},\r\n\t\t\tright: {\r\n\t\t\t\tid: (-1),\r\n\t\t\t\tposition: 0\r\n\t\t\t},\r\n\t\t\tvalue: new ByteStream()\r\n\t\t};\r\n\t\t\r\n\t\tlet currentLength = length;\r\n\t\t//endregion\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\twhile(currentLength > 0)\r\n\t\t{\r\n\t\t\t//region Search for nearest \"pattern\"\r\n\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\tresult.right = this.findFirstIn(patterns,\r\n\t\t\t\t(backward) ? (start - length + currentLength) : (start + length - currentLength),\r\n\t\t\t\tcurrentLength,\r\n\t\t\t\tbackward);\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region No pattern at all\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.right.id == (-1))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = currentLength;\r\n\t\t\t\t\r\n\t\t\t\tif(backward)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tstart -= length;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tstart = result.left.position;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tresult.value = new ByteStream();\r\n\t\t\t\t\r\n\t\t\t\tresult.value._buffer = this._buffer.slice(start, start + length);\r\n\t\t\t\tresult.value._view = new Uint8Array(result.value._buffer);\r\n\t\t\t\t\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Check distance between two patterns\r\n\t\t\t// noinspection ConditionalExpressionJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.right.position != ((backward) ? (result.left.position - patterns[result.right.id].buffer.byteLength) : (result.left.position + patterns[result.right.id].buffer.byteLength)))\r\n\t\t\t{\r\n\t\t\t\tif(backward)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tstart = result.right.position + patterns[result.right.id].buffer.byteLength;\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tlength = result.left.position - result.right.position - patterns[result.right.id].buffer.byteLength;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tstart = result.left.position;\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tlength = result.right.position - result.left.position - patterns[result.right.id].buffer.byteLength;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tresult.value = new ByteStream();\r\n\t\t\t\t\r\n\t\t\t\tresult.value._buffer = this._buffer.slice(start, start + length);\r\n\t\t\t\tresult.value._view = new Uint8Array(result.value._buffer);\r\n\t\t\t\t\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Store information about previous pattern\r\n\t\t\tresult.left = result.right;\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Change current length\r\n\t\t\tcurrentLength -= patterns[result.right.id]._buffer.byteLength;\r\n\t\t\t//endregion\r\n\t\t}\r\n\t\t\r\n\t\t//region Swap \"patterns\" in case of backward order\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\tconst temp = result.right;\r\n\t\t\tresult.right = result.left;\r\n\t\t\tresult.left = temp;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all positions of data, not included in patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllNotIn(patterns, start = null, length = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tlet patternFound = {\r\n\t\t\tleft: {\r\n\t\t\t\tid: (-1),\r\n\t\t\t\tposition: start\r\n\t\t\t},\r\n\t\t\tright: {\r\n\t\t\t\tid: (-1),\r\n\t\t\t\tposition: start\r\n\t\t\t},\r\n\t\t\tvalue: new ByteStream()\r\n\t\t};\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all accurences of patterns\r\n\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\tdo\r\n\t\t{\r\n\t\t\tconst position = patternFound.right.position;\r\n\t\t\t\r\n\t\t\tpatternFound = this.findFirstNotIn(patterns, patternFound.right.position, length);\r\n\t\t\t\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength -= (patternFound.right.position - position);\r\n\t\t\t\r\n\t\t\tresult.push({\r\n\t\t\t\tleft: {\r\n\t\t\t\t\tid: patternFound.left.id,\r\n\t\t\t\t\tposition: patternFound.left.position\r\n\t\t\t\t},\r\n\t\t\t\tright: {\r\n\t\t\t\t\tid: patternFound.right.id,\r\n\t\t\t\t\tposition: patternFound.right.position\r\n\t\t\t\t},\r\n\t\t\t\tvalue: patternFound.value\r\n\t\t\t});\r\n\t\t} while(patternFound.right.id != (-1));\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS\r\n\t/**\r\n\t * Find position of a sequence of any patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array of pattern to look for\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {*}\r\n\t */\r\n\tfindFirstSequence(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find first byte from sequence\r\n\t\tconst firstIn = this.skipNotPatterns(patterns, start, length, backward);\r\n\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\tif(firstIn == (-1))\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\tposition: (-1),\r\n\t\t\t\tvalue: new ByteStream()\r\n\t\t\t};\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find first byte not in sequence\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst firstNotIn = this.skipPatterns(patterns,\r\n\t\t\tfirstIn,\r\n\t\t\tlength - ((backward) ? (start - firstIn) : (firstIn - start)),\r\n\t\t\tbackward);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Make output value\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = firstNotIn;\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = (firstIn - firstNotIn);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = firstIn;\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = (firstNotIn - firstIn);\r\n\t\t}\r\n\t\t\r\n\t\tconst value = new ByteStream();\r\n\t\t\r\n\t\tvalue._buffer = this._buffer.slice(start, start + length);\r\n\t\tvalue._view = new Uint8Array(value._buffer);\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn {\r\n\t\t\tposition: firstNotIn,\r\n\t\t\tvalue\r\n\t\t};\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all positions of a sequence of any patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array of patterns to search for\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllSequences(patterns, start = null, length = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tlet patternFound = {\r\n\t\t\tposition: start,\r\n\t\t\tvalue: new ByteStream()\r\n\t\t};\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all accurences of patterns\r\n\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\tdo\r\n\t\t{\r\n\t\t\tconst position = patternFound.position;\r\n\t\t\t\r\n\t\t\tpatternFound = this.findFirstSequence(patterns, patternFound.position, length);\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(patternFound.position != (-1))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength -= (patternFound.position - position);\r\n\t\t\t\t\r\n\t\t\t\tresult.push({\r\n\t\t\t\t\tposition: patternFound.position,\r\n\t\t\t\t\tvalue: patternFound.value\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t} while(patternFound.position != (-1));\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {ByteStream} leftPattern Left pattern to search for\r\n\t * @param {ByteStream} rightPattern Right pattern to search for\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedPatterns(leftPattern, rightPattern, start = null, length = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(leftPattern.isEqual(rightPattern))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tlet currentPositionLeft = 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all \"left patterns\" as sorted array\r\n\t\tconst leftPatterns = this.findAllPatternIn(leftPattern, start, length);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(leftPatterns.length == 0)\r\n\t\t\treturn result;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all \"right patterns\" as sorted array\r\n\t\tconst rightPatterns = this.findAllPatternIn(rightPattern, start, length);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(rightPatterns.length == 0)\r\n\t\t\treturn result;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Combine patterns\r\n\t\twhile(currentPositionLeft < leftPatterns.length)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(rightPatterns.length == 0)\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(leftPatterns[0] == rightPatterns[0])\r\n\t\t\t{\r\n\t\t\t\t// Possible situation when one pattern is a part of another\r\n\t\t\t\t// For example \"stream\" and \"endstream\"\r\n\t\t\t\t// In case when we have only \"endstream\" in fact \"stream\" will be also found at the same position\r\n\t\t\t\t// (position of the pattern is an index AFTER the pattern)\r\n\t\t\t\t\r\n\t\t\t\tresult.push({\r\n\t\t\t\t\tleft: leftPatterns[0],\r\n\t\t\t\t\tright: rightPatterns[0]\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tleftPatterns.splice(0, 1);\r\n\t\t\t\trightPatterns.splice(0, 1);\r\n\t\t\t\t\r\n\t\t\t\t// noinspection ContinueStatementJS\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(leftPatterns[currentPositionLeft] > rightPatterns[0])\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\twhile(leftPatterns[currentPositionLeft] < rightPatterns[0])\r\n\t\t\t{\r\n\t\t\t\tcurrentPositionLeft++;\r\n\t\t\t\t\r\n\t\t\t\tif(currentPositionLeft >= leftPatterns.length)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tresult.push({\r\n\t\t\t\tleft: leftPatterns[currentPositionLeft - 1],\r\n\t\t\t\tright: rightPatterns[0]\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tleftPatterns.splice(currentPositionLeft - 1, 1);\r\n\t\t\trightPatterns.splice(0, 1);\r\n\t\t\t\r\n\t\t\tcurrentPositionLeft = 0;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Sort result\r\n\t\tresult.sort((a, b) => (a.left - b.left));\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {Array.<ByteStream>} inputLeftPatterns Array of left patterns to search for\r\n\t * @param {Array.<ByteStream>} inputRightPatterns Array of right patterns to search for\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedArrays(inputLeftPatterns, inputRightPatterns, start = null, length = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tlet currentPositionLeft = 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all \"left patterns\" as sorted array\r\n\t\tconst leftPatterns = this.findAllIn(inputLeftPatterns, start, length);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(leftPatterns.length == 0)\r\n\t\t\treturn result;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all \"right patterns\" as sorted array\r\n\t\tconst rightPatterns = this.findAllIn(inputRightPatterns, start, length);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(rightPatterns.length == 0)\r\n\t\t\treturn result;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Combine patterns\r\n\t\twhile(currentPositionLeft < leftPatterns.length)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(rightPatterns.length == 0)\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(leftPatterns[0].position == rightPatterns[0].position)\r\n\t\t\t{\r\n\t\t\t\t// Possible situation when one pattern is a part of another\r\n\t\t\t\t// For example \"stream\" and \"endstream\"\r\n\t\t\t\t// In case when we have only \"endstream\" in fact \"stream\" will be also found at the same position\r\n\t\t\t\t// (position of the pattern is an index AFTER the pattern)\r\n\t\t\t\t\r\n\t\t\t\tresult.push({\r\n\t\t\t\t\tleft: leftPatterns[0],\r\n\t\t\t\t\tright: rightPatterns[0]\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tleftPatterns.splice(0, 1);\r\n\t\t\t\trightPatterns.splice(0, 1);\r\n\t\t\t\t\r\n\t\t\t\t// noinspection ContinueStatementJS\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(leftPatterns[currentPositionLeft].position > rightPatterns[0].position)\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\twhile(leftPatterns[currentPositionLeft].position < rightPatterns[0].position)\r\n\t\t\t{\r\n\t\t\t\tcurrentPositionLeft++;\r\n\t\t\t\t\r\n\t\t\t\tif(currentPositionLeft >= leftPatterns.length)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tresult.push({\r\n\t\t\t\tleft: leftPatterns[currentPositionLeft - 1],\r\n\t\t\t\tright: rightPatterns[0]\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tleftPatterns.splice(currentPositionLeft - 1, 1);\r\n\t\t\trightPatterns.splice(0, 1);\r\n\t\t\t\r\n\t\t\tcurrentPositionLeft = 0;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Sort result\r\n\t\tresult.sort((a, b) => (a.left.position - b.left.position));\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS, FunctionTooLongJS\r\n\t/**\r\n\t * Replace one patter with other\r\n\t * @param {ByteStream} searchPattern The pattern to search for\r\n\t * @param {ByteStream} replacePattern The pattern to replace initial pattern\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {Array|null} [findAllResult=null] Pre-calculated results of \"findAllIn\"\r\n\t * @returns {*}\r\n\t */\r\n\treplacePattern(searchPattern, replacePattern, start = null, length = null, findAllResult = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tlet result;\r\n\t\t\r\n\t\tlet i;\r\n\t\tconst output = {\r\n\t\t\tstatus: (-1),\r\n\t\t\tsearchPatternPositions: [],\r\n\t\t\treplacePatternPositions: []\r\n\t\t};\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn false;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find a pattern to search for\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(findAllResult == null)\r\n\t\t{\r\n\t\t\tresult = this.findAllIn([searchPattern], start, length);\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.length == 0)\r\n\t\t\t\treturn output;\r\n\t\t}\r\n\t\telse\r\n\t\t\tresult = findAllResult;\r\n\t\t\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\toutput.searchPatternPositions.push(...Array.from(result, element => element.position));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Variables for new buffer initialization\r\n\t\tconst patternDifference = searchPattern.buffer.byteLength - replacePattern.buffer.byteLength;\r\n\t\t\r\n\t\tconst changedBuffer = new ArrayBuffer(this.view.length - (result.length * patternDifference));\r\n\t\tconst changedView = new Uint8Array(changedBuffer);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Copy data from 0 to start\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\tchangedView.set(new Uint8Array(this.buffer, 0, start));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Replace pattern\r\n\t\tfor(i = 0; i < result.length; i++)\r\n\t\t{\r\n\t\t\t//region Initial variables\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\r\n\t\t\tconst currentPosition = (i == 0) ? start : result[i - 1].position;\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Copy bytes other then search pattern\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tchangedView.set(new Uint8Array(this.buffer, currentPosition, result[i].position - searchPattern.buffer.byteLength - currentPosition), currentPosition - i * patternDifference);\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Put replace pattern in a new buffer\r\n\t\t\tchangedView.set(replacePattern.view, result[i].position - searchPattern.buffer.byteLength - i * patternDifference);\r\n\t\t\t\r\n\t\t\toutput.replacePatternPositions.push(result[i].position - searchPattern.buffer.byteLength - i * patternDifference);\r\n\t\t\t//endregion\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Copy data from the end of old buffer\r\n\t\ti--;\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\tchangedView.set(new Uint8Array(this.buffer, result[i].position, this.buffer.byteLength - result[i].position), result[i].position - searchPattern.buffer.byteLength + replacePattern.buffer.byteLength - i * patternDifference);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Re-initialize existing buffer\r\n\t\tthis.buffer = changedBuffer;\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t//endregion\r\n\t\t\r\n\t\toutput.status = 1;\r\n\t\t\r\n\t\treturn output;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Skip any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {*}\r\n\t */\r\n\tskipPatterns(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tlet result = start;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for pattern\r\n\t\tfor(let k = 0; k < patterns.length; k++)\r\n\t\t{\r\n\t\t\tconst patternLength = patterns[k].buffer.byteLength;\r\n\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\tconst equalStart = (backward) ? (result - patternLength) : (result);\r\n\t\t\tlet equal = true;\r\n\t\t\t\r\n\t\t\tfor(let j = 0; j < patternLength; j++)\r\n\t\t\t{\r\n\t\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\t\tif(this.view[j + equalStart] != patterns[k].view[j])\r\n\t\t\t\t{\r\n\t\t\t\t\tequal = false;\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(equal)\r\n\t\t\t{\r\n\t\t\t\tk = (-1);\r\n\t\t\t\t\r\n\t\t\t\tif(backward)\r\n\t\t\t\t{\r\n\t\t\t\t\tresult -= patternLength;\r\n\t\t\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\t\t\t\tif(result <= 0)\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tresult += patternLength;\r\n\t\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\t\tif(result >= (start + length))\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Skip any pattern not from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should not be ommited\r\n\t * @param start\r\n\t * @param length\r\n\t * @param backward\r\n\t * @returns {number}\r\n\t */\r\n\tskipNotPatterns(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tlet result = (-1);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for pattern\r\n\t\tfor(let i = 0; i < length; i++)\r\n\t\t{\r\n\t\t\tfor(let k = 0; k < patterns.length; k++)\r\n\t\t\t{\r\n\t\t\t\tconst patternLength = patterns[k].buffer.byteLength;\r\n\t\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\t\tconst equalStart = (backward) ? (start - i - patternLength) : (start + i);\r\n\t\t\t\tlet equal = true;\r\n\t\t\t\t\r\n\t\t\t\tfor(let j = 0; j < patternLength; j++)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\t\t\tif(this.view[j + equalStart] != patterns[k].view[j])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tequal = false;\r\n\t\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(equal)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\t\t\tresult = (backward) ? (start - i) : (start + i); // Exact position of pattern found\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(result != (-1))\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\nexport class SeqStream \r\n{\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Constructor for \"SeqStream\" class\r\n\t * @param {{[stream]: ByteStream, [length]: number, [backward]: boolean, [start]: number, [appendBlock]: number}} parameters\r\n\t */\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\t/**\r\n\t\t * Major stream\r\n\t\t * @type {ByteStream}\r\n\t\t */\r\n\t\tthis.stream = new ByteStream();\r\n\t\t/**\r\n\t\t * Length of the major stream\r\n\t\t * @type {number}\r\n\t\t */\r\n\t\tthis._length = 0;\r\n\t\t/**\r\n\t\t * Flag to search in backward direction\r\n\t\t * @type {boolean}\r\n\t\t */\r\n\t\tthis.backward = false;\r\n\t\t/**\r\n\t\t * Start position to search\r\n\t\t * @type {number}\r\n\t\t */\r\n\t\tthis._start = 0;\r\n\t\t/**\r\n\t\t * Length of a block when append information to major stream\r\n\t\t * @type {number}\r\n\t\t */\r\n\t\tthis.appendBlock = 0;\r\n\t\t\r\n\t\tthis.prevLength = 0;\r\n\t\tthis.prevStart = 0;\r\n\t\t\r\n\t\tfor(const key of Object.keys(parameters))\r\n\t\t{\r\n\t\t\tswitch(key)\r\n\t\t\t{\r\n\t\t\t\tcase \"stream\":\r\n\t\t\t\t\tthis.stream = parameters.stream;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"backward\":\r\n\t\t\t\t\tthis.backward = parameters.backward;\r\n\t\t\t\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\t\t\t\tthis._start = this.stream.buffer.byteLength;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"length\":\r\n\t\t\t\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\t\t\t\tthis._length = parameters.length;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"start\":\r\n\t\t\t\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\t\t\t\tthis._start = parameters.start;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"appendBlock\":\r\n\t\t\t\t\tthis.appendBlock = parameters.appendBlock;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"view\":\r\n\t\t\t\t\tthis.stream = new ByteStream({ view: parameters.view});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"buffer\":\r\n\t\t\t\t\tthis.stream = new ByteStream({ buffer: parameters.buffer});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"string\":\r\n\t\t\t\t\tthis.stream = new ByteStream({ string: parameters.string});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"hexstring\":\r\n\t\t\t\t\tthis.stream = new ByteStream({ hexstring: parameters.hexstring});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Setter for \"stream\" property\r\n\t * @param {ByteStream} value\r\n\t */\r\n\tset stream(value)\r\n\t{\r\n\t\tthis._stream = value;\r\n\t\t\r\n\t\tthis.prevLength = this._length;\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._length = value._buffer.byteLength;\r\n\t\t\r\n\t\tthis.prevStart = this._start;\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._start = 0;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getter for \"stream\" property\r\n\t * @returns {ByteStream}\r\n\t */\r\n\tget stream()\r\n\t{\r\n\t\treturn this._stream;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Setter for \"length\" property\r\n\t * @param {number} value\r\n\t */\r\n\tset length(value)\r\n\t{\r\n\t\tthis.prevLength = this._length;\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._length = value;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Getter for \"length\" property\r\n\t * @returns {number}\r\n\t */\r\n\tget length()\r\n\t{\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(this.appendBlock)\r\n\t\t\treturn this.start;\r\n\t\t\r\n\t\treturn this._length;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Setter for \"start\" property\r\n\t * @param {number} value\r\n\t */\r\n\tset start(value)\r\n\t{\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(value > this.stream.buffer.byteLength)\r\n\t\t\treturn;\r\n\t\t\r\n\t\t//region Initialization of \"prev\" internal variables\r\n\t\tthis.prevStart = this._start;\r\n\t\tthis.prevLength = this._length;\r\n\t\t//endregion\r\n\t\t\r\n\t\t// noinspection JSUnusedGlobalSymbols, ConditionalExpressionJS\r\n\t\tthis._length -= ((this.backward) ? (this._start - value) : (value - this._start));\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._start = value;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getter for \"start\" property\r\n\t * @returns {number}\r\n\t */\r\n\tget start()\r\n\t{\r\n\t\treturn this._start;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Return ArrayBuffer with having value of existing SeqStream length\r\n\t * @return {ArrayBuffer}\r\n\t */\r\n\tget buffer()\r\n\t{\r\n\t\treturn this._stream._buffer.slice(0, this._length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Reset current position of the \"SeqStream\"\r\n\t */\r\n\tresetPosition()\r\n\t{\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._start = this.prevStart;\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._length = this.prevLength;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find any byte pattern in \"ByteStream\"\r\n\t * @param {ByteStream} pattern Stream having pattern value\r\n\t * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n\t * @returns {number}\r\n\t */\r\n\tfindPattern(pattern, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > this.length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = this.length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find pattern\r\n\t\tconst result = this.stream.findPattern(pattern, this.start, this.length, this.backward);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(result == (-1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\tif(result < (this.start - pattern.buffer.byteLength - gap))\r\n\t\t\t\treturn (-1);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\tif(result > (this.start + pattern.buffer.byteLength + gap))\r\n\t\t\t\treturn (-1);\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tthis.start = result;\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find first position of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n\t * @returns {{id: number, position: number}}\r\n\t */\r\n\tfindFirstIn(patterns, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > this.length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = this.length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for patterns\r\n\t\tconst result = this.stream.findFirstIn(patterns, this.start, this.length, this.backward);\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(result.id == (-1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\tif(result.position < (this.start - patterns[result.id].buffer.byteLength - gap))\r\n\t\t\t{\r\n\t\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: (-1),\r\n\t\t\t\t\tposition: (this.backward) ? 0 : (this.start + this.length)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif(result.position > (this.start + patterns[result.id].buffer.byteLength + gap))\r\n\t\t\t{\r\n\t\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: (-1),\r\n\t\t\t\t\tposition: (this.backward) ? 0 : (this.start + this.length)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tthis.start = result.position;\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all positions of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllIn(patterns)\r\n\t{\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this.start - this.length) : this.start;\r\n\t\t\r\n\t\treturn this.stream.findAllIn(patterns, start, this.length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS\r\n\t/**\r\n\t * Find first position of data, not included in patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} gap Maximum gap between start position and position of nearest object\r\n\t * @returns {*}\r\n\t */\r\n\tfindFirstNotIn(patterns, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > this._length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = this._length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for patterns\r\n\t\tconst result = this._stream.findFirstNotIn(patterns, this._start, this._length, this.backward);\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif((result.left.id == (-1)) && (result.right.id == (-1)))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.right.id != (-1))\r\n\t\t\t{\r\n\t\t\t\tif(result.right.position < (this._start - patterns[result.right.id]._buffer.byteLength - gap))\r\n\t\t\t\t{\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tleft: {\r\n\t\t\t\t\t\t\tid: (-1),\r\n\t\t\t\t\t\t\tposition: this._start\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tright: {\r\n\t\t\t\t\t\t\tid: (-1),\r\n\t\t\t\t\t\t\tposition: 0\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tvalue: new ByteStream()\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.left.id != (-1))\r\n\t\t\t{\r\n\t\t\t\tif(result.left.position > (this._start + patterns[result.left.id]._buffer.byteLength + gap))\r\n\t\t\t\t{\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tleft: {\r\n\t\t\t\t\t\t\tid: (-1),\r\n\t\t\t\t\t\t\tposition: this._start\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tright: {\r\n\t\t\t\t\t\t\tid: (-1),\r\n\t\t\t\t\t\t\tposition: 0\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tvalue: new ByteStream()\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.left.id == (-1))\r\n\t\t\t\tthis.start = 0;\r\n\t\t\telse\r\n\t\t\t\tthis.start = result.left.position;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.right.id == (-1))\r\n\t\t\t\tthis.start = (this._start + this._length);\r\n\t\t\telse\r\n\t\t\t\tthis.start = result.right.position;\r\n\t\t}\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all positions of data, not included in patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllNotIn(patterns)\r\n\t{\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this._start - this._length) : this._start;\r\n\t\t\r\n\t\treturn this._stream.findAllNotIn(patterns, start, this._length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find position of a sequence of any patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [length] Length to search sequence for\r\n\t * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n\t * @returns {*}\r\n\t */\r\n\tfindFirstSequence(patterns, length = null, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((length == null) || (length > this._length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this._length;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for sequence\r\n\t\tconst result = this._stream.findFirstSequence(patterns, this._start, length, this.backward);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(result.value.buffer.byteLength == 0)\r\n\t\t\treturn result;\r\n\t\t\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\tif(result.position < (this._start - result.value._buffer.byteLength - gap))\r\n\t\t\t{\r\n\t\t\t\treturn {\r\n\t\t\t\t\tposition: (-1),\r\n\t\t\t\t\tvalue: new ByteStream()\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif(result.position > (this._start + result.value._buffer.byteLength + gap))\r\n\t\t\t{\r\n\t\t\t\treturn {\r\n\t\t\t\t\tposition: (-1),\r\n\t\t\t\t\tvalue: new ByteStream()\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tthis.start = result.position;\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find position of a sequence of any patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllSequences(patterns)\r\n\t{\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this.start - this.length) : this.start;\r\n\t\t\r\n\t\treturn this.stream.findAllSequences(patterns, start, this.length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {ByteStream} leftPattern Left pattern to search for\r\n\t * @param {ByteStream} rightPattern Right pattern to search for\r\n\t * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedPatterns(leftPattern, rightPattern, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > this.length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = this.length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this.start - this.length) : this.start;\r\n\t\t\r\n\t\t//region Search for patterns\r\n\t\tconst result = this.stream.findPairedPatterns(leftPattern, rightPattern, start, this.length);\r\n\t\tif(result.length)\r\n\t\t{\r\n\t\t\tif(this.backward)\r\n\t\t\t{\r\n\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\tif(result[0].right < (this.start - rightPattern.buffer.byteLength - gap))\r\n\t\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\tif(result[0].left > (this.start + leftPattern.buffer.byteLength + gap))\r\n\t\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {Array.<ByteStream>} leftPatterns Array of left patterns to search for\r\n\t * @param {Array.<ByteStream>} rightPatterns Array of right patterns to search for\r\n\t * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedArrays(leftPatterns, rightPatterns, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > this.length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = this.length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this.start - this.length) : this.start;\r\n\t\t\r\n\t\t//region Search for patterns\r\n\t\tconst result = this.stream.findPairedArrays(leftPatterns, rightPatterns, start, this.length);\r\n\t\tif(result.length)\r\n\t\t{\r\n\t\t\tif(this.backward)\r\n\t\t\t{\r\n\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\tif(result[0].right.position < (this.start - rightPatterns[result[0].right.id].buffer.byteLength - gap))\r\n\t\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\tif(result[0].left.position > (this.start + leftPatterns[result[0].left.id].buffer.byteLength + gap))\r\n\t\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Replace one patter with other\r\n\t * @param {ByteStream} searchPattern The pattern to search for\r\n\t * @param {ByteStream} replacePattern The pattern to replace initial pattern\r\n\t * @returns {*}\r\n\t */\r\n\treplacePattern(searchPattern, replacePattern)\r\n\t{\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this.start - this.length) : this.start;\r\n\t\t\r\n\t\treturn this.stream.replacePattern(searchPattern, replacePattern, start, this.length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Skip of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @returns {*}\r\n\t */\r\n\tskipPatterns(patterns)\r\n\t{\r\n\t\tconst result = this.stream.skipPatterns(patterns, this.start, this.length, this.backward);\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tthis.start = result;\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Skip of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @returns {number}\r\n\t */\r\n\tskipNotPatterns(patterns)\r\n\t{\r\n\t\tconst result = this.stream.skipNotPatterns(patterns, this.start, this.length, this.backward);\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(result == (-1))\r\n\t\t\treturn (-1);\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tthis.start = result;\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Append a new \"Stream\" content to the current \"Stream\"\r\n\t * @param {ByteStream} stream A new \"stream\" to append to current \"stream\"\r\n\t */\r\n\tappend(stream)\r\n\t{\r\n\t\tif((this._start + stream._buffer.byteLength) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\tif(stream._buffer.byteLength > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = (stream._buffer.byteLength + 1000);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tthis._stream._view.set(stream._view, this._start);\r\n\t\t\r\n\t\tthis._length += (stream._buffer.byteLength * 2);\r\n\t\tthis.start = (this._start + stream._buffer.byteLength);\r\n\t\tthis.prevLength -= (stream._buffer.byteLength * 2);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Append a \"view\" content to the current \"Stream\"\r\n\t * @param {Uint8Array} view A new \"view\" to append to current \"stream\"\r\n\t */\r\n\tappendView(view)\r\n\t{\r\n\t\tif((this._start + view.length) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\tif(view.length > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = (view.length + 1000);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tthis._stream._view.set(view, this._start);\r\n\t\t\r\n\t\tthis._length += (view.length * 2);\r\n\t\tthis.start = (this._start + view.length);\r\n\t\tthis.prevLength -= (view.length * 2);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Append a new char to the current \"Stream\"\r\n\t * @param {number} char A new char to append to current \"stream\"\r\n\t */\r\n\tappendChar(char)\r\n\t{\r\n\t\tif((this._start + 1) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnLefSideOfComparisonJS\r\n\t\t\tif(1 > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = 1000;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tthis._stream._view[this._start] = char;\r\n\t\t\r\n\t\tthis._length += 2;\r\n\t\tthis.start = (this._start + 1);\r\n\t\tthis.prevLength -= 2;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionNamingConventionJS\r\n\t/**\r\n\t * Append a new number to the current \"Stream\"\r\n\t * @param {number} number A new unsigned 16-bit integer to append to current \"stream\"\r\n\t */\r\n\tappendUint16(number)\r\n\t{\r\n\t\tif((this._start + 2) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnLefSideOfComparisonJS\r\n\t\t\tif(2 > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = 1000;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tconst value = new Uint16Array([number]);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\tthis._stream._view[this._start] = view[1];\r\n\t\tthis._stream._view[this._start + 1] = view[0];\r\n\t\t\r\n\t\tthis._length += 4;\r\n\t\tthis.start = (this._start + 2);\r\n\t\tthis.prevLength -= 4;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionNamingConventionJS\r\n\t/**\r\n\t * Append a new number to the current \"Stream\"\r\n\t * @param {number} number A new unsigned 24-bit integer to append to current \"stream\"\r\n\t */\r\n\tappendUint24(number)\r\n\t{\r\n\t\tif((this._start + 3) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnLefSideOfComparisonJS\r\n\t\t\tif(3 > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = 1000;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tconst value = new Uint32Array([number]);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\tthis._stream._view[this._start] = view[2];\r\n\t\tthis._stream._view[this._start + 1] = view[1];\r\n\t\tthis._stream._view[this._start + 2] = view[0];\r\n\t\t\r\n\t\tthis._length += 6;\r\n\t\tthis.start = (this._start + 3);\r\n\t\tthis.prevLength -= 6;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionNamingConventionJS\r\n\t/**\r\n\t * Append a new number to the current \"Stream\"\r\n\t * @param {number} number A new unsigned 32-bit integer to append to current \"stream\"\r\n\t */\r\n\tappendUint32(number)\r\n\t{\r\n\t\tif((this._start + 4) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnLefSideOfComparisonJS\r\n\t\t\tif(4 > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = 1000;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tconst value = new Uint32Array([number]);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\tthis._stream._view[this._start] = view[3];\r\n\t\tthis._stream._view[this._start + 1] = view[2];\r\n\t\tthis._stream._view[this._start + 2] = view[1];\r\n\t\tthis._stream._view[this._start + 3] = view[0];\r\n\t\t\r\n\t\tthis._length += 8;\r\n\t\tthis.start = (this._start + 4);\r\n\t\tthis.prevLength -= 8;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Get a block of data\r\n\t * @param {number} size Size of the data block to get\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {Array}\r\n\t */\r\n\tgetBlock(size, changeLength = true)\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(this._length <= 0)\r\n\t\t\treturn [];\r\n\t\t\r\n\t\tif(this._length < size)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tsize = this._length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tlet result;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Getting result depends on \"backward\" flag\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\tconst buffer = this._stream._buffer.slice(this._length - size, this._length);\r\n\t\t\tconst view = new Uint8Array(buffer);\r\n\t\t\t\r\n\t\t\tresult = new Array(size);\r\n\t\t\t\r\n\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\tfor(let i = 0; i < size; i++)\r\n\t\t\t\tresult[size - 1 - i] = view[i];\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tconst buffer = this._stream._buffer.slice(this._start, this._start + size);\r\n\t\t\t\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tresult = Array.from(new Uint8Array(buffer));\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change \"length\" value if needed\r\n\t\tif(changeLength)\r\n\t\t{\r\n\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\tthis.start += ((this.backward) ? ((-1) * size) : size);\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\r\n\t/**\r\n\t * Get 2-byte unsigned integer value\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {number}\r\n\t */\r\n\tgetUint16(changeLength = true)\r\n\t{\r\n\t\tconst block = this.getBlock(2, changeLength);\r\n\t\t\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(block.length < 2)\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert byte array to \"Uint16Array\" value\r\n\t\tconst value = new Uint16Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\tview[0] = block[1];\r\n\t\tview[1] = block[0];\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\r\n\t/**\r\n\t * Get 2-byte signed integer value\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {number}\r\n\t */\r\n\tgetInt16(changeLength = true)\r\n\t{\r\n\t\tconst block = this.getBlock(2, changeLength);\r\n\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(block.length < 2)\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\r\n\t\t//region Convert byte array to \"Int16Array\" value\r\n\t\tconst value = new Int16Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\r\n\t\tview[0] = block[1];\r\n\t\tview[1] = block[0];\r\n\t\t//endregion\r\n\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\r\n\t/**\r\n\t * Get 3-byte unsigned integer value\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {number}\r\n\t */\r\n\tgetUint24(changeLength = true)\r\n\t{\r\n\t\tconst block = this.getBlock(3, changeLength);\r\n\t\t\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(block.length < 3)\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert byte array to \"Uint32Array\" value\r\n\t\tconst value = new Uint32Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tfor(let i = 3; i >= 1; i--)\r\n\t\t\tview[3 - i] = block[i - 1];\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\r\n\t/**\r\n\t * Get 4-byte unsigned integer value\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {number}\r\n\t */\r\n\tgetUint32(changeLength = true)\r\n\t{\r\n\t\tconst block = this.getBlock(4, changeLength);\r\n\t\t\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(block.length < 4)\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert byte array to \"Uint32Array\" value\r\n\t\tconst value = new Uint32Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tfor(let i = 3; i >= 0; i--)\r\n\t\t\tview[3 - i] = block[i];\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Get 4-byte signed integer value\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {number}\r\n\t */\r\n\tgetInt32(changeLength = true)\r\n\t{\r\n\t\tconst block = this.getBlock(4, changeLength);\r\n\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(block.length < 4)\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\r\n\t\t//region Convert byte array to \"Int32Array\" value\r\n\t\tconst value = new Int32Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tfor(let i = 3; i >= 0; i--)\r\n\t\t\tview[3 - i] = block[i];\r\n\t\t//endregion\r\n\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\n// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n/**\r\n * Get parsed values from \"byte map\"\r\n * @param {ByteStream} stream Stream to parse data from\r\n * @param {Object} map Object with information how to parse \"byte map\"\r\n * @param {number} elements Number of elements in parsing byte map\r\n * @param {?number} [start=null] Start position to parse from\r\n * @param {?number} [length=null] Length of byte block to parse from\r\n * @returns {*}\r\n */\r\nexport function parseByteMap(stream, map, elements, start = null, length = null)\r\n{\r\n\t/*\r\n\t Map example:\r\n\t \r\n\t let map = [\r\n\t {\r\n\t type: \"string\",\r\n\t name: \"type\",\r\n\t minlength: 1,\r\n\t maxlength: 1,\r\n\t func: function(array)\r\n\t {\r\n\t let result = {\r\n\t status: (-1),\r\n\t length: 1\r\n\t };\r\n\t \r\n\t switch(array[0])\r\n\t {\r\n\t case 0x6E: // \"n\"\r\n\t result.value = \"n\";\r\n\t break;\r\n\t case 0x66: // \"f\"\r\n\t result.value = \"f\";\r\n\t break;\r\n\t default:\r\n\t return result;\r\n\t }\r\n\t \r\n\t result.status = 1;\r\n\t \r\n\t return result;\r\n\t }\r\n\t },\r\n\t {\r\n\t type: \"check\",\r\n\t minlength: 1,\r\n\t maxlength: 2,\r\n\t func: function(array)\r\n\t {\r\n\t let position = (-1);\r\n\t \r\n\t if(array[0] == 0x0A)\r\n\t position = 1;\r\n\t if(array[1] == 0x0A)\r\n\t position = 2;\r\n\t \r\n\t return {\r\n\t status: (position > 0) ? 1 : (-1),\r\n\t length: position\r\n\t };\r\n\t }\r\n\t }\r\n\t ];\r\n\t */\r\n\t\r\n\t//region Initial variables\r\n\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\tif(start === null)\r\n\t{\r\n\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\tstart = 0;\r\n\t}\r\n\t\r\n\t// noinspection NonBlockStatementBodyJS\r\n\tif(start > (stream.buffer.byteLength - 1))\r\n\t\treturn false;\r\n\t\r\n\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\tif(length === null)\r\n\t{\r\n\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\tlength = stream.buffer.byteLength - start;\r\n\t}\r\n\t\r\n\tif(length > (stream.buffer.byteLength - start))\r\n\t{\r\n\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\tlength = stream.buffer.byteLength - start;\r\n\t}\r\n\t\r\n\tlet dataView;\r\n\t\r\n\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\tif((start == 0) && (length == stream.buffer.byteLength))\r\n\t\tdataView = stream.view;\r\n\telse\r\n\t\tdataView = new Uint8Array(stream.buffer, start, length);\r\n\t\r\n\tconst resultArray = new Array(elements);\r\n\tlet elementsCount = 0;\r\n\t\r\n\tlet count = 0;\r\n\tconst mapLength = map.length;\r\n\t//endregion\r\n\t\r\n\t//region Parse all byte, structure by structure\r\n\twhile(count < length)\r\n\t{\r\n\t\tlet structureLength = 0;\r\n\t\t\r\n\t\tresultArray[elementsCount] = {};\r\n\t\t\r\n\t\tfor(let i = 0; i < mapLength; i++)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, JSUnresolvedVariable, EqualityComparisonWithCoercionJS\r\n\t\t\tif(map[i].maxlength == 0)\r\n\t\t\t{\r\n\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\tif(\"defaultValue\" in map[i])\r\n\t\t\t\t\t(resultArray[elementsCount])[map[i].name] = map[i].defaultValue;\r\n\t\t\t\t\r\n\t\t\t\t// noinspection ContinueStatementJS\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection JSUnresolvedVariable\r\n\t\t\tconst array = new Array(map[i].maxlength);\r\n\t\t\t\r\n\t\t\t// noinspection JSUnresolvedVariable\r\n\t\t\tfor(let j = 0; j < map[i].maxlength; j++)\r\n\t\t\t{\r\n\t\t\t\t// noinspection IncrementDecrementResultUsedJS\r\n\t\t\t\tarray[j] = dataView[count++];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection JSUnresolvedVariable\r\n\t\t\tconst result = (map[i].func)(array);\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(result.status == (-1))\r\n\t\t\t{\r\n\t\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\t\tif(resultArray.length == 1)\r\n\t\t\t\t\treturn [];\r\n\r\n\t\t\t\treturn resultArray.slice(0, resultArray.length - 1);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(map[i].type != \"check\")\r\n\t\t\t\t(resultArray[elementsCount])[map[i].name] = result.value;\r\n\t\t\t\r\n\t\t\t// noinspection JSUnresolvedVariable\r\n\t\t\tcount -= (map[i].maxlength - result.length);\r\n\t\t\tstructureLength += result.length;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection IncrementDecrementResultUsedJS\r\n\t\t(resultArray[elementsCount++]).structureLength = structureLength;\r\n\t}\r\n\t//endregion\r\n\t\r\n\treturn resultArray;\r\n}\r\n//**************************************************************************************\r\n//region \"Bits-to-string\" array\r\nconst bitsToStringArray = [\r\n\t\"00000000\", \"00000001\", \"00000010\",\r\n\t\"00000011\", \"00000100\", \"00000101\",\r\n\t\"00000110\", \"00000111\", \"00001000\",\r\n\t\"00001001\", \"00001010\", \"00001011\",\r\n\t\"00001100\", \"00001101\", \"00001110\",\r\n\t\"00001111\", \"00010000\", \"00010001\",\r\n\t\"00010010\", \"00010011\", \"00010100\",\r\n\t\"00010101\", \"00010110\", \"00010111\",\r\n\t\"00011000\", \"00011001\", \"00011010\",\r\n\t\"00011011\", \"00011100\", \"00011101\",\r\n\t\"00011110\", \"00011111\", \"00100000\",\r\n\t\"00100001\", \"00100010\", \"00100011\",\r\n\t\"00100100\", \"00100101\", \"00100110\",\r\n\t\"00100111\", \"00101000\", \"00101001\",\r\n\t\"00101010\", \"00101011\", \"00101100\",\r\n\t\"00101101\", \"00101110\", \"00101111\",\r\n\t\"00110000\", \"00110001\", \"00110010\",\r\n\t\"00110011\", \"00110100\", \"00110101\",\r\n\t\"00110110\", \"00110111\", \"00111000\",\r\n\t\"00111001\", \"00111010\", \"00111011\",\r\n\t\"00111100\", \"00111101\", \"00111110\",\r\n\t\"00111111\", \"01000000\", \"01000001\",\r\n\t\"01000010\", \"01000011\", \"01000100\",\r\n\t\"01000101\", \"01000110\", \"01000111\",\r\n\t\"01001000\", \"01001001\", \"01001010\",\r\n\t\"01001011\", \"01001100\", \"01001101\",\r\n\t\"01001110\", \"01001111\", \"01010000\",\r\n\t\"01010001\", \"01010010\", \"01010011\",\r\n\t\"01010100\", \"01010101\", \"01010110\",\r\n\t\"01010111\", \"01011000\", \"01011001\",\r\n\t\"01011010\", \"01011011\", \"01011100\",\r\n\t\"01011101\", \"01011110\", \"01011111\",\r\n\t\"01100000\", \"01100001\", \"01100010\",\r\n\t\"01100011\", \"01100100\", \"01100101\",\r\n\t\"01100110\", \"01100111\", \"01101000\",\r\n\t\"01101001\", \"01101010\", \"01101011\",\r\n\t\"01101100\", \"01101101\", \"01101110\",\r\n\t\"01101111\", \"01110000\", \"01110001\",\r\n\t\"01110010\", \"01110011\", \"01110100\",\r\n\t\"01110101\", \"01110110\", \"01110111\",\r\n\t\"01111000\", \"01111001\", \"01111010\",\r\n\t\"01111011\", \"01111100\", \"01111101\",\r\n\t\"01111110\", \"01111111\", \"10000000\",\r\n\t\"10000001\", \"10000010\", \"10000011\",\r\n\t\"10000100\", \"10000101\", \"10000110\",\r\n\t\"10000111\", \"10001000\", \"10001001\",\r\n\t\"10001010\", \"10001011\", \"10001100\",\r\n\t\"10001101\", \"10001110\", \"10001111\",\r\n\t\"10010000\", \"10010001\", \"10010010\",\r\n\t\"10010011\", \"10010100\", \"10010101\",\r\n\t\"10010110\", \"10010111\", \"10011000\",\r\n\t\"10011001\", \"10011010\", \"10011011\",\r\n\t\"10011100\", \"10011101\", \"10011110\",\r\n\t\"10011111\", \"10100000\", \"10100001\",\r\n\t\"10100010\", \"10100011\", \"10100100\",\r\n\t\"10100101\", \"10100110\", \"10100111\",\r\n\t\"10101000\", \"10101001\", \"10101010\",\r\n\t\"10101011\", \"10101100\", \"10101101\",\r\n\t\"10101110\", \"10101111\", \"10110000\",\r\n\t\"10110001\", \"10110010\", \"10110011\",\r\n\t\"10110100\", \"10110101\", \"10110110\",\r\n\t\"10110111\", \"10111000\", \"10111001\",\r\n\t\"10111010\", \"10111011\", \"10111100\",\r\n\t\"10111101\", \"10111110\", \"10111111\",\r\n\t\"11000000\", \"11000001\", \"11000010\",\r\n\t\"11000011\", \"11000100\", \"11000101\",\r\n\t\"11000110\", \"11000111\", \"11001000\",\r\n\t\"11001001\", \"11001010\", \"11001011\",\r\n\t\"11001100\", \"11001101\", \"11001110\",\r\n\t\"11001111\", \"11010000\", \"11010001\",\r\n\t\"11010010\", \"11010011\", \"11010100\",\r\n\t\"11010101\", \"11010110\", \"11010111\",\r\n\t\"11011000\", \"11011001\", \"11011010\",\r\n\t\"11011011\", \"11011100\", \"11011101\",\r\n\t\"11011110\", \"11011111\", \"11100000\",\r\n\t\"11100001\", \"11100010\", \"11100011\",\r\n\t\"11100100\", \"11100101\", \"11100110\",\r\n\t\"11100111\", \"11101000\", \"11101001\",\r\n\t\"11101010\", \"11101011\", \"11101100\",\r\n\t\"11101101\", \"11101110\", \"11101111\",\r\n\t\"11110000\", \"11110001\", \"11110010\",\r\n\t\"11110011\", \"11110100\", \"11110101\",\r\n\t\"11110110\", \"11110111\", \"11111000\",\r\n\t\"11111001\", \"11111010\", \"11111011\",\r\n\t\"11111100\", \"11111101\", \"11111110\",\r\n\t\"11111111\"\r\n];\r\n//endregion\r\n//**************************************************************************************\r\nexport class BitStream\r\n{\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Constructor for \"BitStream\" class\r\n\t * @param {{[byteStream]: ByteStream, [view]: Uint8Array, [buffer]: ArrayBuffer, [string]: string, [bitsCount]: number}} parameters\r\n\t */\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\tthis.buffer = new ArrayBuffer(0);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.bitsCount = 0; // Number of bits stored in current \"BitStream\"\r\n\t\t\r\n\t\tfor(const key of Object.keys(parameters))\r\n\t\t{\r\n\t\t\tswitch(key)\r\n\t\t\t{\r\n\t\t\t\tcase \"byteStream\":\r\n\t\t\t\t\tthis.fromByteStream(parameters.byteStream);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"view\":\r\n\t\t\t\t\tthis.fromUint8Array(parameters.view);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"buffer\":\r\n\t\t\t\t\tthis.fromArrayBuffer(parameters.buffer);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"string\":\r\n\t\t\t\t\tthis.fromString(parameters.string);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"uint32\":\r\n\t\t\t\t\tthis.fromUint32(parameters.uint32);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"bitsCount\":\r\n\t\t\t\t\tthis.bitsCount = parameters.bitsCount;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Clear existing stream\r\n\t */\r\n\tclear()\r\n\t{\r\n\t\tthis.buffer = new ArrayBuffer(0);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.bitsCount = 0;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"BitStream\" by data from existing \"ByteStream\"\r\n\t * @param {ByteStream} stream\r\n\t */\r\n\tfromByteStream(stream)\r\n\t{\r\n\t\tthis.buffer = stream.buffer.slice(0);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.bitsCount = this.view.length << 3;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"BitStream\" object from existing \"ArrayBuffer\"\r\n\t * @param {ArrayBuffer} array The ArrayBuffer to copy from\r\n\t */\r\n\tfromArrayBuffer(array)\r\n\t{\r\n\t\tthis.buffer = array.slice(0);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.bitsCount = this.view.length << 3;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionNamingConventionJS\r\n\t/**\r\n\t * Initialize \"BitStream\" object from existing \"Uint8Array\"\r\n\t * @param {Uint8Array} array The Uint8Array to copy from\r\n\t */\r\n\tfromUint8Array(array)\r\n\t{\r\n\t\tthis.buffer = new ArrayBuffer(array.length);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.view.set(array);\r\n\t\t\r\n\t\tthis.bitsCount = this.view.length << 3;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"BitStream\" object from existing bit string\r\n\t * @param {string} string The string to initialize from\r\n\t */\r\n\tfromString(string)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst stringLength = string.length;\r\n\t\t\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tthis.buffer = new ArrayBuffer((stringLength >> 3) + ((stringLength % 8) ? 1 : 0));\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.bitsCount = ((stringLength >> 3) + 1) << 3; // In order to handle correct shifting\r\n\t\t\r\n\t\tlet byteIndex = 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert from \"bit string\" to bytes\r\n\t\tfor(let i = 0; i < stringLength; i++)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(string[i] == \"1\")\r\n\t\t\t\tthis.view[byteIndex] |= 1 << (7 - (i % 8));\r\n\t\t\t\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(i && (((i + 1) % 8) == 0))\r\n\t\t\t\tbyteIndex++;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Shift \"BitStream\" into correct position\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(stringLength % 8)\r\n\t\t\tthis.shiftRight(8 - (stringLength % 8));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change \"bitsCount\"\r\n\t\tthis.bitsCount = stringLength;\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"BitStream\" object from existing uint32 number\r\n\t * @param {Number} number The string to initialize from\r\n\t */\r\n\tfromUint32(uint32)\r\n\t{\r\n\t\tthis.buffer = new ArrayBuffer(4);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\r\n\t\tconst value = new Uint32Array([uint32]);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\tfor(let i = 3; i >= 0; i--)\r\n\t\t\tthis.view[i] = view[3 - i];\r\n\r\n\t\tthis.bitsCount = 32;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Represent \"BitStream\" object content as a string\r\n\t * @param {?number} [start=null] Start number to convert to string from\r\n\t * @param {?number} [length=null] Length of BitStream to convert to string\r\n\t * @returns {string}\r\n\t */\r\n\ttoString(start = null, length = null)\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((start >= this.view.length) || (start < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.view.length - start;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((length >= this.view.length) || (length < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.view.length - start;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert from bytes to \"bit string\"\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(let i = start; i < (start + length); i++)\r\n\t\t\tresult.push(bitsToStringArray[this.view[i]]);\r\n\t\t//endregion\r\n\t\t\r\n\t\t// noinspection ChainedFunctionCallJS\r\n\t\treturn result.join(\"\").slice((this.view.length << 3) - this.bitsCount);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Shift entire \"BitStream\" value right to number of bits\r\n\t * @param {number} shift Number of bits to shift value\r\n\t * @param {boolean} [needShrink=true] Need to shrink result or not\r\n\t */\r\n\tshiftRight(shift, needShrink = true)\r\n\t{\r\n\t\t//region Check parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(this.view.length == 0)\r\n\t\t\treturn;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((shift < 0) || (shift > 8))\r\n\t\t\tthrow new Error(\"The \\\"shift\\\" parameter must be in range 0-8\");\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(shift > this.bitsCount)\r\n\t\t\tthrow new Error(\"The \\\"shift\\\" parameter can not be bigger than \\\"this.bitsCount\\\"\");\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\t// noinspection MagicNumberJS\r\n\t\tconst shiftMask = 0xFF >> (8 - shift);\r\n\t\tthis.view[this.view.length - 1] >>= shift;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Shift value\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tfor(let i = (this.view.length - 2); i >= 0; i--)\r\n\t\t{\r\n\t\t\t// noinspection NonShortCircuitBooleanExpressionJS\r\n\t\t\tthis.view[i + 1] |= (this.view[i] & shiftMask) << (8 - shift);\r\n\t\t\tthis.view[i] >>= shift;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Decrease number of bits stored into value\r\n\t\tthis.bitsCount -= shift;\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(this.bitsCount == 0)\r\n\t\t\tthis.clear();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change stream size if needed\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(needShrink)\r\n\t\t\tthis.shrink();\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Shift entire \"BitStream\" value left to number of bits\r\n\t * @param {number} shift Number of bits to shift value\r\n\t */\r\n\tshiftLeft(shift)\r\n\t{\r\n\t\t/*\r\n\t\t NOTE: We do not really shift value because of internal structure of \"BitStream\":\r\n\t\t all bytes inside \"BitStream\" are aligned to right position. So, even if we will\r\n\t\t really shift value to left after that we will need again shift it right to the\r\n\t\t same number of bits. Thus all that we do here is hiding of left bits and descresing\r\n\t\t the \"bitsCount\" number.\r\n\t\t */\r\n\t\t\r\n\t\t//region Check parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(this.view.length == 0)\r\n\t\t\treturn;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((shift < 0) || (shift > 8))\r\n\t\t\tthrow new Error(\"The \\\"shift\\\" parameter must be in range 0-8\");\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(shift > this.bitsCount)\r\n\t\t\tthrow new Error(\"The \\\"shift\\\" parameter can not be bigger than \\\"this.bitsCount\\\"\");\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Remove shifted bits\r\n\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\tconst bitsOffset = this.bitsCount & 0x07;\r\n\t\tif(bitsOffset > shift)\r\n\t\t{\r\n\t\t\t// noinspection MagicNumberJS\r\n\t\t\tthis.view[0] &= 0xFF >> (bitsOffset + shift);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//region Change size of buffer\r\n\t\t\tconst buffer = new ArrayBuffer(this.buffer.byteLength - 1);\r\n\t\t\tconst view = new Uint8Array(buffer);\r\n\t\t\t\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tview.set(new Uint8Array(this.buffer, 1, this.buffer.byteLength - 1));\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Mask item with index 0\r\n\t\t\t// noinspection MagicNumberJS\r\n\t\t\tview[0] &= 0xFF >> (shift - bitsOffset);\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Store final array into current stream\r\n\t\t\tthis.buffer = buffer.slice(0);\r\n\t\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\t//endregion\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Decrease number of bits stored into value\r\n\t\tthis.bitsCount -= shift;\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(this.bitsCount == 0)\r\n\t\t\tthis.clear();\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS, FunctionTooLongJS\r\n\t/**\r\n\t * Return slice of existing \"BitStream\"\r\n\t * @param {?number} [start=null] Start position of the slice (in bits)\r\n\t * @param {?number} [end=null] End position of the slice (in bits)\r\n\t * @returns {BitStream}\r\n\t */\r\n\tslice(start = null, end = null)\r\n\t{\r\n\t\t//region Make ability to pass non-value bits\r\n\t\tlet valueShift = 0;\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(this.bitsCount % 8)\r\n\t\t\tvalueShift = (8 - (this.bitsCount % 8));\r\n\t\t\r\n\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\tstart += valueShift;\r\n\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\tend += valueShift;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start < 0) || (start > ((this.view.length << 3) - 1)))\r\n\t\t\treturn new BitStream(); //(\"Wrong start position: \" + start);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(end == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tend = (this.view.length << 3) - 1;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((end < 0) || (end > ((this.view.length << 3) - 1)))\r\n\t\t\treturn new BitStream(); //(\"Wrong end position: \" + end);\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif((end - start + 1) > this.bitsCount)\r\n\t\t\treturn new BitStream(); //(\"Maximum length is \" + this.bitsCount);\r\n\t\t\r\n\t\tconst startIndex = start >> 3;\r\n\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\tconst startOffset = start & 0x07;\r\n\t\t\r\n\t\tconst endIndex = end >> 3;\r\n\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\tconst endOffset = end & 0x07;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\r\n\t\tconst bitsLength = ((endIndex - startIndex) == 0) ? 1 : (endIndex - startIndex + 1);\r\n\t\t\r\n\t\tconst result = new BitStream();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Store \"primary bytes\"\r\n\t\tresult.buffer = new ArrayBuffer(bitsLength);\r\n\t\tresult.view = new Uint8Array(result.buffer);\r\n\t\tresult.bitsCount = bitsLength << 3;\r\n\t\t\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\tresult.view.set(new Uint8Array(this.buffer, startIndex, bitsLength));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change \"start byte\"\r\n\t\t// noinspection MagicNumberJS\r\n\t\tresult.view[0] &= (0xFF >> startOffset);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change \"end byte\"\r\n\t\t// noinspection MagicNumberJS\r\n\t\tresult.view[bitsLength] &= (0xFF << (7 - endOffset));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Shift result array to right\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(7 - endOffset)\r\n\t\t\tresult.shiftRight(7 - endOffset, false);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Set final number of bits\r\n\t\tresult.bitsCount = (end - start + 1);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Cut unnecessary bytes from result\r\n\t\tresult.shrink();\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Return copy of existing \"BitStream\"\r\n\t * @param {?number} [start=null] Start position of the copy (in bits)\r\n\t * @param {?number} [length=null] Length of the copy (in bits)\r\n\t * @returns {BitStream}\r\n\t */\r\n\tcopy(start = null, length = null)\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start < 0) || (start > ((this.view.length << 3) - 1)))\r\n\t\t\treturn new BitStream(); //(\"Wrong start position: \" + start);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length === null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = (this.view.length << 3) - start - 1;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(length > this.bitsCount)\r\n\t\t\treturn new BitStream(); //(\"Maximum length is \" + this.bitsCount);\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn this.slice(start, start + length - 1);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Shrink unnecessary bytes in current stream accordingly to \"bitsCount\" value\r\n\t */\r\n\tshrink()\r\n\t{\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst currentLength = (this.bitsCount >> 3) + ((this.bitsCount % 8) ? 1 : 0);\r\n\t\tif(currentLength < this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t//region Change size of buffer\r\n\t\t\tconst buffer = new ArrayBuffer(currentLength);\r\n\t\t\tconst view = new Uint8Array(buffer);\r\n\t\t\t\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tview.set(new Uint8Array(this.buffer, this.buffer.byteLength - currentLength, currentLength));\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Store final array into current stream\r\n\t\t\tthis.buffer = buffer.slice(0);\r\n\t\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\t//endregion\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Reverse bits order in each byte in the stream\r\n\t * Got it from here: http://graphics.stanford.edu/~seander/bithacks.html#ReverseByteWith32Bits\r\n\t */\r\n\treverseBytes()\r\n\t{\r\n\t\t//region Reverse bits order in each byte in the stream\r\n\t\tfor(let i = 0; i < this.view.length; i++)\r\n\t\t{\r\n\t\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\t\tthis.view[i] = ((this.view[i] * 0x0802 & 0x22110) | (this.view[i] * 0x8020 & 0x88440)) * 0x10101 >> 16;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Shift \"most significant\" byte\r\n\t\tif(this.bitsCount % 8)\r\n\t\t{\r\n\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\tconst currentLength = (this.bitsCount >> 3) + ((this.bitsCount % 8) ? 1 : 0);\r\n\t\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\t\tthis.view[this.view.length - currentLength] >>= (8 - (this.bitsCount & 0x07));\r\n\t\t}\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Reverse all bits in entire \"BitStream\"\r\n\t */\r\n\treverseValue()\r\n\t{\r\n\t\tconst initialValue = this.toString();\r\n\t\tconst initialValueLength = initialValue.length;\r\n\t\t\r\n\t\tconst reversedValue = new Array(initialValueLength);\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(let i = 0; i < initialValueLength; i++)\r\n\t\t\treversedValue[initialValueLength - 1 - i] = initialValue[i];\r\n\t\t\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\tthis.fromString(reversedValue.join(\"\"));\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Trying to represent entire \"BitStream\" as an unsigned integer.\r\n\t * @return {number}\r\n\t */\r\n\tgetNumberValue()\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst byteLength = (this.buffer.byteLength - 1);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(byteLength > 3)\r\n\t\t\treturn (-1);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(byteLength == (-1))\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert byte array to \"Uint32Array\" value\r\n\t\tconst value = new Uint32Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tfor(let i = byteLength; i >= 0; i--)\r\n\t\t\tview[byteLength - i] = this.view[i];\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find any bit pattern in \"BitStream\"\r\n\t * @param {BitStream} pattern Stream having pattern value\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {number}\r\n\t */\r\n\tfindPattern(pattern, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\tconst stringPattern = new ByteStream({\r\n\t\t\tstring: pattern.toString()\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findPattern(stringPattern, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find first position of any pattern from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {{id: number, position: number}}\r\n\t */\r\n\tfindFirstIn(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findFirstIn(stringPatterns, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all positions of any pattern from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllIn(patterns, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findAllIn(stringPatterns, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all positions of a pattern\r\n\t * @param {BitStream} pattern Stream having pattern value\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array|number}\r\n\t */\r\n\tfindAllPatternIn(pattern, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\" \r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\tconst stringPattern = new ByteStream({\r\n\t\t\tstring: pattern.toString()\r\n\t\t});\r\n\t\t//endregion \r\n\t\t\r\n\t\treturn stringStream.findAllPatternIn(stringPattern, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find first position of data, not included in patterns from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {{left: {id: number, position: *}, right: {id: number, position: number}, value: ByteStream}}\r\n\t */\r\n\tfindFirstNotIn(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findFirstNotIn(stringPatterns, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all positions of data, not included in patterns from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllNotIn(patterns, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findAllNotIn(stringPatterns, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find position of a sequence of any patterns from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {{position, value}|*}\r\n\t */\r\n\tfindFirstSequence(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findFirstSequence(stringPatterns, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find position of a sequence of any patterns from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllSequences(patterns, start, length)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findAllSequences(stringPatterns, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {BitStream} leftPattern Left pattern to search for\r\n\t * @param {BitStream} rightPattern Right pattern to search for\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedPatterns(leftPattern, rightPattern, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\tconst stringLeftPattern = new ByteStream({\r\n\t\t\tstring: leftPattern.toString()\r\n\t\t});\r\n\t\tconst stringRightPattern = new ByteStream({\r\n\t\t\tstring: rightPattern.toString()\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findPairedPatterns(stringLeftPattern, stringRightPattern, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleLoopsJS\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {Array.<BitStream>} inputLeftPatterns Array of left patterns to search for\r\n\t * @param {Array.<BitStream>} inputRightPatterns Array of right patterns to search for\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedArrays(inputLeftPatterns, inputRightPatterns, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringLeftPatterns = new Array(inputLeftPatterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < inputLeftPatterns.length; i++)\r\n\t\t{\r\n\t\t\tstringLeftPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: inputLeftPatterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tconst stringRightPatterns = new Array(inputRightPatterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < inputRightPatterns.length; i++)\r\n\t\t{\r\n\t\t\tstringRightPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: inputRightPatterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findPairedArrays(stringLeftPatterns, stringRightPatterns, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Replace one pattern with other\r\n\t * @param {BitStream} searchPattern The pattern to search for\r\n\t * @param {BitStream} replacePattern The pattern to replace initial pattern\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {boolean}\r\n\t */\r\n\treplacePattern(searchPattern, replacePattern, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\tconst stringSearchPattern = new ByteStream({\r\n\t\t\tstring: searchPattern.toString()\r\n\t\t});\r\n\t\tconst stringReplacePattern = new ByteStream({\r\n\t\t\tstring: replacePattern.toString()\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Re-initialize existing data\r\n\t\tif(stringStream.findPairedPatterns(stringSearchPattern, stringReplacePattern, start, length))\r\n\t\t{\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tthis.fromString(stringStream.toString());\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn false;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Skip any pattern from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {*}\r\n\t */\r\n\tskipPatterns(patterns, start, length, backward)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.skipPatterns(stringPatterns, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Skip any pattern not from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {number}\r\n\t */\r\n\tskipNotPatterns(patterns, start, length, backward)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.skipNotPatterns(stringPatterns, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Append a new \"BitStream\" content to the current \"BitStream\"\r\n\t * @param {BitStream} stream A new \"stream\" to append to current \"stream\"\r\n\t */\r\n\tappend(stream)\r\n\t{\r\n\t\t//region Initialize current stream with new data\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\tthis.fromString([\r\n\t\t\tthis.toString(),\r\n\t\t\tstream.toString()\r\n\t\t].join(\"\"));\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\nexport class SeqBitStream\r\n{\r\n\t//**********************************************************************************\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\t//region Internal variables\r\n\t\tthis.stream = new BitStream();\r\n\t\t\r\n\t\tthis._start = 0;\r\n\t\tthis._length = this.stream.bitsCount;\r\n\t\t\r\n\t\tthis.backward = false;\r\n\t\t\r\n\t\tthis.appendBlock = 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\tfor(const key of Object.keys(parameters))\r\n\t\t{\r\n\t\t\tswitch(key)\r\n\t\t\t{\r\n\t\t\t\tcase \"stream\":\r\n\t\t\t\tcase \"start\":\r\n\t\t\t\tcase \"length\":\r\n\t\t\t\tcase \"backward\":\r\n\t\t\t\tcase \"appendBlock\":\r\n\t\t\t\t\tthis[key] = parameters[key];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\tset start(value)\r\n\t{\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(value > this.stream.bitsCount)\r\n\t\t\treturn;\r\n\t\t\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tthis._length -= ((this.backward) ? (this._start - value) : (value - this._start));\r\n\t\tthis._start = value;\r\n\t\t\r\n\t\t//region Initialization of \"prev\" internal variables\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis.prevStart = this._start;\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis.prevLength = this._length;\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\tget start()\r\n\t{\r\n\t\treturn this._start;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\tset length(value)\r\n\t{\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(value > this.stream.bitsCount)\r\n\t\t\treturn;\r\n\t\t\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis.prevLength = this._length;\r\n\t\tthis._length = value;\r\n\t}\r\n\t//**********************************************************************************\r\n\tget length()\r\n\t{\r\n\t\treturn this._length;\r\n\t}\r\n\t//**********************************************************************************\r\n\tset stream(value)\r\n\t{\r\n\t\tthis._stream = value;\r\n\t\t\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis.prevLength = this._length;\r\n\t\tthis._length = value.bitsCount;\r\n\t\t\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis.prevStart = this._start;\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tthis._start = (this.backward) ? this.length : 0;\r\n\t}\r\n\t//**********************************************************************************\r\n\tget stream()\r\n\t{\r\n\t\treturn this._stream;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Get next \"length\" bits from the stream\r\n\t * @param {number} length Number of bits to read\r\n\t * @returns {*}\r\n\t */\r\n\tgetBits(length)\r\n\t{\r\n\t\t//region Check input parameters \r\n\t\tif((this.start + length) > this.stream.bitsCount)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = (this.stream.bitsCount - this.start);\r\n\t\t}\r\n\t\t//endregion \r\n\t\t\r\n\t\t//region Initial variables \r\n\t\tlet result;\r\n\t\t//endregion \r\n\t\t\r\n\t\t//region Copy necessary length of bits\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\tresult = this.stream.copy(this.start - length, length);\r\n\t\t\tthis.start -= result.bitsCount;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tresult = this.stream.copy(this.start, length);\r\n\t\t\tthis.start += result.bitsCount;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionTooLongJS\r\n\t/**\r\n\t * Get string representation for the next \"length\" bits from the stream\r\n\t * @param {number} length Number of bits to read\r\n\t * @returns {string}\r\n\t */\r\n\tgetBitsString(length)\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\tif((this.start + length) > this.stream.bitsCount)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = (this.stream.bitsCount - this.start);\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tlet result = [];\r\n\t\t\r\n\t\tlet start;\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(this.backward)\r\n\t\t\tstart = this.start - length;\r\n\t\telse\r\n\t\t\tstart = this.start;\r\n\t\t\r\n\t\tlet end = this.start + length - 1;\r\n\t\t\r\n\t\t//region Make ability to pass non-value bits\r\n\t\tlet valueShift = 0;\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(this.stream.bitsCount % 8)\r\n\t\t\tvalueShift = (8 - (this.stream.bitsCount % 8));\r\n\t\t\r\n\t\tstart += valueShift;\r\n\t\tend += valueShift;\r\n\t\t//endregion\r\n\t\t\r\n\t\tconst startIndex = start >> 3;\r\n\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\tconst startOffset = start & 0x07;\r\n\t\t\r\n\t\tconst endIndex = end >> 3;\r\n\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\tconst endOffset = end & 0x07;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\r\n\t\tconst bitsLengthIndex = startIndex + (((endIndex - startIndex) == 0) ? 1 : (endIndex - startIndex + 1));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Get string representation of bits\r\n\t\tfor(let i = startIndex; i < bitsLengthIndex; i++)\r\n\t\t{\r\n\t\t\tlet value = bitsToStringArray[this.stream.view[i]];\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(i == startIndex)\r\n\t\t\t\tvalue = value.slice(startOffset);\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(i == (bitsLengthIndex - 1))\r\n\t\t\t\tvalue = value.slice(0, endOffset - 7 + value.length);\r\n\t\t\t\r\n\t\t\tresult.push(value);\r\n\t\t}\r\n\t\t\r\n\t\tresult = result.join(\"\");\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change internal values\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(this.backward)\r\n\t\t\tthis.start -= result.length;\r\n\t\telse\r\n\t\t\tthis.start += result.length;\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Get number value representation of the next \"length\" bits from the stream, preliminary reversed\r\n\t * @param {number} length Number of bits to read\r\n\t * @returns {*}\r\n\t */\r\n\tgetBitsReversedValue(length)\r\n\t{\r\n\t\t//region Initial variables \r\n\t\tconst initialValue = this.getBitsString(length);\r\n\t\tconst initialValueLength = initialValue.length;\r\n\t\t\r\n\t\tlet byteIndex;\r\n\t\t\r\n\t\tconst initialOffset = 8 - (initialValueLength % 8);\r\n\t\t\r\n\t\tconst reversedValue = new Array(initialValueLength);\r\n\t\t\r\n\t\tconst value = new Uint32Array(1);\r\n\t\tconst valueView = new Uint8Array(value.buffer, 0, 4);\r\n\t\t\r\n\t\tlet i;\r\n\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, MagicNumberJS, NonBlockStatementBodyJS\r\n\t\tif(initialValueLength > 32)\r\n\t\t\treturn (-1);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, MagicNumberJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(length == 32)\r\n\t\t\tbyteIndex = 3;\r\n\t\telse\r\n\t\t\tbyteIndex = ((initialValueLength - 1) >> 3);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Reverse value \r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(i = 0; i < initialValueLength; i++)\r\n\t\t\treversedValue[initialValueLength - 1 - i] = initialValue[i];\r\n\t\t//endregion \r\n\t\t\r\n\t\t//region Convert byte array to \"Uint32Array\" value \r\n\t\tfor(i = initialOffset; i < (initialOffset + initialValueLength); i++)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(reversedValue[i - initialOffset] == \"1\")\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tvalueView[byteIndex] |= 0x01 << (7 - (i % 8));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(i && (((i + 1) % 8) == 0))\r\n\t\t\t\tbyteIndex--;\r\n\t\t}\r\n\t\t//endregion \r\n\t\t\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Represent remaining bits in \"BitStream\" as a string\r\n\t * @return {string}\r\n\t */\r\n\ttoString()\r\n\t{\r\n\t\tconst streamToDisplay = this.stream.copy(this.start, this.length);\r\n\t\treturn streamToDisplay.toString();\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\n"]},"metadata":{},"sourceType":"module"}