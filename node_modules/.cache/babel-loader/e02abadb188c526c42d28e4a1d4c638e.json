{"ast":null,"code":"/*!\n * algorithms/rsassa.js - RSA Signatures\n *\n * Copyright (c) 2015 Cisco Systems, Inc.  See LICENSE file.\n */\n\"use strict\";\n\nvar forge = require(\"../deps/forge.js\"),\n    helpers = require(\"./helpers.js\"),\n    DataBuffer = require(\"../util/databuffer.js\"),\n    rsaUtil = require(\"./rsa-util.js\"); // ### RSAES-PKCS1-v1_5\n// ### RSAES-OAEP\n\n\nfunction rsaesEncryptFn(name) {\n  var alg = {\n    name: name\n  };\n\n  if (\"RSA-OAEP-256\" === name) {\n    alg.name = \"RSA-OAEP\";\n    alg.hash = {\n      name: \"SHA-256\"\n    };\n  } else if (\"RSA-OAEP\" === name) {\n    alg.hash = {\n      name: \"SHA-1\"\n    };\n  } else {\n    alg.name = \"RSAES-PKCS1-v1_5\";\n  } // ### Fallback Implementation -- uses forge\n\n\n  var fallback = function (key, pdata) {\n    // convert pdata to byte string\n    pdata = new DataBuffer(pdata).bytes(); // encrypt it\n\n    var pki = rsaUtil.convertToForge(key, true),\n        params = {};\n\n    if (\"RSA-OAEP\" === alg.name) {\n      params.md = alg.hash.name.toLowerCase().replace(/\\-/g, \"\");\n      params.md = forge.md[params.md].create();\n    }\n\n    var cdata = pki.encrypt(pdata, alg.name.toUpperCase(), params); // convert cdata to Buffer\n\n    cdata = new DataBuffer(cdata).native();\n    return Promise.resolve({\n      data: cdata\n    });\n  }; // ### WebCryptoAPI Implementation\n\n\n  var webcrypto;\n\n  if (\"RSAES-PKCS1-v1_5\" !== alg.name) {\n    webcrypto = function (key, pdata) {\n      key = rsaUtil.convertToJWK(key, true);\n      var promise;\n      promise = helpers.subtleCrypto.importKey(\"jwk\", key, alg, true, [\"encrypt\"]);\n      promise = promise.then(function (key) {\n        return helpers.subtleCrypto.encrypt(alg, key, pdata);\n      });\n      promise = promise.then(function (result) {\n        var cdata = new Buffer(result);\n        return {\n          data: cdata\n        };\n      });\n      return promise;\n    };\n  } else {\n    webcrypto = null;\n  }\n\n  return helpers.setupFallback(null, webcrypto, fallback);\n}\n\nfunction rsaesDecryptFn(name) {\n  var alg = {\n    name: name\n  };\n\n  if (\"RSA-OAEP-256\" === name) {\n    alg.name = \"RSA-OAEP\";\n    alg.hash = {\n      name: \"SHA-256\"\n    };\n  } else if (\"RSA-OAEP\" === name) {\n    alg.hash = {\n      name: \"SHA-1\"\n    };\n  } else {\n    alg.name = \"RSAES-PKCS1-v1_5\";\n  } // ### Fallback Implementation -- uses forge\n\n\n  var fallback = function (key, cdata) {\n    // convert cdata to byte string\n    cdata = new DataBuffer(cdata).bytes(); // decrypt it\n\n    var pki = rsaUtil.convertToForge(key, false),\n        params = {};\n\n    if (\"RSA-OAEP\" === alg.name) {\n      params.md = alg.hash.name.toLowerCase().replace(/\\-/g, \"\");\n      params.md = forge.md[params.md].create();\n    }\n\n    var pdata = pki.decrypt(cdata, alg.name.toUpperCase(), params); // convert pdata to Buffer\n\n    pdata = new DataBuffer(pdata).native();\n    return Promise.resolve(pdata);\n  }; // ### WebCryptoAPI Implementation\n\n\n  var webcrypto;\n\n  if (\"RSAES-PKCS1-v1_5\" !== alg.name) {\n    webcrypto = function (key, pdata) {\n      key = rsaUtil.convertToJWK(key, false);\n      var promise;\n      promise = helpers.subtleCrypto.importKey(\"jwk\", key, alg, true, [\"decrypt\"]);\n      promise = promise.then(function (key) {\n        return helpers.subtleCrypto.decrypt(alg, key, pdata);\n      });\n      promise = promise.then(function (result) {\n        var pdata = new Buffer(result);\n        return pdata;\n      });\n      return promise;\n    };\n  } else {\n    webcrypto = null;\n  }\n\n  var nodejs;\n\n  if (helpers.nodeCrypto && name === \"RSA-OAEP\") {\n    // node only support SHA1, plain RSA-OAEP\n    nodejs = function (key, pdata) {\n      key = rsaUtil.convertToPem(key, false);\n      return helpers.nodeCrypto.privateDecrypt(key, pdata);\n    };\n  }\n\n  return helpers.setupFallback(nodejs, webcrypto, fallback);\n} // ### Public API\n// * [name].encrypt\n// * [name].decrypt\n\n\nvar rsaes = {};\n[\"RSA-OAEP\", \"RSA-OAEP-256\", \"RSA1_5\"].forEach(function (name) {\n  rsaes[name] = {\n    encrypt: rsaesEncryptFn(name),\n    decrypt: rsaesDecryptFn(name)\n  };\n});\nmodule.exports = rsaes;","map":{"version":3,"sources":["/Users/pratison/Work/Cisco/Education/React/education-webex/node_modules/node-jose/lib/algorithms/rsaes.js"],"names":["forge","require","helpers","DataBuffer","rsaUtil","rsaesEncryptFn","name","alg","hash","fallback","key","pdata","bytes","pki","convertToForge","params","md","toLowerCase","replace","create","cdata","encrypt","toUpperCase","native","Promise","resolve","data","webcrypto","convertToJWK","promise","subtleCrypto","importKey","then","result","Buffer","setupFallback","rsaesDecryptFn","decrypt","nodejs","nodeCrypto","convertToPem","privateDecrypt","rsaes","forEach","module","exports"],"mappings":"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","sourcesContent":["/*!\n * algorithms/rsassa.js - RSA Signatures\n *\n * Copyright (c) 2015 Cisco Systems, Inc.  See LICENSE file.\n */\n\"use strict\";\n\nvar forge = require(\"../deps/forge.js\"),\n    helpers = require(\"./helpers.js\"),\n    DataBuffer = require(\"../util/databuffer.js\"),\n    rsaUtil = require(\"./rsa-util.js\");\n\n// ### RSAES-PKCS1-v1_5\n\n// ### RSAES-OAEP\nfunction rsaesEncryptFn(name) {\n  var alg = {\n    name: name\n  };\n\n  if (\"RSA-OAEP-256\" === name) {\n    alg.name = \"RSA-OAEP\";\n    alg.hash = {\n      name: \"SHA-256\"\n    };\n  } else if (\"RSA-OAEP\" === name) {\n    alg.hash = {\n      name: \"SHA-1\"\n    };\n  } else {\n    alg.name = \"RSAES-PKCS1-v1_5\";\n  }\n\n  // ### Fallback Implementation -- uses forge\n  var fallback = function(key, pdata) {\n    // convert pdata to byte string\n    pdata = new DataBuffer(pdata).bytes();\n\n    // encrypt it\n    var pki = rsaUtil.convertToForge(key, true),\n        params = {};\n    if (\"RSA-OAEP\" === alg.name) {\n      params.md = alg.hash.name.toLowerCase().replace(/\\-/g, \"\");\n      params.md = forge.md[params.md].create();\n    }\n    var cdata = pki.encrypt(pdata, alg.name.toUpperCase(), params);\n\n    // convert cdata to Buffer\n    cdata = new DataBuffer(cdata).native();\n\n    return Promise.resolve({\n      data: cdata\n    });\n  };\n\n  // ### WebCryptoAPI Implementation\n  var webcrypto;\n  if (\"RSAES-PKCS1-v1_5\" !== alg.name) {\n    webcrypto = function(key, pdata) {\n      key = rsaUtil.convertToJWK(key, true);\n      var promise;\n      promise = helpers.subtleCrypto.importKey(\"jwk\", key, alg, true, [\"encrypt\"]);\n      promise = promise.then(function(key) {\n        return helpers.subtleCrypto.encrypt(alg, key, pdata);\n      });\n      promise = promise.then(function(result) {\n        var cdata = new Buffer(result);\n        return {\n          data: cdata\n        };\n      });\n\n      return promise;\n    };\n  } else {\n    webcrypto = null;\n  }\n\n  return helpers.setupFallback(null, webcrypto, fallback);\n}\n\nfunction rsaesDecryptFn(name) {\n  var alg = {\n    name: name\n  };\n\n  if (\"RSA-OAEP-256\" === name) {\n    alg.name = \"RSA-OAEP\";\n    alg.hash = {\n      name: \"SHA-256\"\n    };\n  } else if (\"RSA-OAEP\" === name) {\n    alg.hash = {\n      name: \"SHA-1\"\n    };\n  } else {\n    alg.name = \"RSAES-PKCS1-v1_5\";\n  }\n\n  // ### Fallback Implementation -- uses forge\n  var fallback = function(key, cdata) {\n    // convert cdata to byte string\n    cdata = new DataBuffer(cdata).bytes();\n\n    // decrypt it\n    var pki = rsaUtil.convertToForge(key, false),\n        params = {};\n    if (\"RSA-OAEP\" === alg.name) {\n      params.md = alg.hash.name.toLowerCase().replace(/\\-/g, \"\");\n      params.md = forge.md[params.md].create();\n    }\n    var pdata = pki.decrypt(cdata, alg.name.toUpperCase(), params);\n\n    // convert pdata to Buffer\n    pdata = new DataBuffer(pdata).native();\n\n    return Promise.resolve(pdata);\n  };\n\n  // ### WebCryptoAPI Implementation\n  var webcrypto;\n  if (\"RSAES-PKCS1-v1_5\" !== alg.name) {\n    webcrypto = function(key, pdata) {\n      key = rsaUtil.convertToJWK(key, false);\n      var promise;\n      promise = helpers.subtleCrypto.importKey(\"jwk\", key, alg, true, [\"decrypt\"]);\n      promise = promise.then(function(key) {\n        return helpers.subtleCrypto.decrypt(alg, key, pdata);\n      });\n      promise = promise.then(function(result) {\n        var pdata = new Buffer(result);\n        return pdata;\n      });\n\n      return promise;\n    };\n  } else {\n    webcrypto = null;\n  }\n\n  var nodejs;\n  if (helpers.nodeCrypto && name === \"RSA-OAEP\") { // node only support SHA1, plain RSA-OAEP\n    nodejs = function(key, pdata) {\n      key = rsaUtil.convertToPem(key, false);\n      return helpers.nodeCrypto.privateDecrypt(key, pdata);\n    };\n  }\n\n  return helpers.setupFallback(nodejs, webcrypto, fallback);\n}\n\n// ### Public API\n// * [name].encrypt\n// * [name].decrypt\nvar rsaes = {};\n[\n  \"RSA-OAEP\",\n  \"RSA-OAEP-256\",\n  \"RSA1_5\"\n].forEach(function(name) {\n  rsaes[name] = {\n    encrypt: rsaesEncryptFn(name),\n    decrypt: rsaesDecryptFn(name)\n  };\n});\n\nmodule.exports = rsaes;\n"]},"metadata":{},"sourceType":"script"}