{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _getOwnPropertyDescriptor = require('babel-runtime/core-js/object/get-own-property-descriptor');\n\nvar _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);\n\nvar _deleteProperty = require('babel-runtime/core-js/reflect/delete-property');\n\nvar _deleteProperty2 = _interopRequireDefault(_deleteProperty);\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar _assign = require('babel-runtime/core-js/object/assign');\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nvar _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');\n\nvar _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);\n\nvar _promise = require('babel-runtime/core-js/promise');\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _keys = require('babel-runtime/core-js/object/keys');\n\nvar _keys2 = _interopRequireDefault(_keys);\n\nvar _apply = require('babel-runtime/core-js/reflect/apply');\n\nvar _apply2 = _interopRequireDefault(_apply);\n\nvar _unset2 = require('lodash/unset');\n\nvar _unset3 = _interopRequireDefault(_unset2);\n\nvar _set2 = require('lodash/set');\n\nvar _set3 = _interopRequireDefault(_set2);\n\nvar _omit2 = require('lodash/omit');\n\nvar _omit3 = _interopRequireDefault(_omit2);\n\nvar _merge2 = require('lodash/merge');\n\nvar _merge3 = _interopRequireDefault(_merge2);\n\nvar _last2 = require('lodash/last');\n\nvar _last3 = _interopRequireDefault(_last2);\n\nvar _isString2 = require('lodash/isString');\n\nvar _isString3 = _interopRequireDefault(_isString2);\n\nvar _isFunction2 = require('lodash/isFunction');\n\nvar _isFunction3 = _interopRequireDefault(_isFunction2);\n\nvar _get2 = require('lodash/get');\n\nvar _get3 = _interopRequireDefault(_get2);\n\nvar _defaultsDeep2 = require('lodash/defaultsDeep');\n\nvar _defaultsDeep3 = _interopRequireDefault(_defaultsDeep2);\n\nvar _desc, _value, _obj;\n/*!\n * Copyright (c) 2015-2019 Cisco Systems, Inc. See LICENSE file.\n */\n\n\nexports.registerPlugin = registerPlugin;\nexports.registerInternalPlugin = registerInternalPlugin;\n\nvar _events = require('events');\n\nvar _util = require('util');\n\nvar _util2 = _interopRequireDefault(_util);\n\nvar _common = require('@webex/common');\n\nvar _httpCore = require('@webex/http-core');\n\nvar _ampersandState = require('ampersand-state');\n\nvar _ampersandState2 = _interopRequireDefault(_ampersandState);\n\nvar _uuid = require('uuid');\n\nvar _uuid2 = _interopRequireDefault(_uuid);\n\nvar _auth = require('./interceptors/auth');\n\nvar _auth2 = _interopRequireDefault(_auth);\n\nvar _networkTiming = require('./interceptors/network-timing');\n\nvar _networkTiming2 = _interopRequireDefault(_networkTiming);\n\nvar _payloadTransformer = require('./interceptors/payload-transformer');\n\nvar _payloadTransformer2 = _interopRequireDefault(_payloadTransformer);\n\nvar _redirect = require('./interceptors/redirect');\n\nvar _redirect2 = _interopRequireDefault(_redirect);\n\nvar _requestEvent = require('./interceptors/request-event');\n\nvar _requestEvent2 = _interopRequireDefault(_requestEvent);\n\nvar _requestLogger = require('./interceptors/request-logger');\n\nvar _requestLogger2 = _interopRequireDefault(_requestLogger);\n\nvar _requestTiming = require('./interceptors/request-timing');\n\nvar _requestTiming2 = _interopRequireDefault(_requestTiming);\n\nvar _responseLogger = require('./interceptors/response-logger');\n\nvar _responseLogger2 = _interopRequireDefault(_responseLogger);\n\nvar _webexHttpError = require('./lib/webex-http-error');\n\nvar _webexHttpError2 = _interopRequireDefault(_webexHttpError);\n\nvar _userAgent = require('./interceptors/user-agent');\n\nvar _userAgent2 = _interopRequireDefault(_userAgent);\n\nvar _webexTrackingId = require('./interceptors/webex-tracking-id');\n\nvar _webexTrackingId2 = _interopRequireDefault(_webexTrackingId);\n\nvar _webexUserAgent = require('./interceptors/webex-user-agent');\n\nvar _webexUserAgent2 = _interopRequireDefault(_webexUserAgent);\n\nvar _rateLimit = require('./interceptors/rate-limit');\n\nvar _rateLimit2 = _interopRequireDefault(_rateLimit);\n\nvar _embargo = require('./interceptors/embargo');\n\nvar _embargo2 = _interopRequireDefault(_embargo);\n\nvar _defaultOptions = require('./interceptors/default-options');\n\nvar _defaultOptions2 = _interopRequireDefault(_defaultOptions);\n\nvar _config = require('./config');\n\nvar _config2 = _interopRequireDefault(_config);\n\nvar _storage = require('./lib/storage');\n\nvar _webexCorePluginMixin = require('./lib/webex-core-plugin-mixin');\n\nvar _webexCorePluginMixin2 = _interopRequireDefault(_webexCorePluginMixin);\n\nvar _webexInternalCorePluginMixin = require('./lib/webex-internal-core-plugin-mixin');\n\nvar _webexInternalCorePluginMixin2 = _interopRequireDefault(_webexInternalCorePluginMixin);\n\nvar _webexInternalCore = require('./webex-internal-core');\n\nvar _webexInternalCore2 = _interopRequireDefault(_webexInternalCore);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {\n  var desc = {};\n  Object['ke' + 'ys'](descriptor).forEach(function (key) {\n    desc[key] = descriptor[key];\n  });\n  desc.enumerable = !!desc.enumerable;\n  desc.configurable = !!desc.configurable;\n\n  if ('value' in desc || desc.initializer) {\n    desc.writable = true;\n  }\n\n  desc = decorators.slice().reverse().reduce(function (desc, decorator) {\n    return decorator(target, property, desc) || desc;\n  }, desc);\n\n  if (context && desc.initializer !== void 0) {\n    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;\n    desc.initializer = undefined;\n  }\n\n  if (desc.initializer === void 0) {\n    Object['define' + 'Property'](target, property, desc);\n    desc = null;\n  }\n\n  return desc;\n} // TODO replace the Interceptor.create with Reflect.construct (\n// Interceptor.create exists because new was really hard to call on an array of\n// constructors)\n\n\nvar interceptors = {\n  WebexTrackingIdInterceptor: _webexTrackingId2.default.create,\n  RequestEventInterceptor: _requestEvent2.default.create,\n  RateLimitInterceptor: _rateLimit2.default.create,\n\n  /* eslint-disable no-extra-parens */\n  RequestLoggerInterceptor: process.env.ENABLE_NETWORK_LOGGING || process.env.ENABLE_VERBOSE_NETWORK_LOGGING ? _requestLogger2.default.create : undefined,\n  ResponseLoggerInterceptor: process.env.ENABLE_NETWORK_LOGGING || process.env.ENABLE_VERBOSE_NETWORK_LOGGING ? _responseLogger2.default.create : undefined,\n\n  /* eslint-enable no-extra-parens */\n  RequestTimingInterceptor: _requestTiming2.default.create,\n  ServiceInterceptor: undefined,\n  UserAgentInterceptor: _userAgent2.default.create,\n  WebexUserAgentInterceptor: _webexUserAgent2.default.create,\n  AuthInterceptor: _auth2.default.create,\n  KmsDryErrorInterceptor: undefined,\n  PayloadTransformerInterceptor: _payloadTransformer2.default.create,\n  ConversationInterceptor: undefined,\n  RedirectInterceptor: _redirect2.default.create,\n  HttpStatusInterceptor: function HttpStatusInterceptor() {\n    return _httpCore.HttpStatusInterceptor.create({\n      error: _webexHttpError2.default\n    });\n  },\n  NetworkTimingInterceptor: _networkTiming2.default.create,\n  EmbargoInterceptor: _embargo2.default.create,\n  DefaultOptionsInterceptor: _defaultOptions2.default.create\n};\nvar preInterceptors = ['ResponseLoggerInterceptor', 'RequestTimingInterceptor', 'RequestEventInterceptor', 'WebexTrackingIdInterceptor', 'RateLimitInterceptor'];\nvar postInterceptors = ['HttpStatusInterceptor', 'NetworkTimingInterceptor', 'EmbargoInterceptor', 'RequestLoggerInterceptor', 'RateLimitInterceptor'];\n/**\n * @class\n */\n\nvar WebexCore = _ampersandState2.default.extend((_obj = {\n  version: '1.80.172',\n  children: {\n    internal: _webexInternalCore2.default\n  },\n  constructor: function constructor() {\n    var attrs = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var options = arguments[1];\n\n    if (typeof attrs === 'string') {\n      attrs = {\n        credentials: {\n          supertoken: {\n            // eslint-disable-next-line camelcase\n            access_token: attrs\n          }\n        }\n      };\n    } else {\n      // Reminder: order is important here\n      ['credentials.authorization', 'authorization', 'credentials.supertoken.supertoken', 'supertoken', 'access_token', 'credentials.authorization.supertoken'].forEach(function (path) {\n        var val = (0, _get3.default)(attrs, path);\n\n        if (val) {\n          (0, _unset3.default)(attrs, path);\n          (0, _set3.default)(attrs, 'credentials.supertoken', val);\n        }\n      });\n      ['credentials', 'credentials.authorization'].forEach(function (path) {\n        var val = (0, _get3.default)(attrs, path);\n\n        if (typeof val === 'string') {\n          (0, _unset3.default)(attrs, path);\n          (0, _set3.default)(attrs, 'credentials.supertoken', val);\n        }\n      });\n\n      if (typeof (0, _get3.default)(attrs, 'credentials.access_token') === 'string') {\n        // Send access_token to get validated and corrected and then set it\n        (0, _set3.default)(attrs, 'credentials.access_token', this.bearerValidator((0, _get3.default)(attrs, 'credentials.access_token').trim()));\n        (0, _set3.default)(attrs, 'credentials.supertoken', attrs.credentials);\n      }\n    }\n\n    return (0, _apply2.default)(_ampersandState2.default, this, [attrs, options]);\n  },\n  derived: {\n    boundedStorage: {\n      deps: [],\n      fn: function fn() {\n        return (0, _storage.makeWebexStore)('bounded', this);\n      }\n    },\n    unboundedStorage: {\n      deps: [],\n      fn: function fn() {\n        return (0, _storage.makeWebexStore)('unbounded', this);\n      }\n    },\n    ready: {\n      deps: ['loaded', 'internal.ready'],\n      fn: function fn() {\n        var _this = this;\n\n        return this.loaded && (0, _keys2.default)(this._children).reduce(function (ready, name) {\n          return ready && _this[name] && _this[name].ready !== false;\n        }, true);\n      }\n    }\n  },\n  session: {\n    config: {\n      type: 'object'\n    },\n\n    /**\n     * When true, indicates that the initial load from the storage layer is\n     * complete\n     * @instance\n     * @memberof WebexCore\n     * @type {boolean}\n     */\n    loaded: {\n      default: false,\n      type: 'boolean'\n    },\n    request: {\n      setOnce: true,\n      // It's supposed to be a function, but that's not a type defined in\n      // Ampersand\n      type: 'any'\n    },\n    sessionId: {\n      setOnce: true,\n      type: 'string'\n    }\n  },\n\n  /**\n   * @instance\n   * @memberof WebexCore\n   * @param {[type]} args\n   * @returns {[type]}\n   */\n  refresh: function refresh() {\n    var _credentials;\n\n    return (_credentials = this.credentials).refresh.apply(_credentials, arguments);\n  },\n\n  /**\n   * Applies the directionally appropriate transforms to the specified object\n   * @param {string} direction\n   * @param {Object} object\n   * @returns {Promise}\n   */\n  transform: function transform(direction, object) {\n    var _this2 = this;\n\n    var predicates = this.config.payloadTransformer.predicates.filter(function (p) {\n      return !p.direction || p.direction === direction;\n    });\n    var ctx = {\n      webex: this\n    };\n    return _promise2.default.all(predicates.map(function (p) {\n      return p.test(ctx, object).then(function (shouldTransform) {\n        if (!shouldTransform) {\n          return undefined;\n        }\n\n        return p.extract(object) // eslint-disable-next-line max-nested-callbacks\n        .then(function (target) {\n          return {\n            name: p.name,\n            target: target\n          };\n        });\n      });\n    })).then(function (data) {\n      return data.filter(function (d) {\n        return Boolean(d);\n      }) // eslint-disable-next-line max-nested-callbacks\n      .reduce(function (promise, _ref) {\n        var name = _ref.name,\n            target = _ref.target,\n            alias = _ref.alias;\n        return promise.then(function () {\n          if (alias) {\n            return _this2.applyNamedTransform(direction, alias, target);\n          }\n\n          return _this2.applyNamedTransform(direction, name, target);\n        });\n      }, _promise2.default.resolve());\n    }).then(function () {\n      return object;\n    });\n  },\n\n  /**\n   * Applies the directionally appropriate transform to the specified parameters\n   * @param {string} direction\n   * @param {Object} ctx\n   * @param {string} name\n   * @returns {Promise}\n   */\n  applyNamedTransform: function applyNamedTransform(direction, ctx, name) {\n    for (var _len = arguments.length, rest = Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n      rest[_key - 3] = arguments[_key];\n    }\n\n    var _this3 = this;\n\n    if ((0, _isString3.default)(ctx)) {\n      rest.unshift(name);\n      name = ctx;\n      ctx = {\n        webex: this,\n        transform: function transform() {\n          for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n            args[_key2] = arguments[_key2];\n          }\n\n          return _this3.applyNamedTransform.apply(_this3, [direction, ctx].concat(args));\n        }\n      };\n    }\n\n    var transforms = ctx.webex.config.payloadTransformer.transforms.filter(function (tx) {\n      return tx.name === name && (!tx.direction || tx.direction === direction);\n    }); // too many implicit returns on the same line is difficult to interpret\n    // eslint-disable-next-line arrow-body-style\n\n    return transforms.reduce(function (promise, tx) {\n      return promise.then(function () {\n        if (tx.alias) {\n          var _ctx;\n\n          return (_ctx = ctx).transform.apply(_ctx, [tx.alias].concat((0, _toConsumableArray3.default)(rest)));\n        }\n\n        return _promise2.default.resolve(tx.fn.apply(tx, [ctx].concat((0, _toConsumableArray3.default)(rest))));\n      });\n    }, _promise2.default.resolve()).then(function () {\n      return (0, _last3.default)(rest);\n    });\n  },\n\n  /**\n   * @private\n   * @returns {Window}\n   */\n  getWindow: function getWindow() {\n    // eslint-disable-next-line\n    return window;\n  },\n\n  /**\n   * Initializer\n   *\n   * @emits WebexCore#loaded\n   * @emits WebexCore#ready\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} attrs\n   * @returns {WebexCore}\n   */\n  initialize: function initialize() {\n    var _this4 = this;\n\n    var attrs = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.config = (0, _merge3.default)({}, _config2.default, attrs.config); // There's some unfortunateness with the way {@link AmpersandState#children}\n    // get initialized. We'll fire the change:config event so that\n    // {@link WebexPlugin#initialize()} can use\n    // `this.listenToOnce(parent, 'change:config', () => {});` to act on config\n    // during initialization\n\n    this.trigger('change:config');\n\n    var onLoaded = function onLoaded() {\n      if (_this4.loaded) {\n        /**\n         * Fires when all data has been loaded from the storage layer\n         * @event loaded\n         * @instance\n         * @memberof WebexCore\n         */\n        _this4.trigger('loaded');\n\n        _this4.stopListening(_this4, 'change:loaded', onLoaded);\n      }\n    }; // This needs to run on nextTick or we'll never be able to wire up listeners\n\n\n    process.nextTick(function () {\n      _this4.listenToAndRun(_this4, 'change:loaded', onLoaded);\n    });\n\n    var onReady = function onReady() {\n      if (_this4.ready) {\n        /**\n         * Fires when all plugins have fully initialized\n         * @event ready\n         * @instance\n         * @memberof WebexCore\n         */\n        _this4.trigger('ready');\n\n        _this4.stopListening(_this4, 'change:ready', onReady);\n      }\n    }; // This needs to run on nextTick or we'll never be able to wire up listeners\n\n\n    process.nextTick(function () {\n      _this4.listenToAndRun(_this4, 'change:ready', onReady);\n    }); // Make nested events propagate in a consistent manner\n\n    (0, _keys2.default)(this.constructor.prototype._children).forEach(function (key) {\n      _this4.listenTo(_this4[key], 'change', function () {\n        for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n          args[_key3] = arguments[_key3];\n        }\n\n        args.unshift('change:' + key);\n\n        _this4.trigger.apply(_this4, args);\n      });\n    });\n\n    var addInterceptor = function addInterceptor(ints, key) {\n      var interceptor = interceptors[key];\n\n      if (!(0, _isFunction3.default)(interceptor)) {\n        return ints;\n      }\n\n      ints.push((0, _apply2.default)(interceptor, _this4, []));\n      return ints;\n    };\n\n    var ints = [];\n    ints = preInterceptors.reduce(addInterceptor, ints);\n    ints = (0, _keys2.default)(interceptors).filter(function (key) {\n      return !(preInterceptors.includes(key) || postInterceptors.includes(key));\n    }).reduce(addInterceptor, ints);\n    ints = postInterceptors.reduce(addInterceptor, ints);\n    this.request = (0, _httpCore.defaults)({\n      json: true,\n      interceptors: ints\n    });\n    var sessionId = (0, _get3.default)(this, 'config.trackingIdPrefix', 'webex-js-sdk') + '_' + (0, _get3.default)(this, 'config.trackingIdBase', _uuid2.default.v4());\n\n    if ((0, _get3.default)(this, 'config.trackingIdSuffix')) {\n      sessionId += '_' + (0, _get3.default)(this, 'config.trackingIdSuffix');\n    }\n\n    this.sessionId = sessionId;\n  },\n\n  /**\n   * setConfig\n   *\n   * Allows updating config\n   *\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} newConfig\n   * @returns {null}\n   */\n  setConfig: function setConfig() {\n    var newConfig = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.config = (0, _merge3.default)({}, this.config, newConfig);\n  },\n\n  /**\n   *\n   * Check if access token is correctly formated and correct if it's not\n   * Warn user if token string has errors in it\n   * @param {string} token\n   * @returns {string}\n   */\n  bearerValidator: function bearerValidator(token) {\n    if (token.includes('Bearer') && token.split(' ').length - 1 === 0) {\n      console.warn('Your access token does not have a space between \\'Bearer\\' and the token, please add a space to it or replace it with this already fixed version:\\n\\n' + token.replace('Bearer', 'Bearer ').replace(/\\s+/g, ' '));\n      console.info(\"Tip: You don't need to add 'Bearer' to the access_token field. The token by itself is fine\");\n      return token.replace('Bearer', 'Bearer ').replace(/\\s+/g, ' ');\n    } // Allow elseIf return\n    // eslint-disable-next-line  no-else-return\n    else if (token.split(' ').length - 1 > 1) {\n        console.warn('Your access token has ' + (token.split(' ').length - 2) + ' too many spaces, please use this format:\\n\\n' + token.replace(/\\s+/g, ' '));\n        console.info(\"Tip: You don't need to add 'Bearer' to the access_token field, the token by itself is fine\");\n        return token.replace(/\\s+/g, ' ');\n      }\n\n    return token.replace(/\\s+/g, ' '); // Clean it anyway (just in case)\n  },\n\n  /**\n   * @instance\n   * @memberof WebexPlugin\n   * @param {number} depth\n   * @private\n   * @returns {Object}\n   */\n  inspect: function inspect(depth) {\n    return _util2.default.inspect((0, _omit3.default)(this.serialize({\n      props: true,\n      session: true,\n      derived: true\n    }), 'boundedStorage', 'unboundedStorage', 'request', 'config'), {\n      depth: depth\n    });\n  },\n\n  /**\n   * Invokes all `onBeforeLogout` handlers in the scope of their plugin, clears\n   * all stores, and revokes the access token\n   * Note: If you're using the sdk in a server environment, you may be more\n   * interested in {@link `webex.internal.mercury.disconnect()`| Mercury#disconnect()}\n   * and {@link `webex.internal.device.unregister()`|Device#unregister()}\n   * or {@link `webex.phone.unregister()`|Phone#unregister}\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} options Passed as the first argument to all\n   * `onBeforeLogout` handlers\n   * @returns {Promise}\n   */\n  logout: function logout(options) {\n    var _this5 = this;\n\n    for (var _len4 = arguments.length, rest = Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n      rest[_key4 - 1] = arguments[_key4];\n    } // prefer the refresh token, but for clients that don't have one, fallback\n    // to the access token\n\n\n    var token = this.credentials.supertoken && (this.credentials.supertoken.refresh_token || this.credentials.supertoken.access_token);\n    options = (0, _assign2.default)({\n      token: token\n    }, options); // onBeforeLogout should be executed in the opposite order in which handlers\n    // were registered. In that way, wdm unregister() will be above mercury\n    // disconnect(), but disconnect() will execute first.\n    // eslint-disable-next-line arrow-body-style\n\n    return this.config.onBeforeLogout.reverse().reduce(function (promise, _ref2) {\n      var plugin = _ref2.plugin,\n          fn = _ref2.fn;\n      return promise.then(function () {\n        return _promise2.default.resolve((0, _apply2.default)(fn, _this5[plugin] || _this5.internal[plugin], [options].concat((0, _toConsumableArray3.default)(rest)))) // eslint-disable-next-line max-nested-callbacks\n        .catch(function (err) {\n          _this5.logger.warn('onBeforeLogout from plugin ' + plugin + ': failed', err);\n        });\n      });\n    }, _promise2.default.resolve()).then(function () {\n      return _promise2.default.all([_this5.boundedStorage.clear(), _this5.unboundedStorage.clear()]);\n    }).then(function () {\n      var _credentials2;\n\n      return (_credentials2 = _this5.credentials).invalidate.apply(_credentials2, (0, _toConsumableArray3.default)(rest));\n    }).then(function () {\n      var _authorization;\n\n      return _this5.authorization && _this5.authorization.logout && (_authorization = _this5.authorization).logout.apply(_authorization, [options].concat((0, _toConsumableArray3.default)(rest)));\n    }).then(function () {\n      return _this5.trigger('client:logout');\n    });\n  },\n\n  /**\n   * General purpose wrapper to submit metrics via the metrics plugin (if the\n   * metrics plugin is installed)\n   * @instance\n   * @memberof WebexCore\n   * @returns {Promise}\n   */\n  measure: function measure() {\n    if (this.metrics) {\n      var _metrics;\n\n      return (_metrics = this.metrics).sendUnstructured.apply(_metrics, arguments);\n    }\n\n    return _promise2.default.resolve();\n  },\n  upload: function () {\n    var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(options) {\n      var _this6 = this;\n\n      var s3UploadsSupported, shunt, promise;\n      return _regenerator2.default.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              s3UploadsSupported = void 0;\n\n              if (!(this.internal && this.internal.feature)) {\n                _context.next = 5;\n                break;\n              }\n\n              _context.next = 4;\n              return this.internal.feature.getFeature('developer', 'files-s3');\n\n            case 4:\n              s3UploadsSupported = _context.sent;\n\n            case 5:\n              if (options.file) {\n                _context.next = 7;\n                break;\n              }\n\n              return _context.abrupt('return', _promise2.default.reject(new Error('`options.file` is required')));\n\n            case 7:\n              options.phases = options.phases || {};\n              options.phases.initialize = options.phases.initialize || {};\n              options.phases.upload = options.phases.upload || {};\n              options.phases.finalize = options.phases.finalize || {};\n              (0, _defaultsDeep3.default)(options.phases.initialize, {\n                method: 'POST',\n                body: {\n                  uploadProtocol: s3UploadsSupported ? 'content-length' : null\n                }\n              }, (0, _omit3.default)(options, 'file', 'phases'));\n              (0, _defaultsDeep3.default)(options.phases.upload, {\n                method: 'PUT',\n                json: false,\n                withCredentials: false,\n                body: options.file,\n                headers: {\n                  'x-trans-id': _uuid2.default.v4(),\n                  authorization: undefined\n                }\n              });\n              (0, _defaultsDeep3.default)(options.phases.finalize, {\n                method: 'POST'\n              }, (0, _omit3.default)(options, 'file', 'phases'));\n              shunt = new _events.EventEmitter();\n              promise = this._uploadPhaseInitialize(options).then(function () {\n                var p = _this6._uploadPhaseUpload(options);\n\n                (0, _common.transferEvents)('progress', p, shunt);\n                return p;\n              }).then(function () {\n                for (var _len5 = arguments.length, args = Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n                  args[_key5] = arguments[_key5];\n                }\n\n                return _this6._uploadPhaseFinalize.apply(_this6, [options].concat(args));\n              }).then(function (res) {\n                return res.body;\n              });\n              (0, _common.proxyEvents)(shunt, promise);\n              return _context.abrupt('return', promise);\n\n            case 18:\n            case 'end':\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    function upload(_x4) {\n      return _ref3.apply(this, arguments);\n    }\n\n    return upload;\n  }(),\n  _uploadPhaseInitialize: function _uploadPhaseInitialize(options) {\n    var _this7 = this;\n\n    this.logger.debug('client: initiating upload session');\n    return this.request(options.phases.initialize).then(function () {\n      for (var _len6 = arguments.length, args = Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n        args[_key6] = arguments[_key6];\n      }\n\n      return _this7._uploadApplySession.apply(_this7, [options].concat(args));\n    }).then(function (res) {\n      _this7.logger.debug('client: initiated upload session');\n\n      return res;\n    });\n  },\n  _uploadApplySession: function _uploadApplySession(options, res) {\n    var session = res.body;\n    ['upload', 'finalize'].reduce(function (opts, key) {\n      opts[key] = (0, _keys2.default)(opts[key]).reduce(function (phaseOptions, phaseKey) {\n        if (phaseKey.startsWith('$')) {\n          phaseOptions[phaseKey.substr(1)] = phaseOptions[phaseKey](session);\n          (0, _deleteProperty2.default)(phaseOptions, phaseKey);\n        }\n\n        return phaseOptions;\n      }, opts[key]);\n      return opts;\n    }, options.phases);\n  },\n  _uploadPhaseUpload: function _uploadPhaseUpload(options) {\n    var _this8 = this;\n\n    this.logger.debug('client: uploading file');\n    var promise = this.request(options.phases.upload).then(function (res) {\n      _this8.logger.debug('client: uploaded file');\n\n      return res;\n    });\n    (0, _common.proxyEvents)(options.phases.upload.upload, promise);\n    /* istanbul ignore else */\n\n    if (process.env.NODE_ENV === 'test') {\n      promise.on('progress', function (event) {\n        _this8.logger.info('upload progress', event.loaded, event.total);\n      });\n    }\n\n    return promise;\n  },\n  _uploadPhaseFinalize: function _uploadPhaseFinalize(options) {\n    var _this9 = this;\n\n    this.logger.debug('client: finalizing upload session');\n    return this.request(options.phases.finalize).then(function (res) {\n      _this9.logger.debug('client: finalized upload session');\n\n      return res;\n    });\n  }\n}, _applyDecoratedDescriptor(_obj, '_uploadPhaseUpload', [_common.retry], (0, _getOwnPropertyDescriptor2.default)(_obj, '_uploadPhaseUpload'), _obj), _obj));\n\nWebexCore.version = '1.80.172';\n(0, _webexInternalCorePluginMixin2.default)(_webexInternalCore2.default, _config2.default, interceptors);\n(0, _webexCorePluginMixin2.default)(WebexCore, _config2.default, interceptors);\nexports.default = WebexCore;\n/**\n * @method registerPlugin\n * @param {string} name\n * @param {function} constructor\n * @param {Object} options\n * @param {Array<string>} options.proxies\n * @param {Object} options.interceptors\n * @returns {null}\n */\n\nfunction registerPlugin(name, constructor, options) {\n  WebexCore.registerPlugin(name, constructor, options);\n}\n/**\n * Registers plugins used by internal products that do not talk to public APIs.\n * @method registerInternalPlugin\n * @param {string} name\n * @param {function} constructor\n * @param {Object} options\n * @param {Object} options.interceptors\n * @private\n * @returns {null}\n */\n\n\nfunction registerInternalPlugin(name, constructor, options) {\n  _webexInternalCore2.default.registerPlugin(name, constructor, options);\n}","map":{"version":3,"sources":["webex-core.js"],"names":["interceptors","WebexTrackingIdInterceptor","RequestEventInterceptor","RateLimitInterceptor","RequestLoggerInterceptor","process","ResponseLoggerInterceptor","RequestTimingInterceptor","ServiceInterceptor","UserAgentInterceptor","WebexUserAgentInterceptor","AuthInterceptor","KmsDryErrorInterceptor","PayloadTransformerInterceptor","ConversationInterceptor","RedirectInterceptor","HttpStatusInterceptor","error","WebexHttpError","NetworkTimingInterceptor","EmbargoInterceptor","DefaultOptionsInterceptor","create","preInterceptors","postInterceptors","WebexCore","version","children","internal","WebexInternalCore","constructor","attrs","options","credentials","supertoken","access_token","val","AmpState","derived","boundedStorage","deps","fn","unboundedStorage","ready","session","config","type","loaded","default","request","setOnce","sessionId","refresh","transform","predicates","p","ctx","webex","name","target","Boolean","alias","applyNamedTransform","rest","args","transforms","tx","getWindow","initialize","onLoaded","onReady","addInterceptor","interceptor","ints","json","uuid","setConfig","newConfig","bearerValidator","token","console","inspect","util","props","depth","logout","plugin","measure","upload","s3UploadsSupported","method","body","uploadProtocol","withCredentials","headers","authorization","undefined","shunt","EventEmitter","promise","res","_uploadPhaseInitialize","_uploadApplySession","opts","phaseKey","phaseOptions","retry","_uploadPhaseUpload","event","_uploadPhaseFinalize","registerPlugin","registerInternalPlugin"],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) 2015-2019 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {EventEmitter} from 'events';\nimport util from 'util';\n\nimport {proxyEvents, retry, transferEvents} from '@webex/common';\nimport {HttpStatusInterceptor, defaults as requestDefaults} from '@webex/http-core';\nimport {defaultsDeep, get, isFunction, isString, last, merge, omit, set, unset} from 'lodash';\nimport AmpState from 'ampersand-state';\nimport uuid from 'uuid';\n\nimport AuthInterceptor from './interceptors/auth';\nimport NetworkTimingInterceptor from './interceptors/network-timing';\nimport PayloadTransformerInterceptor from './interceptors/payload-transformer';\nimport RedirectInterceptor from './interceptors/redirect';\nimport RequestEventInterceptor from './interceptors/request-event';\nimport RequestLoggerInterceptor from './interceptors/request-logger';\nimport RequestTimingInterceptor from './interceptors/request-timing';\nimport ResponseLoggerInterceptor from './interceptors/response-logger';\nimport WebexHttpError from './lib/webex-http-error';\nimport UserAgentInterceptor from './interceptors/user-agent';\nimport WebexTrackingIdInterceptor from './interceptors/webex-tracking-id';\nimport WebexUserAgentInterceptor from './interceptors/webex-user-agent';\nimport RateLimitInterceptor from './interceptors/rate-limit';\nimport EmbargoInterceptor from './interceptors/embargo';\nimport DefaultOptionsInterceptor from './interceptors/default-options';\nimport config from './config';\nimport {makeWebexStore} from './lib/storage';\nimport mixinWebexCorePlugins from './lib/webex-core-plugin-mixin';\nimport mixinWebexInternalCorePlugins from './lib/webex-internal-core-plugin-mixin';\nimport WebexInternalCore from './webex-internal-core';\n\n// TODO replace the Interceptor.create with Reflect.construct (\n// Interceptor.create exists because new was really hard to call on an array of\n// constructors)\nconst interceptors = {\n  WebexTrackingIdInterceptor: WebexTrackingIdInterceptor.create,\n  RequestEventInterceptor: RequestEventInterceptor.create,\n  RateLimitInterceptor: RateLimitInterceptor.create,\n  /* eslint-disable no-extra-parens */\n  RequestLoggerInterceptor: (process.env.ENABLE_NETWORK_LOGGING || process.env.ENABLE_VERBOSE_NETWORK_LOGGING) ? RequestLoggerInterceptor.create : undefined,\n  ResponseLoggerInterceptor: (process.env.ENABLE_NETWORK_LOGGING || process.env.ENABLE_VERBOSE_NETWORK_LOGGING) ? ResponseLoggerInterceptor.create : undefined,\n  /* eslint-enable no-extra-parens */\n  RequestTimingInterceptor: RequestTimingInterceptor.create,\n  ServiceInterceptor: undefined,\n  UserAgentInterceptor: UserAgentInterceptor.create,\n  WebexUserAgentInterceptor: WebexUserAgentInterceptor.create,\n  AuthInterceptor: AuthInterceptor.create,\n  KmsDryErrorInterceptor: undefined,\n  PayloadTransformerInterceptor: PayloadTransformerInterceptor.create,\n  ConversationInterceptor: undefined,\n  RedirectInterceptor: RedirectInterceptor.create,\n  HttpStatusInterceptor() {\n    return HttpStatusInterceptor.create({\n      error: WebexHttpError\n    });\n  },\n  NetworkTimingInterceptor: NetworkTimingInterceptor.create,\n  EmbargoInterceptor: EmbargoInterceptor.create,\n  DefaultOptionsInterceptor: DefaultOptionsInterceptor.create\n};\n\nconst preInterceptors = [\n  'ResponseLoggerInterceptor',\n  'RequestTimingInterceptor',\n  'RequestEventInterceptor',\n  'WebexTrackingIdInterceptor',\n  'RateLimitInterceptor'\n];\n\nconst postInterceptors = [\n  'HttpStatusInterceptor',\n  'NetworkTimingInterceptor',\n  'EmbargoInterceptor',\n  'RequestLoggerInterceptor',\n  'RateLimitInterceptor'\n];\n\n/**\n * @class\n */\nconst WebexCore = AmpState.extend({\n  version: PACKAGE_VERSION,\n\n  children: {\n    internal: WebexInternalCore\n  },\n\n  constructor(attrs = {}, options) {\n    if (typeof attrs === 'string') {\n      attrs = {\n        credentials: {\n          supertoken: {\n            // eslint-disable-next-line camelcase\n            access_token: attrs\n          }\n        }\n      };\n    }\n    else {\n      // Reminder: order is important here\n      [\n        'credentials.authorization',\n        'authorization',\n        'credentials.supertoken.supertoken',\n        'supertoken',\n        'access_token',\n        'credentials.authorization.supertoken'\n      ].forEach((path) => {\n        const val = get(attrs, path);\n\n        if (val) {\n          unset(attrs, path);\n          set(attrs, 'credentials.supertoken', val);\n        }\n      });\n\n      [\n        'credentials',\n        'credentials.authorization'\n      ]\n        .forEach((path) => {\n          const val = get(attrs, path);\n\n          if (typeof val === 'string') {\n            unset(attrs, path);\n            set(attrs, 'credentials.supertoken', val);\n          }\n        });\n\n      if (typeof get(attrs, 'credentials.access_token') === 'string') {\n        // Send access_token to get validated and corrected and then set it\n        set(attrs, 'credentials.access_token', this.bearerValidator(get(attrs, 'credentials.access_token').trim()));\n\n        set(attrs, 'credentials.supertoken', attrs.credentials);\n      }\n    }\n\n    return Reflect.apply(AmpState, this, [attrs, options]);\n  },\n\n  derived: {\n    boundedStorage: {\n      deps: [],\n      fn() {\n        return makeWebexStore('bounded', this);\n      }\n    },\n    unboundedStorage: {\n      deps: [],\n      fn() {\n        return makeWebexStore('unbounded', this);\n      }\n    },\n    ready: {\n      deps: ['loaded', 'internal.ready'],\n      fn() {\n        return this.loaded && Object.keys(this._children).reduce((ready, name) => ready && this[name] && this[name].ready !== false, true);\n      }\n    }\n  },\n\n  session: {\n    config: {\n      type: 'object'\n    },\n    /**\n     * When true, indicates that the initial load from the storage layer is\n     * complete\n     * @instance\n     * @memberof WebexCore\n     * @type {boolean}\n     */\n    loaded: {\n      default: false,\n      type: 'boolean'\n    },\n    request: {\n      setOnce: true,\n      // It's supposed to be a function, but that's not a type defined in\n      // Ampersand\n      type: 'any'\n    },\n    sessionId: {\n      setOnce: true,\n      type: 'string'\n    }\n  },\n\n  /**\n   * @instance\n   * @memberof WebexCore\n   * @param {[type]} args\n   * @returns {[type]}\n   */\n  refresh(...args) {\n    return this.credentials.refresh(...args);\n  },\n\n  /**\n   * Applies the directionally appropriate transforms to the specified object\n   * @param {string} direction\n   * @param {Object} object\n   * @returns {Promise}\n   */\n  transform(direction, object) {\n    const predicates = this.config.payloadTransformer.predicates.filter(\n      (p) => !p.direction || p.direction === direction\n    );\n    const ctx = {\n      webex: this\n    };\n\n    return Promise.all(predicates.map((p) => p.test(ctx, object)\n      .then((shouldTransform) => {\n        if (!shouldTransform) {\n          return undefined;\n        }\n\n        return p.extract(object)\n          // eslint-disable-next-line max-nested-callbacks\n          .then((target) => ({\n            name: p.name,\n            target\n          }));\n      })))\n      .then((data) => data\n        .filter((d) => Boolean(d))\n        // eslint-disable-next-line max-nested-callbacks\n        .reduce((promise, {name, target, alias}) => promise.then(() => {\n          if (alias) {\n            return this.applyNamedTransform(direction, alias, target);\n          }\n\n          return this.applyNamedTransform(direction, name, target);\n        }), Promise.resolve()))\n      .then(() => object);\n  },\n\n  /**\n   * Applies the directionally appropriate transform to the specified parameters\n   * @param {string} direction\n   * @param {Object} ctx\n   * @param {string} name\n   * @returns {Promise}\n   */\n  applyNamedTransform(direction, ctx, name, ...rest) {\n    if (isString(ctx)) {\n      rest.unshift(name);\n      name = ctx;\n      ctx = {\n        webex: this,\n        transform: (...args) => this.applyNamedTransform(direction, ctx, ...args)\n      };\n    }\n\n    const transforms = ctx.webex.config.payloadTransformer.transforms.filter(\n      (tx) => tx.name === name && (!tx.direction || tx.direction === direction)\n    );\n\n    // too many implicit returns on the same line is difficult to interpret\n    // eslint-disable-next-line arrow-body-style\n    return transforms.reduce((promise, tx) => promise.then(() => {\n      if (tx.alias) {\n        return ctx.transform(tx.alias, ...rest);\n      }\n\n      return Promise.resolve(tx.fn(ctx, ...rest));\n    }), Promise.resolve())\n      .then(() => last(rest));\n  },\n\n  /**\n   * @private\n   * @returns {Window}\n   */\n  getWindow() {\n    // eslint-disable-next-line\n    return window;\n  },\n\n  /**\n   * Initializer\n   *\n   * @emits WebexCore#loaded\n   * @emits WebexCore#ready\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} attrs\n   * @returns {WebexCore}\n   */\n  initialize(attrs = {}) {\n    this.config = merge({}, config, attrs.config);\n\n\n    // There's some unfortunateness with the way {@link AmpersandState#children}\n    // get initialized. We'll fire the change:config event so that\n    // {@link WebexPlugin#initialize()} can use\n    // `this.listenToOnce(parent, 'change:config', () => {});` to act on config\n    // during initialization\n    this.trigger('change:config');\n\n    const onLoaded = () => {\n      if (this.loaded) {\n        /**\n         * Fires when all data has been loaded from the storage layer\n         * @event loaded\n         * @instance\n         * @memberof WebexCore\n         */\n        this.trigger('loaded');\n\n        this.stopListening(this, 'change:loaded', onLoaded);\n      }\n    };\n\n    // This needs to run on nextTick or we'll never be able to wire up listeners\n    process.nextTick(() => {\n      this.listenToAndRun(this, 'change:loaded', onLoaded);\n    });\n\n    const onReady = () => {\n      if (this.ready) {\n        /**\n         * Fires when all plugins have fully initialized\n         * @event ready\n         * @instance\n         * @memberof WebexCore\n         */\n        this.trigger('ready');\n\n        this.stopListening(this, 'change:ready', onReady);\n      }\n    };\n\n    // This needs to run on nextTick or we'll never be able to wire up listeners\n    process.nextTick(() => {\n      this.listenToAndRun(this, 'change:ready', onReady);\n    });\n\n    // Make nested events propagate in a consistent manner\n    Object.keys(this.constructor.prototype._children).forEach((key) => {\n      this.listenTo(this[key], 'change', (...args) => {\n        args.unshift(`change:${key}`);\n        this.trigger(...args);\n      });\n    });\n\n    const addInterceptor = (ints, key) => {\n      const interceptor = interceptors[key];\n\n      if (!isFunction(interceptor)) {\n        return ints;\n      }\n\n      ints.push(Reflect.apply(interceptor, this, []));\n\n      return ints;\n    };\n\n    let ints = [];\n\n    ints = preInterceptors.reduce(addInterceptor, ints);\n    ints = Object.keys(interceptors)\n      .filter((key) => !(preInterceptors.includes(key) || postInterceptors.includes(key)))\n      .reduce(addInterceptor, ints);\n    ints = postInterceptors.reduce(addInterceptor, ints);\n\n    this.request = requestDefaults({\n      json: true,\n      interceptors: ints\n    });\n\n    let sessionId = `${get(this, 'config.trackingIdPrefix', 'webex-js-sdk')}_${get(this, 'config.trackingIdBase', uuid.v4())}`;\n\n    if (get(this, 'config.trackingIdSuffix')) {\n      sessionId += `_${get(this, 'config.trackingIdSuffix')}`;\n    }\n\n    this.sessionId = sessionId;\n  },\n\n  /**\n   * setConfig\n   *\n   * Allows updating config\n   *\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} newConfig\n   * @returns {null}\n   */\n  setConfig(newConfig = {}) {\n    this.config = merge({}, this.config, newConfig);\n  },\n\n  /**\n   *\n   * Check if access token is correctly formated and correct if it's not\n   * Warn user if token string has errors in it\n   * @param {string} token\n   * @returns {string}\n   */\n  bearerValidator(token) {\n    if (token.includes('Bearer') && token.split(' ').length - 1 === 0) {\n      console.warn(\n        `Your access token does not have a space between 'Bearer' and the token, please add a space to it or replace it with this already fixed version:\\n\\n${token.replace('Bearer', 'Bearer ').replace(/\\s+/g, ' ')}`\n      );\n      console.info(\"Tip: You don't need to add 'Bearer' to the access_token field. The token by itself is fine\");\n\n      return token.replace('Bearer', 'Bearer ').replace(/\\s+/g, ' ');\n    }\n    // Allow elseIf return\n    // eslint-disable-next-line  no-else-return\n    else if (token.split(' ').length - 1 > 1) {\n      console.warn(\n        `Your access token has ${token.split(' ').length - 2} too many spaces, please use this format:\\n\\n${token.replace(/\\s+/g, ' ')}`\n      );\n      console.info(\"Tip: You don't need to add 'Bearer' to the access_token field, the token by itself is fine\");\n\n      return token.replace(/\\s+/g, ' ');\n    }\n\n    return token.replace(/\\s+/g, ' '); // Clean it anyway (just in case)\n  },\n\n  /**\n   * @instance\n   * @memberof WebexPlugin\n   * @param {number} depth\n   * @private\n   * @returns {Object}\n   */\n  inspect(depth) {\n    return util.inspect(omit(this.serialize({\n      props: true,\n      session: true,\n      derived: true\n    }), 'boundedStorage', 'unboundedStorage', 'request', 'config'), {depth});\n  },\n\n  /**\n   * Invokes all `onBeforeLogout` handlers in the scope of their plugin, clears\n   * all stores, and revokes the access token\n   * Note: If you're using the sdk in a server environment, you may be more\n   * interested in {@link `webex.internal.mercury.disconnect()`| Mercury#disconnect()}\n   * and {@link `webex.internal.device.unregister()`|Device#unregister()}\n   * or {@link `webex.phone.unregister()`|Phone#unregister}\n   * @instance\n   * @memberof WebexCore\n   * @param {Object} options Passed as the first argument to all\n   * `onBeforeLogout` handlers\n   * @returns {Promise}\n   */\n  logout(options, ...rest) {\n    // prefer the refresh token, but for clients that don't have one, fallback\n    // to the access token\n    const token = this.credentials.supertoken && (this.credentials.supertoken.refresh_token || this.credentials.supertoken.access_token);\n\n    options = Object.assign({token}, options);\n\n    // onBeforeLogout should be executed in the opposite order in which handlers\n    // were registered. In that way, wdm unregister() will be above mercury\n    // disconnect(), but disconnect() will execute first.\n    // eslint-disable-next-line arrow-body-style\n    return this.config.onBeforeLogout.reverse().reduce((promise, {plugin, fn}) => promise.then(() => {\n      return Promise.resolve(Reflect.apply(fn, this[plugin] || this.internal[plugin], [options, ...rest]))\n        // eslint-disable-next-line max-nested-callbacks\n        .catch((err) => {\n          this.logger.warn(`onBeforeLogout from plugin ${plugin}: failed`, err);\n        });\n    }), Promise.resolve())\n      .then(() => Promise.all([\n        this.boundedStorage.clear(),\n        this.unboundedStorage.clear()\n      ]))\n      .then(() => this.credentials.invalidate(...rest))\n      .then(() => this.authorization && this.authorization.logout && this.authorization.logout(options, ...rest))\n      .then(() => this.trigger('client:logout'));\n  },\n\n  /**\n   * General purpose wrapper to submit metrics via the metrics plugin (if the\n   * metrics plugin is installed)\n   * @instance\n   * @memberof WebexCore\n   * @returns {Promise}\n   */\n  measure(...args) {\n    if (this.metrics) {\n      return this.metrics.sendUnstructured(...args);\n    }\n\n    return Promise.resolve();\n  },\n\n  async upload(options) {\n    let s3UploadsSupported;\n\n    if (this.internal && this.internal.feature) {\n      s3UploadsSupported = await this.internal.feature.getFeature('developer', 'files-s3');\n    }\n    if (!options.file) {\n      return Promise.reject(new Error('`options.file` is required'));\n    }\n\n    options.phases = options.phases || {};\n    options.phases.initialize = options.phases.initialize || {};\n    options.phases.upload = options.phases.upload || {};\n    options.phases.finalize = options.phases.finalize || {};\n\n    defaultsDeep(options.phases.initialize, {\n      method: 'POST',\n      body: {\n        uploadProtocol: s3UploadsSupported ? 'content-length' : null\n      }\n    }, omit(options, 'file', 'phases'));\n\n    defaultsDeep(options.phases.upload, {\n      method: 'PUT',\n      json: false,\n      withCredentials: false,\n      body: options.file,\n      headers: {\n        'x-trans-id': uuid.v4(),\n        authorization: undefined\n      }\n    });\n\n    defaultsDeep(options.phases.finalize, {\n      method: 'POST'\n    }, omit(options, 'file', 'phases'));\n\n    const shunt = new EventEmitter();\n\n    const promise = this._uploadPhaseInitialize(options)\n      .then(() => {\n        const p = this._uploadPhaseUpload(options);\n\n        transferEvents('progress', p, shunt);\n\n        return p;\n      })\n      .then((...args) => this._uploadPhaseFinalize(options, ...args))\n      .then((res) => res.body);\n\n    proxyEvents(shunt, promise);\n\n    return promise;\n  },\n\n  _uploadPhaseInitialize: function _uploadPhaseInitialize(options) {\n    this.logger.debug('client: initiating upload session');\n\n    return this.request(options.phases.initialize)\n      .then((...args) => this._uploadApplySession(options, ...args))\n      .then((res) => {\n        this.logger.debug('client: initiated upload session');\n\n        return res;\n      });\n  },\n\n  _uploadApplySession(options, res) {\n    const session = res.body;\n\n    ['upload', 'finalize'].reduce((opts, key) => {\n      opts[key] = Object.keys(opts[key]).reduce((phaseOptions, phaseKey) => {\n        if (phaseKey.startsWith('$')) {\n          phaseOptions[phaseKey.substr(1)] = phaseOptions[phaseKey](session);\n          Reflect.deleteProperty(phaseOptions, phaseKey);\n        }\n\n        return phaseOptions;\n      }, opts[key]);\n\n      return opts;\n    }, options.phases);\n  },\n\n  @retry\n  _uploadPhaseUpload(options) {\n    this.logger.debug('client: uploading file');\n\n    const promise = this.request(options.phases.upload)\n      .then((res) => {\n        this.logger.debug('client: uploaded file');\n\n        return res;\n      });\n\n    proxyEvents(options.phases.upload.upload, promise);\n\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV === 'test') {\n      promise.on('progress', (event) => {\n        this.logger.info('upload progress', event.loaded, event.total);\n      });\n    }\n\n    return promise;\n  },\n\n  _uploadPhaseFinalize: function _uploadPhaseFinalize(options) {\n    this.logger.debug('client: finalizing upload session');\n\n    return this.request(options.phases.finalize)\n      .then((res) => {\n        this.logger.debug('client: finalized upload session');\n\n        return res;\n      });\n  }\n});\n\nWebexCore.version = PACKAGE_VERSION;\n\nmixinWebexInternalCorePlugins(WebexInternalCore, config, interceptors);\nmixinWebexCorePlugins(WebexCore, config, interceptors);\n\nexport default WebexCore;\n\n/**\n * @method registerPlugin\n * @param {string} name\n * @param {function} constructor\n * @param {Object} options\n * @param {Array<string>} options.proxies\n * @param {Object} options.interceptors\n * @returns {null}\n */\nexport function registerPlugin(name, constructor, options) {\n  WebexCore.registerPlugin(name, constructor, options);\n}\n\n/**\n * Registers plugins used by internal products that do not talk to public APIs.\n * @method registerInternalPlugin\n * @param {string} name\n * @param {function} constructor\n * @param {Object} options\n * @param {Object} options.interceptors\n * @private\n * @returns {null}\n */\nexport function registerInternalPlugin(name, constructor, options) {\n  WebexInternalCore.registerPlugin(name, constructor, options);\n}\n"]},"metadata":{},"sourceType":"script"}